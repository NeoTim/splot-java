<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>[DRAFT] Splot Design Documentation</title>
        
        <meta name="robots" content="noindex" />
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body class="light">
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            document.body.className = theme;
            document.querySelector('html').className = theme + ' js';
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="affix"><a href="title-page.html">Splot Design Documentation</a></li><li><a href="intro.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li><ol class="section"><li><a href="design-goals.html"><strong aria-hidden="true">1.1.</strong> Design Goals</a></li><li><a href="terminology.html"><strong aria-hidden="true">1.2.</strong> Terminology</a></li></ol></li><li><a href="som/intro.html"><strong aria-hidden="true">2.</strong> Splot Object Model</a></li><li><ol class="section"><li><a href="som/arch.html"><strong aria-hidden="true">2.1.</strong> Architecture</a></li><li><a href="som/things.html"><strong aria-hidden="true">2.2.</strong> Things</a></li><li><a href="som/properties.html"><strong aria-hidden="true">2.3.</strong> Properties</a></li><li><a href="som/methods.html"><strong aria-hidden="true">2.4.</strong> Methods</a></li><li><a href="som/traits.html"><strong aria-hidden="true">2.5.</strong> Traits</a></li><li><a href="som/children.html"><strong aria-hidden="true">2.6.</strong> Children</a></li><li><a href="som/trait-profiles.html"><strong aria-hidden="true">2.7.</strong> Trait Profiles</a></li><li><a href="som/groups.html"><strong aria-hidden="true">2.8.</strong> Groups</a></li><li><a href="som/technologies.html"><strong aria-hidden="true">2.9.</strong> Technologies</a></li></ol></li><li><a href="automation/intro.html"><strong aria-hidden="true">3.</strong> Automation</a></li><li><ol class="section"><li><a href="automation/primitives.html"><strong aria-hidden="true">3.1.</strong> Primitives</a></li><li><ol class="section"><li><a href="automation/pairings.html"><strong aria-hidden="true">3.1.1.</strong> Pairings</a></li><li><a href="automation/rules.html"><strong aria-hidden="true">3.1.2.</strong> Rules</a></li><li><a href="automation/timers.html"><strong aria-hidden="true">3.1.3.</strong> Timers</a></li><li><a href="automation/actionable.html"><strong aria-hidden="true">3.1.4.</strong> Actionable Primitives</a></li></ol></li><li><a href="automation/expressions.html"><strong aria-hidden="true">3.2.</strong> Automation Expressions</a></li><li><a href="automation/recipes.html"><strong aria-hidden="true">3.3.</strong> Automation Recipes</a></li><li><a href="automation/examples.html"><strong aria-hidden="true">3.4.</strong> Pulling it All Together</a></li></ol></li><li><a href="ssm/intro.html"><strong aria-hidden="true">4.</strong> Splot Security Model</a></li><li><ol class="section"><li><a href="ssm/arch.html"><strong aria-hidden="true">4.1.</strong> Architecture</a></li><li><a href="ssm/sessions.html"><strong aria-hidden="true">4.2.</strong> Security Sessions</a></li><li><a href="ssm/identities.html"><strong aria-hidden="true">4.3.</strong> Identities</a></li><li><a href="ssm/keychain.html"><strong aria-hidden="true">4.4.</strong> Keychain</a></li><li><a href="ssm/lost-secret-recovery.html"><strong aria-hidden="true">4.5.</strong> Lost Secret Recovery</a></li><li><a href="ssm/spske.html"><strong aria-hidden="true">4.6.</strong> Single-Purpose Shared Key Establishment</a></li><li><a href="ssm/unresolved-issues.html"><strong aria-hidden="true">4.7.</strong> Unresolved Issues</a></li></ol></li><li><a href="smcp/intro.html"><strong aria-hidden="true">5.</strong> Splot Monitoring and Control Protocol</a></li><li><ol class="section"><li><a href="smcp/examples.html"><strong aria-hidden="true">5.1.</strong> Introductory Example</a></li><li><a href="smcp/cloud_control.html"><strong aria-hidden="true">5.2.</strong> Remote Monitoring and Control</a></li></ol></li><li><a href="trait-def/core/intro.html"><strong aria-hidden="true">6.</strong> Core Traits</a></li><li><ol class="section"><li><a href="trait-def/core/base.html"><strong aria-hidden="true">6.1.</strong> Base</a></li><li><a href="trait-def/core/group.html"><strong aria-hidden="true">6.2.</strong> Group</a></li><li><a href="trait-def/core/scene.html"><strong aria-hidden="true">6.3.</strong> Scene</a></li><li><a href="trait-def/core/transition.html"><strong aria-hidden="true">6.4.</strong> Transition</a></li></ol></li><li><a href="trait-def/std/intro.html"><strong aria-hidden="true">7.</strong> Standard Traits</a></li><li><ol class="section"><li><a href="trait-def/std/on-off.html"><strong aria-hidden="true">7.1.</strong> OnOff</a></li><li><a href="trait-def/std/level.html"><strong aria-hidden="true">7.2.</strong> Level</a></li><li><a href="trait-def/std/light.html"><strong aria-hidden="true">7.3.</strong> Light</a></li><li><a href="trait-def/std/enabled.html"><strong aria-hidden="true">7.4.</strong> Enabled</a></li><li><a href="trait-def/std/energy.html"><strong aria-hidden="true">7.5.</strong> Energy</a></li><li><a href="trait-def/std/battery.html"><strong aria-hidden="true">7.6.</strong> Battery</a></li><li><a href="trait-def/std/ambient-environment.html"><strong aria-hidden="true">7.7.</strong> AmbientEnvironment</a></li><li><a href="trait-def/std/button.html"><strong aria-hidden="true">7.8.</strong> Button</a></li><li><a href="trait-def/std/presence.html"><strong aria-hidden="true">7.9.</strong> Presence</a></li></ol></li><li><a href="trait-def/auto/intro.html"><strong aria-hidden="true">8.</strong> Automation Traits</a></li><li><ol class="section"><li><a href="trait-def/auto/pairing.html"><strong aria-hidden="true">8.1.</strong> Pairing</a></li><li><a href="trait-def/auto/pairing-manager.html"><strong aria-hidden="true">8.2.</strong> PairingManager</a></li><li><a href="trait-def/auto/actionable.html"><strong aria-hidden="true">8.3.</strong> Actionable</a></li><li><a href="trait-def/auto/rule.html"><strong aria-hidden="true">8.4.</strong> Rule</a></li><li><a href="trait-def/auto/rule-manager.html"><strong aria-hidden="true">8.5.</strong> RuleManager</a></li><li><a href="trait-def/auto/timer.html"><strong aria-hidden="true">8.6.</strong> Timer</a></li><li><a href="trait-def/auto/timer-manager.html"><strong aria-hidden="true">8.7.</strong> TimerManager</a></li></ol></li><li><a href="trait-def/sec/intro.html"><strong aria-hidden="true">9.</strong> Security Traits</a></li><li><ol class="section"><li><a href="trait-def/sec/keychain.html"><strong aria-hidden="true">9.1.</strong> Keychain</a></li><li><a href="trait-def/sec/keychain-item.html"><strong aria-hidden="true">9.2.</strong> KeychainItem</a></li><li><a href="trait-def/sec/identity.html"><strong aria-hidden="true">9.3.</strong> Identity</a></li><li><a href="trait-def/sec/access-rule.html"><strong aria-hidden="true">9.4.</strong> AccessRule</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar" class="menu-bar">
                    <div id="menu-bar-sticky-container">
                        <div class="left-buttons">
                            <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                                <i class="fa fa-bars"></i>
                            </button>
                            <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                                <i class="fa fa-paint-brush"></i>
                            </button>
                            <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                                <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                            </ul>
                            
                            <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                                <i class="fa fa-search"></i>
                            </button>
                            
                        </div>

                        <h1 class="menu-title">[DRAFT] Splot Design Documentation</h1>

                        <div class="right-buttons">
                            <a href="print.html" title="Print this book" aria-label="Print this book">
                                <i id="print-button" class="fa fa-print"></i>
                            </a>
                            
                        </div>
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#splot-design-documentation" id="splot-design-documentation">Splot Design Documentation</a></h1>
<p><em>Splot</em> is an exploratory effort to develop an <a href="./som/intro.html">object
model</a> and <a href="./smcp/intro.html">applicaiton protocol</a> that allows IoT devices to be used in ways
unconstrained by the imagination of the device manufacturer or software
developer, with the goal of improving the long-term value of such devices.</p>
<blockquote>
<p>Note: This document is a work-in-progress and is subject to change at any time.</p>
</blockquote>
<p><em>Splot is not an official Google project.</em></p>
<hr />
<p>Copyright © 2019 Google LLC</p>
<p>Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
you may not use this file except in compliance with the License.
You may obtain a copy of the License at</p>
<p><a href="https://www.apache.org/licenses/LICENSE-2.0">https://www.apache.org/licenses/LICENSE-2.0</a></p>
<p>Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.</p>
<h1><a class="header" href="#introduction" id="introduction">Introduction</a></h1>
<p>An ongoing problem in the IoT industry is early unexpected
obsolescence: there are many documented cases where shortly after a
product’s release the manufacturer either got acquired, went out of
business, or simply decided to no longer maintain the infrastructure
required to support a product: resulting in all of the devices being
rendered effectively useless. In some cases this results in
significant financial burden if the company wants to maintain goodwill
in the brand by buying-back the useless devices. In all cases it
represents an additional electronic-waste disposal burden.</p>
<p>Even when the device is fully functional on a well-supported
ecosystem, end-users may want to use their devices in ways that the
manufacturer did not anticipate. For example, ZigBee Light-Link
remote-controls are only capable of controlling things that describe
themselves as ZigBee Light-Link lights—in general, you cannot
repurpose such a controller to instead adjust your television volume,
for example.</p>
<p>In much the same way that a manufacturer of power switches does not
specify what kind of device it can power on or off, <em>Splot</em> represents
an exploratory effort to improve the long-term value of IoT devices by
allowing them to be used in ways not limited by the imagination of
the device manufacturer or software developer. Stated more succinctly:</p>
<blockquote>
<p>IoT device software should not need to know anything specific about
other IoT devices in order to be configured to usefully interact.</p>
</blockquote>
<p>This document elaborates on the implications of this precept as
&quot;Splot&quot;, along with all of the related pieces to turn it into a workable
collection of standards.</p>
<p>&quot;Splot&quot; is a Polish noun meaning &quot;weave&quot; or &quot;tangle&quot;.</p>
<h1><a class="header" href="#design-goals" id="design-goals">Design Goals</a></h1>
<p>An ideal IoT application technology would satisfy the following goals:</p>
<ul>
<li>Flexible enough to be considered relatively “future-proof”</li>
<li>Automatable without requiring extra hardware or internet access</li>
<li>Defined as an open standard with at least one open-source
reference implementation</li>
<li>Simple enough that can be implemented on highly-constrained devices</li>
<li>Secure, honoring the principle of least privilege.</li>
<li>Suitable for residential, commercial, and industrial environments</li>
<li>Include proper support for groups, scenes, and smooth transitions (where
appropriate)</li>
</ul>
<p>Splot is an exploratory attempt to bridge these requirements into a single
cohesive technology and application protocol with the following goals:</p>
<ul>
<li>Secure, low-latency monitoring and control of (potentially
constrained) networked devices</li>
<li>Elegant support for scenes, groups/rooms, and smooth transitions</li>
<li>Expressive and reliable device-to-device automation</li>
</ul>
<p>In addition satisfying these goals, the <a href="./som/intro.html">SOM</a> was designed, to the extent
practical, to express a superset of functionality commonly provided
by other existing IoT protocols, making it reasonably efficient to
monitor and control non-SOM-based using a SOM-based API. This
feature allows for the straightforward implementation of adaptation
layers and enables cross-protocol automation.</p>
<!--
One of the key design mandates of Splot is that IoT device software
should not have to know anything about other IoT devices in order to
be configured to usefully interact with them. Splot delegates that
job of to the *management application*.

For advanced users and professionals, Splot devices can be configured
manually (by hand) using the appropriate low-level utility applications.
However, most users will use a *management application* (either on a
smart phone or via the cloud) to commission, configure, monitor and
control Splot devices.
-->
<h2><a class="header" href="#terminology" id="terminology">Terminology</a></h2>
<p>The key words &quot;MUST&quot;, &quot;MUST NOT&quot;, &quot;REQUIRED&quot;, &quot;SHALL&quot;, &quot;SHALL NOT&quot;,
&quot;SHOULD&quot;, &quot;SHOULD NOT&quot;, &quot;RECOMMENDED&quot;, &quot;MAY&quot;, and &quot;OPTIONAL&quot; in this
document are to be interpreted as described in <a href="https://tools.ietf.org/html/rfc2119">RFC2119</a>.</p>
<p>This specification makes use of the following terminology:</p>
<p>action
: A behavior triggered by some criteria that manipulates a resource
in the configured way.</p>
<p>group
: A collection of <em>things</em> that can be controlled as though it
were a single thing.</p>
<p>management application
: An application on a computer, smart-phone, or the cloud, that provides
a user-friendly interface for monitoring, controlling, configuring, and
automating Things.</p>
<p>method
: A named function/action that a <em>thing</em> can be directed to perform,
optionally taking a set of named arguments and returning a value.
Each method is defined by a <em>trait</em>.</p>
<p>property
: A named value associated with a <em>thing</em> that can be
fetched, monitored and/or controlled. Each property is defined by
a <em>trait</em>.</p>
<p>resource
: The underlying object identified by a URI.</p>
<p>section
: <em>Properties</em> are categorized into sections, similar to how one might
categorize files into folders. Each property belongs to a single
section, of which there are three: <em>state</em>, <em>config</em>, and <em>metadata</em>.</p>
<p>SMCP
: Abbreviation for Splot Monitoring and Control Protocol, an application
protocol that is based on the SOM (Splot Object Model).</p>
<p>SOM
: Abbreviation for Splot Object Model.</p>
<p>technology
: <em>WRITEME</em></p>
<p>thing
: An abstraction of a physical or virtual mechanism, sensor, or
automation. Physical devices can host one or more <em>things</em>.</p>
<p>trait
: A named collection of related <em>property</em> and <em>method</em> definitions.
<em>Things</em> implement properties and methods that are defined by traits.</p>
<p>trait-profile
: A named collection of <em>properties</em> and/or <em>methods</em> that a
thing can advertise itself as implementing. These <em>properties</em> and
<em>methods</em> can belong to one or more <em>traits</em>.</p>
<p>UID
: Unique ID. A short, administratively-assigned, opaque identifier that
uniquely identifies a Thing in an administrative scope.</p>
<h1><a class="header" href="#splot-object-model" id="splot-object-model">Splot Object Model</a></h1>
<p>The Splot Object Model is a collection of interfaces for monitoring
and controlling things. It defines the general mechanisms and nomenclature
for how network-connected things can be described, configured, monitored,
and automated.</p>
<p>Keep in mind that while the SOM informs the design of Splot-based APIs
and protocols, it is only an object model: It defines vocabulary,
concepts, and object relationships. It is not an IoT application
protocol; it is a framework for describing and interacting with IoT
devices in a uniform way.</p>
<p>The SOM-native application protocol, <a href="som/../smcp/intro.html">SMCP</a>, is defined in a
separate chapter, but other IoT application protocols can be adapted
to be monitored, controlled, and automated in terms of the SOM.</p>
<h2><a class="header" href="#architecture" id="architecture">Architecture</a></h2>
<p><img src="som/splot-object-model.svg" alt="Splot Object Model UML Diagram" /></p>
<p>Breaking this down:</p>
<ul>
<li>A <em>physical device</em> can host one or more <em>things</em>.</li>
<li>A <em>thing</em> can have multiple <em>properties</em> and <em>methods</em>, each
defined by a <em>trait</em>.</li>
<li>A <em>thing</em> can host other <em>things</em> that it owns (children).</li>
<li>While not illustrated in the previous diagram, each child is
associated with a single trait on its parent, in much the same way
that properties and methods are.</li>
</ul>
<h3><a class="header" href="#things" id="things">Things</a></h3>
<p>Things are the fundamental control surface objects in the SOM.
Physical devices host one or more Things.</p>
<p>Things provide:</p>
<ul>
<li><em>Properties</em> that can be monitored, changed, or mutated</li>
<li><em>Methods</em> that take named arguments and return values</li>
<li>Child things (<em>children</em>) which it owns and manages</li>
</ul>
<p>Some hypothetical examples of Things and their relationship to
physical devices:</p>
<ul>
<li>A smart light bulb that hosts a single Thing that is used to
control and monitor the state of the light bulb.</li>
<li>A smart power strip that hosts one Thing per outlet, used to
control the state of each outlet and monitor power usage.</li>
<li>A proprietary wireless sensor gateway hosting one (or more) Things
for each associated wireless sensor, used to monitor temperature
and humidity.</li>
<li>A device could have any number of automation primitives, with each
one being a thing.</li>
</ul>
<h2><a class="header" href="#properties" id="properties">Properties</a></h2>
<p>Properties are the primary mechanism by which a thing can be monitored
and controlled. Each property has a value type associated with it. The
types are roughly those defined by <a href="https://tools.ietf.org/html/rfc7049">CBOR</a>:</p>
<ul>
<li>Number (Integer or Floating-Point)</li>
<li>Text String</li>
<li>Byte String</li>
<li>Boolean</li>
<li>Array</li>
<li>Map</li>
<li>URI-Reference</li>
</ul>
<p>The actual value of a property may be one of these types or <code>null</code>,
the meaning of which is outlined by the trait that defines the
property.</p>
<p>Each property has an identifier, which is a short string (typically
four characters long) that uniquely identifies the property with its
scope.</p>
<h3><a class="header" href="#sections" id="sections">Sections</a></h3>
<p>Sections organize properties in a thing based on their usage and
intended purpose. There are three sections:</p>
<ul>
<li><strong>State</strong> properties describe/control what the Thing is currently
doing or recently done.</li>
<li><strong>Config</strong> properties control how the Thing works.</li>
<li><strong>Metadata</strong> properties describe what the Thing is and how it might
behave, independently of what the current configuration or state
is.</li>
</ul>
<p>Properties in the state section are the only properties that can be
saved in a Scene or smoothly transitioned from one value to
another.</p>
<p>Each section is associated with a single character used to identify
the section:</p>
<ul>
<li>&quot;<code>s</code>&quot;: State</li>
<li>&quot;<code>c</code>&quot;: Configuration</li>
<li>&quot;<code>m</code>&quot;: Metadata</li>
</ul>
<h3><a class="header" href="#property-keys" id="property-keys">Property Keys</a></h3>
<p>Properties are uniquely identified by a tuple of the section,
trait-id, and property-id, which is called a <em>property key</em>.
Property keys are written as a string in the form of
<code>&lt;section-id&gt;/&lt;trait-id&gt;/&lt;property-id&gt;</code>; e.g.:</p>
<ul>
<li><code>s/onof/v</code>: On/off state value (boolean)</li>
<li><code>s/levl/v</code>: Level value (float)</li>
<li><code>c/enrg/mxam</code>: Maximum allowed amps (float)</li>
<li><code>m/base/name</code>: Administratively assigned name (String)</li>
</ul>
<p>A convention of using four or fewer letters has been adopted in order
to reduce packet sizes, but this is not a hard rule. Obviously longer,
more descriptive identifiers would improve casual comprehension, but
at the cost of wasted bytes.</p>
<p>Properties may be broadly described as being read-only, read-write,
or write-only, although there are additional attributes.</p>
<!--
### Property Definition Attributes ##

Traits can further describe properties using the following set of
boolean attributes:

*   `REQ` : This property *MUST* be implemented for this trait.
*   `GET` : A getter is required if this property is implemented.
*   `OPT_GET` : A getter is optional if this property is implemented.
*   `NO_GET`: A getter is prohibited if this property is implemented.
*   `SET` : A setter is required if this property is implemented.
*   `OPT_SET` : A setter is optional if this property is implemented.
*   `NO_SET`: A setter is prohibited if this property is implemented.
    This is useful for integers representing enumerated values.
*   `RESET`: This property is reset (e.g. a counter) to the same value
    by any write.
*   `VOLATILE`: This property should never be stored and recovered
    from non-volatile memory.
*   `NO_TRANS` : This property should not be smoothly transitioned
    between values.
*   `NO_MUTATE`: This property should not allow itself to be mutated.

Additionally, some attributes are defined as combinations of the above
single attributes:

*   `RO` (read only): `GET` | `OBS` | `NO_SET`
*   `RW` (read/write): `GET` | `SET` | `OBS`
*   `WO` (write only): `SET` | `NO_MUTATE`
*   `CONST` (constant value): `GET` | `NO_SET`
*   `ENUM` (enumeration): `NO_TRANS` | `NO_MUTATE`

-->
<h2><a class="header" href="#methods" id="methods">Methods</a></h2>
<p>Methods are a way to manipulate a thing in ways that would not
translate well to being represented with properties. The most common
example is for creating new child things, but the mechanism is defined
to be open-ended.</p>
<p>Methods take a named set of arguments as input and are defined to
output a single value or indicate an error. Arguments are identified
by a short string rather than by their order. Arguments and return
values share the same set of value types that are used by properties,
with the addition that an method may return a direct reference to a
child thing. (This is used to return created or updated child things).</p>
<p>Methods are defined by traits just like properties are. The trait
defines what the named arguments are, what their types should be,
which arguments are required, and what the method return type will be.</p>
<p>Just like properties, methods are scoped by trait. They have a special
section designated &quot;<code>f</code>&quot;(This scope gets double-duty in SMCP with also
handling child things, but I digress). The short-identifiers of the
scope, trait, and method are combined similarly to properties, except
that the second slash is instead a question mark:</p>
<ul>
<li><code>f/scen?save</code>: Save current state to a new or existing scene</li>
<li><code>f/gmgr?create</code>: Create a new group</li>
</ul>
<!--

## Method Definition Attributes ##

Like properties, traits can also specify attributes as a part of the
method definition. However, there are relatively few:

*   `REQ`: This method is required to be implemented.
*   `GID`: If invoked via a group, add the group id to the arguments.

--><h2><a class="header" href="#traits" id="traits">Traits</a></h2>
<p>Specific properties and methods are defined by <em>Traits</em>. A
<em>Thing</em> can implement properties and methods from several
traits. <a href="som/children.html">Children</a> are also scoped to specific traits.</p>
<p>A Trait is a set of properties and methods that are related to a
purpose. For example, the <a href="som/../trait-def/std/on-off.html">OnOff</a> trait provides the concept of being
on or off, whereas the <a href="som/../trait-def/std/level.html">Level</a> trait provides the concept of a dimmer
switch or volume knob. These traits expose distinct behaviors that
are independent from the <a href="som/../trait-def/std/light.html">Light</a> trait which
provides additional properties for correlated color temperature and
sRGB values, but none that are suitable substitutes for the properties
provided by <em>OnOff</em> and <em>Level</em>: the Light trait is designed to be used
alongside these traits.</p>
<p>Some traits, like the <a href="som/../trait-def/core/scene.html">Scene</a> trait, define children. In the case
of the Scene trait, each child <em>thing</em> represents a scene that can be
recalled, modified, or deleted. A &quot;save&quot; method is also provided by
the trait to allow the current state to be saved to a new or existing
scene.</p>
<p>Traits are scoped to be as general as practical so that they can be
applied to many different sorts of <em>things</em>. For example,
the <a href="som/../trait-def/std/level.html">Level</a> trait could be applied to a light bulb to control dimming,
or applied to a ceiling fan to control speed, or to a window
controller to control how far open the window is.</p>
<p>Each trait is defined to have both a human-readable name (<a href="som/../trait-def/std/on-off.html">OnOff</a>,
<a href="som/../trait-def/std/level.html">Level</a>, <a href="som/../trait-def/sec/keychain.html">Keychain</a>), a short trait-id (&quot;<code>onof</code>&quot;, &quot;<code>levl</code>&quot;,
&quot;<code>keyc</code>&quot;), and a unique URI identifier.</p>
<h2><a class="header" href="#trait-definitions" id="trait-definitions">Trait Definitions</a></h2>
<p>Traits definitions are specified in a JSON format. This trait
definition can then be translated into either markdown documentation,
Rust, or Java using the <code>som-trait-conv</code> tool.</p>
<p>Splot provides the following collections of trait definitions:</p>
<ul>
<li><a href="som/../trait-def/core/intro.html"><em>Core Traits</em></a> (<code>core</code>): Traits which are fundamental to the Splot Object Model.</li>
<li><a href="som/../trait-def/std/intro.html"><em>Standard Traits</em></a> (<code>std</code>): Traits which represent behaviors which are common
enough to be standardized.</li>
<li><a href="som/../trait-def/auto/intro.html"><em>Automation Traits</em></a> (<code>auto</code>): Traits related to automation.</li>
<li><a href="som/../trait-def/sec/intro.html"><em>Security Traits</em></a> (<code>sec</code>): Traits related to the Splot Security Model.</li>
</ul>
<h2><a class="header" href="#children" id="children">Children</a></h2>
<p>A trait's definition can indicate if it has child things,
and, if so, how those things behave and what
traits the children themselves implement.</p>
<p>For example, the scene trait allows a thing to save the
values of the properties in its state section and associating them
with a scene-id. The scene itself is represented as a child thing
that can be manipulated independently.</p>
<p>Each child thing can be identified by a combination of
the trait identifier and a child-id.</p>
<p>For example, if I used <code>f/scen?save</code> to create a scene with a scene-id
(child-id) of <code>evening</code>, the resulting child would be identified by
the tuple (<code>scen</code>, <code>evening</code>).</p>
<p>The exact mechanism for how you reference children is implementation
specific, but in <a href="som/./smcp/intro.html">SMCP</a> for example, it would be referenced as
<code>f/scen/evening/</code>, relative to the parent.</p>
<p>The nesting of child things is allowed.</p>
<h2><a class="header" href="#trait-profiles" id="trait-profiles">Trait Profiles</a></h2>
<p>A trait profile is a named, versioned set of required-to-implement
traits and an associated list of required-to-implement properties and
methods from those traits. When a thing indicates that it supports a
given trait profile, it is promising that it fully supports all of the
properties and methods that the trait profile requires.</p>
<p>Trait profiles provide a way for software to quickly classify the
functionality of a thing and ensure that certain types of things have
the appropriate minimal level of common functionality to ensure they
meet user expectations.</p>
<p>For example, a trait profile for a &quot;Dimmable Lamp&quot; might require the
<a href="som/../trait-def/core/base.html"><code>Base</code></a>, <a href="som/../trait-def/std/on-off.html"><code>OnOff</code></a>, <a href="som/../trait-def/std/level.html"><code>Level</code></a>, <a href="som/../trait-def/std/energy.html"><code>Energy</code></a>, and <a href="som/../trait-def/std/light.html"><code>Light</code></a> traits, additionally
requiring some additional subset of the optional properties from those
traits to be implemented. The trait profile for a &quot;Full-Color Lamp&quot;
would require the exact same traits but also include an expanded list
of required-to-implement properties from those traits. A thing can
implement more than one trait profile, and some trait profiles require
that other specific trait profiles also be supported.</p>
<h2><a class="header" href="#groups" id="groups">Groups</a></h2>
<p>A group is a collection of things (members) which can be
controlled as a single thing.</p>
<p>Groups are always owned by a <a href="som/technology.html">technology</a>.
Members of a group must be associated with that group's
technology.</p>
<p>The state section of a group is special in that
any operation performed on it will be
applied to the state section of all of the group's members.</p>
<p>By comparison, the configuration and metadata sections belong to the
group itself. Thus, it is not possible to change a configuration or
metadata property across the members of a group in a single operation
like you can with state properties.</p>
<p>The behavior of reading state properties on a group is currently
undefined by the SOM and thus the behavior is technology-specific.
This may change at some point.</p>
<h1><a class="header" href="#technologies" id="technologies">Technologies</a></h1>
<p>A Technology is a type of object that enables a software program to
do one or more of the following fundamental operations:</p>
<ul>
<li>Discover new things</li>
<li>Host things for other things/devices to use</li>
<li>Manage groups, automation primitives, and security contexts</li>
</ul>
<p>A Technology instance could be thought of as a Splot-colored window
into the world of a specific IoT application protocol.</p>
<p>For example, using a SMCP-based technology would allow a software
program to discover, monitor, and control SMCP-based devices.
Likewise, using a ZigBee-based Technology instance will allow a
software program to discover, monitor and control ZigBee-based
devices, providing a SOM-compliant interface to the ZigBee world.</p>
<p>While not a fundamental SOM type, the concept of a Technology is
nonetheless an important concept to understand since groups,
automation primitives, security contexts, and UIDs are all
technology-scoped.</p>
<p>The Things discovered using a Technology instance and things hosted
by that Technology instance are in the same URL-space.</p>
<p>From a software perspective, a <em>Thing</em> is just an interface to an
object. Consider, for example, a fake on/off switch that implemented
the <em>thing</em> interface. It wouldn't need anything else to be usable
<em>within the process that created it</em>.</p>
<p>Things that implement automation primitives are different. They need
a window into the world around them because some of their properties
contain URLs that they need to monitor and/or change. Thus, automation
primitives cannot exist in a vacuum, instances are always be associated
with a technology instance. Specifically, they need a way to perform REST
operations on arbitrary URLs.</p>
<p>Group things are even more tightly related to technologies: they don't
ideally just exist on one device, they exist across all devices that
have things in them, and potentially many more.</p>
<p>Taking a thing that is discovered from one
technology instance and then hosting that on a separate technology
is called &quot;bridging&quot;.</p>
<!--
Things alone have no concept of a URL, either their own or how to
look-up the value of a resource that a URL might refer to.

A thing, created locally in a process, can be
monitored and controlled within the process that created it,
but the thing itself has no URL until it is *hosted*.

For programs where the intent isn't to host but to monitor and
control, some owning object instance that you
can use to discover other things.


The object
that hosts a thing so that it may be used by other devices is
called a *Technology*.

From the perspective of a software developer, a Technology
is a type of object that enables a software program to do
one or more of the following:

Whereas *things* are objects that you directly interact
with using a IoT protocol, a technology object represents the actual
implementation of that protocol.



In the SOM, technologies are considered separate from the things
that they provide or host. For example, Let's say we had a
technology instance (SmcpTechnology) which enables us to use
things that are hosted using SMCP on other devices as
well as enabling us to host our own things for other
devices to use.

To host a thing for other devices to use, you simply
command the technology to host a given thing instance.
Before that moment, the two objects were entirely unrelated. The key
point is that it doesn't matter where that thing
instance came from: it could be a locally created thing
or it could be a thing that was discovered by a
different technology.



The relationship between any given thing and a given
technology can be described by one of the following terms: *native*,
*hosted*, or *unrelated*:

*   A **native** thing is owned and managed entirely
    within a technology, and often represents functionality which is
    implemented on a different device.
*   A **hosted** thing is not owned or managed by the
    technology. Instead, the technology "hosts" the functionality of
    the thing for other devices to use.
*   An **unrelated** thing has no relationship with the
    technology. Such a thing cannot be used by the
    technology or participate in groups hosted by the technology.

If a thing is either hosted-by or native-to a
technology, it is said to be "associated" with that technology.

In most cases, a thing is described by only one of the
above three labels. However, things representing groups
are *always* native to a Technology, but are are often also hosted by
the same Technology. This is because groups logically exist on more
than one device, so they can be both native and (if any hosted
things are members) hosted.
-->
<h1><a class="header" href="#automation" id="automation">Automation</a></h1>
<p>One of the key design goals for Splot was to support the use of
in-band-configurable automation primitives, enabling complex
device-to-device relationships that have no external dependencies once
configured.</p>
<p>Automation primitives can act like virtual wires, making
properties on different devices dependent on each other, or they can
act as scheduled timers that trigger actions at programmable times of
the week.</p>
<p>Additionally, since these automation primitives are defined
in terms of simple JSON/<a href="https://tools.ietf.org/html/rfc7049">CBOR</a> values and REST-ful actions on URLs, they
can even be used to automate devices which have a RESTful interface
but don’t use the Splot Object Model.</p>
<h2><a class="header" href="#primitives" id="primitives">Primitives</a></h2>
<p>Splot Automation Primitives are themselves Things, meaning they can be
created and then configured in-band just like any other Thing.</p>
<p>Splot currently defines three types of “standard” automation
primitives:</p>
<ul>
<li>Pairings</li>
<li>Rules</li>
<li>Timers</li>
</ul>
<p>Ultimately, the automation primitives described here are experimental.
There is always room for improvement and changes in behavior should be
expected until the protocol stabilizes.</p>
<h2><a class="header" href="#pairings" id="pairings">Pairings</a></h2>
<p>Pairings are automation primitives that connect two <a href="https://tools.ietf.org/html/rfc2616#section-5.2">resources</a>, which
are referred to as the <em>source</em> and <em>destination</em>. Changes observed to
the source resource can be automatically applied to the destination
resource, and vise-versa.</p>
<p>In <em>forward propagation</em>, changes observed to the source are applied
to the destination.
In <em>reverse propagation</em>, changes observed to the destination are applied
to the source. Both propagation modes can be enabled simultaneously,
allowing for resource value synchronization.</p>
<p>In addition to basic value mirroring, two custom transforms can be
specified: a <em>forward transform</em> that is applied to changes from the
source to the destination, and a <em>reverse transform</em> that is applied
to changes from the destination to the source. These transforms
are written using the expression language outlined in (#sae).</p>
<p>All pairings implement the <em>AutomationPairing</em> trait, described
in (#trait-automation-pairing).</p>
<h3><a class="header" href="#rules" id="rules">Rules</a></h3>
<p>Rules are actionable automation primitives that consist of one or more
<em>conditions</em>. Each condition can evaluate to &quot;true&quot; or &quot;false&quot;. A rule
can be configured to trigger when ALL conditions match or when ANY
condition matches.</p>
<p>A condition monitors a specific URI value and defines how that value
should be interpreted in the form of a Splot Automation Expression, as
described above. Similar to pairings, the previous value is pushed
onto the stack before the current value: allowing for edge triggers.</p>
<h2><a class="header" href="#timers" id="timers">Timers</a></h2>
<p>Timers are actionable automation primitives that allow you to
implement the following types of time-based actions:</p>
<ul>
<li>One-off timers</li>
<li>Repeating timers</li>
<li>Scheduled timers</li>
</ul>
<p>The behavior of a timer is ultimately defined by two Splot Automation
Expressions:</p>
<ul>
<li>Schedule</li>
<li>Predicate</li>
</ul>
<p>Evaluating the schedule expression yields the number of seconds to
wait until the predicate expression should be evaluated. If the
predicate expression evaluates to <em>true</em> then the action(s) are
triggered. Otherwise, the schedule expression is re-evaluated and the
timer resets.</p>
<p>While this is more than enough for one-off timers and repeating
timers, it does not itself allow you to schedule events. To enable
that, Splot Automation Expressions supports several operations for
probing a real-time-clock:</p>
<ul>
<li><code>c</code>: The number of times this timer has fired since it was last
reset.</li>
<li><code>rtc.y</code>: Pushes Gregorian year.</li>
<li><code>rtc.dow</code>: Pushes Day of week. 0-6. Monday is 0, Sunday is 6.</li>
<li><code>rtc.dom</code>: Pushes Day of month. Zero-based Integer, 0-30.</li>
<li><code>rtc.tod</code>: Pushes Time of day, in fractional hours. 0.000 -
23.999.</li>
<li><code>rtc.moy</code>: Pushes Current month. zero-based Integer, 0 = January,
11 = December</li>
<li><code>rtc.awm</code>: Aligned week of month. Pushes Number of times this
weekday has happened this month. zero-based Integer.</li>
<li><code>rtc.wom</code>: Pushes Week of month. zero-based Integer.</li>
<li><code>rtc.woy</code>: Pushes Week of year. zero-based Integer, 0-51. Week
starts on monday.</li>
<li><code>H&gt;S</code>: Convert hours to seconds.</li>
<li><code>D&gt;S</code>: Convert days to seconds.</li>
</ul>
<p>The combination of a schedule expression and a predicate expression
allow for the evaluation of very complex schedules (like easter) even
on constrained devices. The schedule expression is used to determine
<em>when</em> to check the predicate, whereas the predicate is used to
determine if it is indeed the right time.</p>
<p>For example, to schedule an event to happen at 1:30pm every second
Wednesday of the month, you could use the following expressions:</p>
<ul>
<li>schedule: <code>&quot;13.5 rtc.tod - 24 % H&gt;S&quot;</code> (Seconds until the next
1:30pm)</li>
<li>predicate: <code>&quot;2 rtc.dow == 1 rtc.awm == &amp;&amp;&quot;</code> (Is it the second
Wednesday of this month?)</li>
</ul>
<p>This will cause the predicate to be evaluated every day at 1:30pm.
When the predicate finally evaluates to true on the second Wednesday
of the month, the actions are triggered.</p>
<h2><a class="header" href="#actionable-primitives" id="actionable-primitives">Actionable Primitives</a></h2>
<p>Rules and Timers are both actionable automation primitives, meaning
that they when either are &quot;triggered&quot; they invoke actions. The
machinery and interface that performs these actions is identical
between the two. When an actionable automation primitive is triggered,
it performs zero or more &quot;actions&quot;. You can think of an action as
similar to a <a href="https://en.wikipedia.org/wiki/Webhook">webhook</a>.</p>
<p>An action is specified by the following important parameters:</p>
<ul>
<li>A URI. Required.</li>
<li>A REST method (PUT, POST, DELETE, etc) to perform on that URI.
Optional: defaults to POST.</li>
<li>A body to pass along while performing the method. Optional:
defaults to empty.</li>
<li>An enumeration value that determines if the action should be
evaluated synchronously or asynchronously, as well as what to do
in the event of an error. Optional: defaults to asynchronous
firing (later actions don't wait for this action to finish before
firing).</li>
<li>Security context information. Optional: defaults to no security
context.</li>
</ul>
<h2><a class="header" href="#splot-automation-expressions" id="splot-automation-expressions">Splot Automation Expressions</a></h2>
<p>Pairing transforms are specified using Splot Automation Expressions, a
specialized postfix (Reverse polish notation) language that is
expressed as a string. The language was designed to be expressive yet
simple to implement on highly-constrained devices.</p>
<p>For pairing transformations, the value being transformed is initially pushed
onto the stack and the last value on the stack after evaluation is the
output fo the expression.</p>
<p>The syntax is somewhat similar to forth, but unlike forth all numeric
values are considered floating-point.</p>
<p>For example, the following transform would apply <em>x²</em> to source
values before they are applied to the destination:</p>
<ul>
<li><code>&quot;2 ^&quot;</code> (or <code>&quot;DUP *&quot;</code>)</li>
</ul>
<p>If the pairing was bidirectional, then the reverse transform for the
above expression would be:</p>
<ul>
<li><code>&quot;0.5 ^&quot;</code></li>
</ul>
<p>In this case we are raising <em>x</em> to the power of 0.5, which reverses
raising it to the power of two from the forward transform.</p>
<p>This example was fairly simple, but much more complex transforms are
possible. For example, the infix expression <em>(cos(x/2 - 0.5) + 1)/2</em>
would become <code>&quot;2 / 0.5 - COS 1 + 2 /&quot;</code>. (Note that currently, the
trigonometric operations use <em>turns</em> instead of <em>radians</em>)</p>
<p>In cases where an expression is used on an input, the previous input
can be pushed on the stack using <code>v_l</code>. This allows for things like
edge detection and determining the direction of a change. For
convenience, the current input can also be pushed onto the stack using
<code>v</code>.</p>
<p>The ability to handle arrays and dictionaries is also specified. For
example, imagine that we have a color light and a text display. Our
goal is to display the <a href="https://en.wikipedia.org/wiki/Color_temperature#Approximation">approximate correlated color temperature
(CCT)</a> of the light on the text display in Kelvin. However,
in this example, the color light only gives us the <a href="https://en.wikipedia.org/wiki/CIE_1931_color_space#CIE_xy_chromaticity_diagram_and_the_CIE_xyY_color_space">CIE xy
chromaticity coordinates</a> in the form of an array with two
floating point values. We can start by creating a pairing between the
CIE xy coordinates and the text display value. To get the right
transformation expression, we first have to have the infix expression:</p>
<ul>
<li><em>CCT(x, y) = -449n³ + 3525n² - 6823.3n + 5520.33</em></li>
<li>where <em>n = (x − 0.332)/(y - 0.1858)</em></li>
</ul>
<p>By using the <code>POP</code> operation to remove the last item from an array on
the stack and push that value onto the stack, we end up with the
following expression:</p>
<pre><code>POP 0.1858 -
SWAP POP 0.3320 -
SWAP DROP SWAP /
-449 3525 -6823.3 5520.33 POLY3
</code></pre>
<p>Arrays can be built by pushing values onto the stack and invoking one
of the array creation operators:</p>
<ul>
<li><code>[]</code> Pushes an empty array onto the stack.</li>
<li><code>[1]</code> Pops the last value off of the stack, puts it into an array,
and pushes that array onto the stack.</li>
<li><code>[2]</code> Pops the last two values off of the stack, puts them into an
array, and pushes that array onto the stack.</li>
<li><code>[3]</code> Pops the last three values off of the stack, puts them into
an array, and pushes that array onto the stack.</li>
<li><code>[4]</code> Pops the last four values off of the stack, puts them into
an array, and pushes that array onto the stack.</li>
</ul>
<p>Dictionaries (json &quot;objects&quot;) can also be read and written. The
following expression calculates the vector length for an input vector
specified as <code>{&quot;x&quot;:12,&quot;y&quot;:14}</code>:</p>
<pre><code>:x GET DUP * SWAP :y GET DUP * SWAP DROP + 0.5 ^
</code></pre>
<p>A dictionary can be created by putting it together value-by-value. For
example, the following expression takes an input of &quot;turns&quot; and
converts that to a vector:</p>
<pre><code>{} OVER COS :x PUT OVER SIN :y PUT
</code></pre>
<p>If you wanted to do something similar with arrays, you have two options:</p>
<ul>
<li><code>[] OVER COS PUSH OVER SIN PUSH</code></li>
<li><code>DUP COS SWAP SIN [2]</code></li>
</ul>
<h2><a class="header" href="#automation-recipes" id="automation-recipes">Automation Recipes</a></h2>
<p>It is not expected that end users would directly configure automation
primitives by hand---although they certainly could do that if they
wanted to. The expected way is that you would have applications (either
on your phone or in the cloud) that would configure and maintain these
automation pairings for you. Such applications can store some metadata
along with the automation primitives they are in charge of to help their
software make sense of them. There are also properties where such
applications are encouraged to include human-readable descriptions
and comments.</p>
<p>Recipes are instructions that enable management applications to
to create, manage, and update complex automation primitive chains.
They describe the complex relationships between concrete things and
automation-primitives required to implement arbitrary behaviors.</p>
<p>Examples of recipes might include:</p>
<ul>
<li>Press a button and cause all lights in a room to slowly fade down to
a value of 0% with a color temperature of ~2000 K over a period of
two minutes before turning off entirely.</li>
<li>Use a motion sensor to automatically pause any ongoing lawn irrigation
when motion is detected on the sidewalk, resuming 10 seconds after motion
was last detected.</li>
<li>Use multiple motion sensors to control the lights in a room.</li>
<li>Automatically display &quot;oven-on&quot; notifications on smart displays near the
kitchen when the oven is turned on, showing the current temperature in
the notification and allowing the user to turn the oven off directly from
the notification.</li>
</ul>
<p>A recipe instance is a particular instantiation of a recipe. A recipe
can be used multiple times to create multiple recipe instances. For example,
you may want to use the &quot;fading-down&quot; recipe above in multiple rooms. In
such a case, each room would have one independent instance of the recipe.</p>
<p>The exact recipe specification remains TBD, but here are the general design goals:</p>
<ul>
<li>Recipes are stored as JSON, in a format described by a JSON schema.</li>
<li>Recipe instances should require no local state on the management application
that cannot be reconstructed by examining the metadata and configuration of the
automation primitives that the recipe instance created. In other words,
any automation primitive created by a recipe should contain enough information
to identify what recipe created it, what part it plays in the recipe, and
what logical recipe instance it is associated with.</li>
<li>Recipes should be upgradable and specify a logical way to transition an older
recipe instance to a later version. Migration shouldn't be something users
have to worry about.</li>
</ul>
<p>Recipes will have the following structure:</p>
<ul>
<li>A unique identifier</li>
<li>A version number which is incremented at each revision.</li>
<li>A list of prerequisite things, each having:
<ul>
<li>An internal identifier string.</li>
<li>A list of required metadata fields.</li>
</ul>
</li>
<li>A list of configuration parameters which can be used to change the
behavior of the recipe:
<ul>
<li>An internal identifier string.</li>
<li>The type of the parameter
<ul>
<li>String
<ul>
<li>Direct Entry (with input validation)</li>
<li>Pulldown-box</li>
</ul>
</li>
<li>Numbers (Real/Integer)
<ul>
<li>Direct Entry (with input validation)</li>
<li>Slider in range</li>
<li>Pulldown-box</li>
</ul>
</li>
<li>Color</li>
<li>Angle</li>
<li>Duration (in seconds)</li>
<li>Schedule (one-off, repeating, etc)</li>
<li>Boolean checkbox</li>
</ul>
</li>
<li>The default value of the parameter.</li>
</ul>
</li>
<li>A list of created things, each having:
<ul>
<li>An internal identifier string.</li>
<li>A list of property values to set, each could be a:
<ul>
<li>Constant value</li>
<li>Value derived from prerequisite thing URI</li>
<li>Value derived from recipe configuration</li>
</ul>
</li>
</ul>
</li>
<li>A list of version migration instructions, each having:
<ul>
<li>Range of version numbers supported</li>
<li>Mapping of changed parameters</li>
<li>Mapping of changed prerequisite things</li>
<li>Default values for new parameters (may be calculated
dynamically)</li>
</ul>
</li>
</ul>
<h1><a class="header" href="#pulling-it-all-together" id="pulling-it-all-together">Pulling it All Together</a></h1>
<p>Let's say we've got a SMCP-compatible device that has two buttons, and
we want to use it to control the brightness of an SMCP-compatible
lightbulb. Here is what we want to happen from a user perspective:</p>
<ul>
<li>One button dims the light, the other button makes it brighter.</li>
<li>Holding down a button causes the brightness to change continuously
until the button is released.</li>
</ul>
<h2><a class="header" href="#first-attempt" id="first-attempt">First Attempt</a></h2>
<p>There are several different ways to do this. One inefficient way
that we can implement this uses two timers, two pairings, and a rule:</p>
<ul>
<li>Two timers, one for increasing brightness, one for decreasing
brightness.</li>
<li>Two pairings, connecting the button state to the two timers.</li>
<li>One rule, triggering when one of the buttons is released and
freezing any transition to the current value of the light.</li>
</ul>
<p>Let's assume the following:</p>
<ul>
<li>The increase button state value is at <code>/3/s/onof/v</code></li>
<li>The decrease button state value is at <code>/4/s/onof/v</code></li>
<li>The light brightness value can be changed using
<code>coap://light/1/s/levl/v?inc&amp;d=0.4</code>
<ul>
<li><code>inc</code>: causes the value to be incremented by the amount
specified in the body.</li>
<li><code>d=0.4</code>: causes the value to be transitioned from the previous
value over a period of 0.4 seconds.</li>
</ul>
</li>
<li>POSTing 0 to <code>coap://light/1/s/tran/d</code> will stop any transition in
progress.</li>
</ul>
<p>This is how the primitives would be configured:</p>
<ul>
<li>
<p>Timer 1: Value Increment Timer</p>
<ul>
<li>schedule: <code>c 0 == IF 0.001 ELSE 0.4 ENDIF</code>
<ul>
<li><em>0.001 seconds for first firing, 0.4 seconds otherwise</em></li>
</ul>
</li>
<li>predicate: <em>empty</em></li>
<li>auto-reset: true</li>
<li>action:
<ul>
<li><code>POST coap://light/1/s/levl/v?inc&amp;d=0.4 0.1</code></li>
</ul>
</li>
<li>Note: This timer can be enabled/disabled via POSTing a boolean
to <code>/1/f/tmgr/1/s/enab/v</code></li>
</ul>
</li>
<li>
<p>Timer 2: Value Decrement Timer</p>
<ul>
<li>schedule: <code>c 0 == IF 0.001 ELSE 0.4 ENDIF</code>
<ul>
<li><em>0.001 seconds for first firing, 0.4 seconds otherwise</em></li>
</ul>
</li>
<li>predicate: <em>empty</em></li>
<li>auto-reset: true</li>
<li>action:
<ul>
<li><code>POST coap://light/1/s/levl/v?inc&amp;d=0.4 -0.1</code></li>
</ul>
</li>
<li>Note: This timer can be enabled/disabled via POSTing a boolean
to <code>/1/f/tmgr/2/s/enab/v</code></li>
</ul>
</li>
<li>
<p>Pairing 1: Increase Button Pairing</p>
<ul>
<li>source: <code>/3/s/onof/v</code></li>
<li>destination: <code>/1/f/tmgr/1/s/enab/v</code></li>
<li>push: true</li>
<li>pull: false</li>
<li>forward transform: <em>empty</em></li>
</ul>
</li>
<li>
<p>Pairing 2: Decrease Button Pairing</p>
<ul>
<li>source: <code>/4/s/onof/v</code></li>
<li>destination: <code>/1/f/tmgr/2/s/enab/v</code></li>
<li>push: true</li>
<li>pull: false</li>
<li>forward transform: <em>empty</em></li>
</ul>
</li>
<li>
<p>Rule 1: Stop Inc/Dec Timers Rule</p>
<ul>
<li>condition 1
<ul>
<li>uri: <code>/3/s/onof/v</code></li>
<li>expression: <code>! v_l &amp;&amp;</code>
<ul>
<li>infix: <em>(v == false) &amp;&amp; (v_l == true)</em> (Condition is
true only on the transition from true to false)</li>
</ul>
</li>
</ul>
</li>
<li>condition 2
<ul>
<li>uri: <code>/4/s/onof/v</code></li>
<li>expression: <code>! v_l &amp;&amp;</code>
<ul>
<li>infix: <em>(v == false) &amp;&amp; (v_l == true)</em> (Condition is
true only on the transition from true to false)</li>
</ul>
</li>
</ul>
</li>
<li>match: ANY</li>
<li>action
<ul>
<li><code>POST coap://light/1/s/tran/d 0</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>When holds the increment button for half a second:</p>
<ol>
<li><code>/3/s/onof/v</code> transitions from <code>false</code> to <code>true</code>.
<ul>
<li>Pairing 1 notices and sets <code>/1/f/tmgr/1/s/enab/v</code> to the same
value, <code>true</code>.</li>
<li>Rule 1 notices and evaluates condition 1, which evaluates to
<code>false</code>: No action is triggered.</li>
</ul>
</li>
<li>Timer 1 has been enabled
<ul>
<li>Clears the counter back to zero</li>
<li>Evaluates the schedule to determine how long to wait: 0.001
seconds</li>
</ul>
</li>
<li>0.001 seconds go by.</li>
<li>Timer 1 schedule expires
<ul>
<li>Evaluates predicate: true</li>
<li>Triggers action <code>POST coap://light/1/s/levl/v?inc&amp;d=0.4 0.1</code></li>
<li>Increments counter</li>
<li>Evaluates the schedule to determine how long to wait: 0.4
seconds</li>
</ul>
</li>
<li>Light starts incrementing by 10% over the next 0.4 seconds.</li>
<li>0.4 seconds go by.</li>
<li>Timer 1 schedule expires
<ul>
<li>Evaluates predicate: true</li>
<li>Triggers action <code>POST coap://light/1/s/levl/v?inc&amp;d=0.4 0.1</code></li>
<li>Increments counter</li>
<li>Evaluates the schedule to determine how long to wait: 0.4
seconds</li>
</ul>
</li>
<li>Light starts incrementing by another 10% over the next 0.4
seconds.</li>
</ol>
<p>When someone lets go of the increment button:</p>
<ol>
<li><code>/3/s/onof/v</code> transitions from <code>true</code> to <code>false</code>.
<ul>
<li>Pairing 1 notices and sets <code>/1/f/tmgr/1/s/enab/v</code> to the same
value, <code>false</code>.</li>
<li>Rule 1 notices and evaluates condition 1, which evaluates to
<code>true</code>:
<ul>
<li>Triggers action <code>POST coap://light/1/s/tran/d 0</code></li>
</ul>
</li>
</ul>
</li>
<li>Timer 1 has been disabled.</li>
<li>Light stops any transition that is in progress.</li>
</ol>
<h3><a class="header" href="#edge-cases" id="edge-cases">Edge Cases</a></h3>
<p>This does indeed work, but the fact that we have a timing schedule
of <code>c 0 == IF 0.001 ELSE 0.4 ENDIF</code> is rather ugly. More importantly,
it also hints at a small flaw: When the user presses both buttons at
the same time, the timers would be firing at the same time: producing
weird behavior until the user releases one of the buttons.</p>
<h2><a class="header" href="#second-attempt" id="second-attempt">Second Attempt</a></h2>
<p>We can fix this by replacing the two pairings with two rules. This
new approach would better handles such edge cases, since each button
press could be configured with actions to gracefully turn off the
opposing timer. It would also allow us to remove the <code>0.001</code> second
hack. Let's see what that approach would look like:</p>
<ul>
<li>Timer 1 is the same, except:
<ul>
<li>schedule: <code>0.4</code></li>
</ul>
</li>
<li>Timer 2 is the same, except:
<ul>
<li>schedule: <code>0.4</code></li>
</ul>
</li>
<li>Rule 1 is the same.</li>
<li>Rule 2: Inc Button Pressed Rule
<ul>
<li>condition 1
<ul>
<li>uri: <code>/3/s/onof/v</code></li>
<li>expression: <code>v_l ! &amp;&amp;</code>
<ul>
<li>infix: <em>(v == true) &amp;&amp; (v_l == false)</em> (Condition is
true only on the transition from false to true)</li>
</ul>
</li>
</ul>
</li>
<li>action
<ul>
<li><code>POST /1/f/tmgr/2/s/enab/v false</code> (Synchronous)</li>
<li><code>POST coap://light/1/s/levl/v?inc&amp;d=0.4 0.1</code> (Synchronous)</li>
<li><code>POST /1/f/tmgr/1/s/enab/v true</code></li>
</ul>
</li>
</ul>
</li>
<li>Rule 3: Dec Button Pressed Rule
<ul>
<li>condition 1
<ul>
<li>uri: <code>/4/s/onof/v</code></li>
<li>expression: <code>v_l ! &amp;&amp;</code>
<ul>
<li>infix: <em>(v == true) &amp;&amp; (v_l == false)</em> (Condition is
true only on the transition from false to true)</li>
</ul>
</li>
</ul>
</li>
<li>action
<ul>
<li><code>POST /1/f/tmgr/1/s/enab/v false</code> (Synchronous)</li>
<li><code>POST coap://light/1/s/levl/v?inc&amp;d=0.4 -0.1</code>
(Synchronous)</li>
<li><code>POST /1/f/tmgr/2/s/enab/v true</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Now whenever the user presses more than one button, the last button
pressed will be the one in effect. Note that letting go of <em>either</em>
button will still stop the transition, and if that's a problem you
would need to split up Rule 1 into two rules instead of having Rule 1
do double duty.</p>
<p>Notice how the actions are explicitly marked as synchronous: we only
want them to fire once the previous action has finished. This allows
us to eliminate race conditions.</p>
<h1><a class="header" href="#splot-security-model" id="splot-security-model">Splot Security Model</a></h1>
<p>This document outlines the proposed overall architecture of the Splot Security
Model (SSM), which defines the mechanisms for how the security of the
Splot Object Model (SOM) can be managed in-band, as well as some hints
about how native implementations of the Splot Object Model (like SMCP)
can be secured on the wire.</p>
<p>The SSM provides:</p>
<ul>
<li>Framework and nomenclature for Splot Object Model security</li>
<li>Decentralized, flexible mandatory access controls</li>
<li>In-band Management via the Splot Object Model</li>
</ul>
<h2><a class="header" href="#use-cases" id="use-cases">Use Cases</a></h2>
<p>There are generally three different types of interactions with Splot
devices:</p>
<ul>
<li>Initial <em>commissioning</em> and device setup</li>
<li>General-purpose <em>monitoring/control</em> (like from a dedicated app)</li>
<li><em>Device-to-Device</em> Automation</li>
</ul>
<p>These use cases present significantly different requirements with
respect to security:</p>
<ul>
<li>Initial commissioning requires a relatively
simple (but secure) way to authenticate to the device when physical
proximity can be proven.</li>
<li>Monitoring/control should support delegation,
adding/removing authorized devices, as well as differing levels of
access.</li>
<li>Device-to-device automation does not need any of this and instead require
extremely narrow access.</li>
</ul>
<p>Both monitoring/control and device-to-device
require the use of secure multicast, but for different reasons. The
SSM attempts to satisfy all of these use cases with a
single security framework.</p>
<h2><a class="header" href="#design-goals-1" id="design-goals-1">Design Goals</a></h2>
<ul>
<li>Vendor neutral: Does not require a Google account to work</li>
<li>Decentralized: Not dependent on internet access</li>
<li>Implementable on constrained devices</li>
<li>Enable long-lived behavioral associations between devices:
The ability to survive device ownership changes while remaining secure</li>
</ul>
<p>These are features which are informing the design and architecture of
the Splot Security Model, but not yet formally defined:</p>
<ul>
<li>Delegation: Give temporary, limited, and revocable access to
visitors without interacting with every device.</li>
<li>Attestation: Allows devices to determine with high confidence if
other devices are certified for a given purpose.</li>
</ul>
<h2><a class="header" href="#terminology-1" id="terminology-1">Terminology</a></h2>
<p>Access Rule:
A rule that defines what actions are allowed or disallowed for a given <em>identity</em>.</p>
<p>Attestation Certificate:
A certificate that is used to strongly indicate that the given
device meets certain requirements, such as being manufactured
by a specific manufacturer or meeting certain regulatory requirements.</p>
<p>Certificate
: A data structure that contains a public key and additional data.</p>
<p>Client
: A device that sends requests to servers.</p>
<p>DTLS
: Datagram Transport Layer Security, as defined in [RFC6347][https://tools.ietf.org/html/rfc6347].</p>
<p>Identity
: A named set of mandatory access control rules on a given
<em>server</em>. The scope of an identity is limited to the server.</p>
<p>Keychain
: Mechanisms for managing a collection of keychain items.</p>
<p>Keychain Item
: Either a <em>shared secret</em>, <em>password</em>, or <em>certificate</em>.</p>
<p>Keychain item identifier
: A string uniquely identifying a keychain
item on a given device.</p>
<p>OSCORE
: A method for application-layer protection of the Constrained
Application Protocol (CoAP) using CBOR Object Signing and Encryption
(COSE), providing end-to-end protection between endpoints
communicating using CoAP or CoAP-mappable HTTP. Defined in
[RFC8613][https://tools.ietf.org/html/rfc8613].</p>
<p>PAKE
: Password Authenticated Key Exchange. Describes any secure
mechanism for establishing a strong, high-entropy shared key using a
low-entropy password.</p>
<p>Password
: A low-entropy secret that is shared between two parties to
allow them to mutually authenticate to each other.</p>
<p>SPSKE
: Single-Purpose Shared Key Establishment, a way for two devices to
generate a shared key without the administrator knowing the key.</p>
<p>Security Session
: A secure channel between a <em>client</em> and one or more <em>servers</em></p>
<p>Server
: A device that responds to requests from <em>clients</em>.</p>
<p>Shared Secret
: A high-entropy secret that is shared amongst two or
more devices that allow them to mutually authenticate to each other.</p>
<h1><a class="header" href="#architecture-1" id="architecture-1">Architecture</a></h1>
<p><img src="ssm/splot-security-model.svg" alt="Splot Security Model UML Diagram" /></p>
<p>The key takeaways from the diagram above are:</p>
<ul>
<li>Each <em>device</em> has...
<ul>
<li>...a <em><a href="ssm/keychain.html">Keychain</a></em>, which manages <em>Keychain Items</em>.</li>
<li>... a set of <em><a href="ssm/identities.html">Identities</a></em>, which have <em>Access Rules</em>.</li>
</ul>
</li>
<li>A <em>Keychain Item</em> can be either a <em>shared secret</em>, <em>password</em>, or
<em>certificate</em>.</li>
<li>The <em>Keychain</em>, <em>Keychain Items</em>, <em>Identities</em>, and <em>Access Rules</em>
are all <em><a href="ssm/../som/things.html">Things</a></em>, and can be managed in-band.</li>
<li><em>Keychain Items</em> can optionally reference a single <em>Identity</em>.</li>
</ul>
<h2><a class="header" href="#layer-security-protocols" id="layer-security-protocols">Layer Security Protocols</a></h2>
<p>While technically an implementation detail, the Splot Security Model
was written with two security layer protocols in mind:
<a href="https://tools.ietf.org/html/rfc6347">DTLS</a> and <a href="https://tools.ietf.org/html/rfc8613">OSCORE</a>.</p>
<p><a href="https://tools.ietf.org/html/rfc6347">DTLS</a> is intended to be used for security sessions authenticated with
certificates or low-entropy passwords (supporting monitoring/control
and initial commissioning). <a href="https://tools.ietf.org/html/rfc8613">OSCORE</a> is intended to be used to secure
device-to-device interactions with high-entropy shared secrets. <a href="https://tools.ietf.org/html/rfc8613">OSCORE</a>
is supported specifically to enable secure multicast device-to-device
interactions.</p>
<h2><a class="header" href="#security-sessions" id="security-sessions">Security Sessions</a></h2>
<p>Secure requests sent from a client to one or more servers (and
responses vise-versa) are performed within the context of a
<em>security session</em> established between the devices.</p>
<p>Security sessions are secure channels between a <em>client</em> (who
initiates the session and sends requests) and one or more <em>servers</em>
(which can respond to the requests). The creation of a security
session is always initiated by the client. If the server needs to send
requests to the client, a new security session SHALL be established
where the roles of the devices are reversed.</p>
<p>On the client side, a security session is uniquely identified by a
tuple of the following information:</p>
<ul>
<li>The URL of the server endpoint</li>
<li>The client keychain item used to authenticate the client to the
server.</li>
<li>A (possibly empty) set of acceptable client keychain items that
the server can use to authenticate itself.</li>
</ul>
<p>Any request from a client that needs a security session with the same
three properties above can re-use any existing security session with
those properties. Otherwise, a new security session MUST be
established.</p>
<p>On the server side, a security session has the following properties:</p>
<ul>
<li>The <em>identity</em> to assume for any incoming request from the
client, determined from the keychain item on the server that the
client used to initially authenticate. This <em>identity</em>
determines what actions the <em>client</em> may perform on the
<em>server</em> using this security session.</li>
<li><em>OPTIONAL:</em> The set of keychain items that the client associated
with this session has proven it satisfies. Used for attestation.
First item is the one that determined the identity. Usually only
contains one item. This may be empty if no authentication has
taken place.</li>
</ul>
<h2><a class="header" href="#identities" id="identities">Identities</a></h2>
<p>An <em>identity</em> is a named set of mandatory access control rules on
a given <em>server</em>. The scope of an identity is limited to that
server. Identities can be managed in-band as <em>Things</em>.</p>
<p>When establishing a session, a client uses the <em>keychain item
identifier</em> to establish the session, *not the <em>identity</em>
(which is purely a server-side concept). An identity can be
associated with multiple <em>keychain items</em>, whereas a keychain
item identifier identifies a single keychain item on a device.</p>
<h3><a class="header" href="#standard-identities" id="standard-identities">Standard Identities</a></h3>
<p>The security model has five pre-defined identities with standardized
names and behaviors: Admin (NOTE:  The name &quot;root&quot; was specifically
avoided to prevent confusion about what an identity with such a name
would be capable of.), Init, User, Read, and Anon.</p>
<ul>
<li><code>admin</code> — Used by the administrator of the device. <code>admin</code>
may read, write, or mutate any property in any section of any Thing
on this device. May initiate software updates, manage the
keychain, manage permissions, and manage connectivity. There are
two actions that are not allowed: A factory reset MUST NOT be
allowed. Also, this identity MUST NOT be allowed to read the
secret share of any keychain item (writing is allowed).</li>
<li><code>init</code> — Special identity that can only be assumed when the
device pairing code is used to authenticate. It assumes all of the
permissions of “admin”, but can also perform a factory reset
and/or read secret shares from items in the keychain. The ability
to use this identity generally requires physical access to the
device to put it into a particular state where you can
authenticate using the pairing code. Intended only for initial
commissioning and recovering administrative credentials. Unlike
all other built-in identities, capabilities associated with this
identity cannot be changed.</li>
<li><code>user</code> — For identities of the device. <code>user</code> may read,
write, or mutate all properties in the operational state of any Thing
on this device, and may read any property from any Thing on this
device (same exceptions as <code>admin</code>). No access is granted to
any other resource.</li>
<li><code>read</code> — For read-only identities of the device. <code>read</code> may
read any property in any section of any Thing on this device (same
exceptions as <code>admin</code>).  No access is granted to any other
resource.</li>
<li><code>anon</code> — Used when the client did not authenticate itself to the
server. By default, all requests will be denied (can be overridden
for certain circumstances).</li>
</ul>
<p>Additional custom identities can be created with very limited scopes.
All standardized identities (except <code>init</code>) can have their ACLs
overridden.</p>
<h3><a class="header" href="#access-rules" id="access-rules">Access Rules</a></h3>
<p>The access rules for an identity allow access control decisions based
on:</p>
<ul>
<li>REST Method (GET, PUT, POST, DELETE, etc)</li>
<li>Path (Can start or end with a wildcard)</li>
<li>Query (can match individual fields)</li>
<li>Presence of CoAP observation/block-transfer options</li>
<li>Match rules from another <em>identity</em></li>
</ul>
<h1><a class="header" href="#keychain" id="keychain">Keychain</a></h1>
<p>The keychain is the manager of cryptographic secrets and certificates,
referred to as <em>keychain items</em>.</p>
<h2><a class="header" href="#keychain-items" id="keychain-items">Keychain Items</a></h2>
<p>A <em>keychain item</em> can be either a <em>shared secret</em>,
<em>password</em>, or <em>certificate</em> (with or without a private key).
Conceptually, keychain items are used to authenticate devices to each
other, and in practice may also be simultaneously used for
establishing cryptographic session keys.</p>
<p>All keychain items have at least the following attributes:</p>
<ul>
<li>Identifier used to identify the item during establishment of the
<em>security session</em>.</li>
<li>Human-readable Administrative label</li>
<li>Object type (Shared Secret, Password, or Certificate)</li>
<li>Associated local <em>identity</em> (Default: &quot;anon&quot;)</li>
<li>A flag indicating if the keychain item is enabled.</li>
<li>A flag indicating if the keychain item is permanent.</li>
<li><em>Lost secret recovery share</em></li>
</ul>
<p>Ideally, the private/secret part of each keychain item would be stored
in a secure element (&quot;hardware backed&quot;).</p>
<h3><a class="header" href="#shared-secrets" id="shared-secrets">Shared Secrets</a></h3>
<p><em>Shared Secrets</em> allow for mutual authentication of client and
server. They are <em>high-entropy</em> and can be used directly in the
calculation of a shared session key. These are typically used to
secure device-to-device relationships and are associated with
identities which are very limited in scope.</p>
<h3><a class="header" href="#passwords" id="passwords">Passwords</a></h3>
<p><em>Passwords</em> also allow for mutual authentication of client and
server. They are <em>low-entropy</em>, so they must be used with a PAKE
algorithm to establish a strong shared session key. These items are
generally only used for initial device configuration, but the security
model defines them as a top-level keychain item type. From a
high-level perspective, they behave identically to <em>shared
secrets</em>.</p>
<h3><a class="header" href="#certificates" id="certificates">Certificates</a></h3>
<p><em>Certificates</em> allow for one-way authentication between a server
and a client. The exact implementation details are TBD, but they are
expected to be based on X.509. Certificates are generally used for
direct administration rather than for automation.</p>
<p>Conceptually, there are two types of certificate keychain items: those
with private keys and those without. A <em>certificate with a private
key</em> allows the device to authenticate itself to other devices. It
is not used to authenticate other devices, and thus these keychain
items are not typically associated with an identity other than &quot;anon&quot;.</p>
<p>A <em>certificate without a private key</em> only allows the device to
authenticate other devices that have a private key with this
certificate or one signed by it.</p>
<p>For example, the administrator device (smart phone) has a self-signed
admin certificate for devices in its domain. The administrator would
install this admin certificate (without a private key) onto a managed
device at commissioning and associate it with the &quot;admin&quot; identity.
The administrator device can then be used to securely manage any
devices configured in this way.</p>
<h2><a class="header" href="#permanent-keychain-items" id="permanent-keychain-items">Permanent Keychain Items</a></h2>
<p>There are currently three types of &quot;permanent&quot; keychain items that are
used for device identification and initial commissioning:</p>
<h3><a class="header" href="#self-signed-certificate--private-key" id="self-signed-certificate--private-key">Self-signed Certificate + Private Key</a></h3>
<p>The only purpose of this keychain item is to uniquely identify the
device. It is recalculated at factory reset to ensure privacy. This
certificate is used by a server when the client wants to use a client
certificate and doesn’t specify a key identifier for the server.
This keychain item has an identifier of &quot;self&quot; if direct selection is
desired.</p>
<h3><a class="header" href="#attestation-certificate--private-key" id="attestation-certificate--private-key">Attestation Certificate + Private Key</a></h3>
<p>This certificate is anonymized using batch keys, similar to FIDO
tokens. It is not associated with an identity: It is used for
additional attestation (for things like certification requirements) of
an already established security session. The keychain identity of
attestation certificates is largely defined by the manufacturer, but
the following values are recommended:</p>
<ul>
<li>
<p>&quot;mfgr&quot; for manufacturer attestation</p>
</li>
<li>
<p>&quot;ecos&quot; for ecosystem attestation</p>
</li>
<li>
<p>&quot;reg&quot; for regulatory attestation</p>
</li>
</ul>
<h3><a class="header" href="#device-setup-codepassword" id="device-setup-codepassword">Device Setup Code/Password</a></h3>
<p>Security sessions created using this keychain item are always
associated with the &quot;init&quot; identity. It shall only be used when
physical proximity can be assured. This keychain item has an
identifier of “init”. The value for this secret may be permanent
(read off of a label on the device) or calculated dynamically
(displayed after pressing a button).</p>
<h2><a class="header" href="#lost-secret-recovery" id="lost-secret-recovery">Lost Secret Recovery</a></h2>
<p>Keychain items can optionally support the ability for someone with
physical access to <em>n</em> of <em>m</em> devices within a certain window of time
to recover the underlying secret or private key.</p>
<p>Each keychain item has a nominally write-only field that is intended
to be used to contain a share of the secret (calculated using
<a href="http://www.digital-scurf.org/software/libgfshare">libgfshare</a>). The
value of this field can only be read by the &quot;init&quot; identity, but can
be written by the “admin” identity.</p>
<p>This allows for a new owner of a house to securely take over the
network without performing a factory reset on every single device, as
long as the new owner can physically manipulate at least <em>n</em> devices
within the share secret reset period (generally months, but may be
indefinite).</p>
<p>The shares are periodically recalculated, such as when a device is
removed from the network or when a new device is added to the network.</p>
<h2><a class="header" href="#single-purpose-shared-key-establishment" id="single-purpose-shared-key-establishment">Single-Purpose Shared Key Establishment</a></h2>
<p>Single-Purpose Shared Key Establishment (SPSKE) is a mechanism for
establishing a shared-secret keychain item on two or more devices
in-band without an administrator ever learning the shared secret. This
enables the establishment of long-lived automation relationships. This
shared key can then be associated with a very limited single-purpose
identity to allow devices to perform actions on each other without
granting the ability to perform unauthorized actions. The intent is to
enable a &quot;capability-like&quot; security model.</p>
<p>There are two variants: one for establishing a shared key between two
devices, and one for establishing a shared key between a group of
devices. The exact mechanism is TBD, but it would generally work like
this:</p>
<ul>
<li>The administrator calculates a temporary shared secret, <em>P</em>.</li>
<li>A &quot;prepare-SPSKE&quot; command is sent to Device A with the desired key
identifier and the value of <em>P</em>.
<ul>
<li>Upon success, a location <em>LOC</em> is returned, which (if
relative) is expanded to a fully specified URI. When the
process is finished, this will be the address of the newly
created keychain item for Device A. Next step must be
completed within five minutes or <em>LOC</em> will become
invalid.</li>
</ul>
</li>
<li>A &quot;calc-SPSKE&quot; command is sent to Device B with the desired key
identifier, the value of <em>P</em>, and the value of <em>LOC</em>.
<ul>
<li>Upon success, a location to the newly created keychain item
for Device B is returned. <em>LOC</em> can then be considered the
location of the newly created keychain item for Device A.</li>
</ul>
</li>
<li>The administrator can then configure the newly created keychain
items as appropriate, without ever learning the shared secret they
contain.</li>
</ul>
<h1><a class="header" href="#unresolved-issues" id="unresolved-issues">Unresolved Issues</a></h1>
<h2><a class="header" href="#secure-multicast-discovery" id="secure-multicast-discovery">Secure Multicast Discovery</a></h2>
<p>It would be desirable for someone with the appropriate credentials to
be able to quickly discover devices that they can monitor/control.
However, in order to avoid the case where the loss of a single device
leads to the compromise of the entire network, monitoring/control
credentials are typically asymmetric. While OSCORE does support secure
multicast, it only works with a symmetric key.</p>
<p>Possible solutions:</p>
<ul>
<li>Have two keys: An asymmetric one for monitoring/control, and a
symmetric one for multicast discovery.
<ul>
<li>Pros: Fast.</li>
<li>Cons: Difficult to manage or revoke discovery key.</li>
</ul>
</li>
<li>Use unsecured multicast to discover devices which support SOM+SSM
and then follow up each one with a secure unicast discovery
request.
<ul>
<li>Pros: Secure. Single certificate means easier key management.</li>
<li>Cons: Slow when there are lots of devices. Must negotiate a
new security session with each device.</li>
</ul>
</li>
</ul>
<p>Either approach could be adopted without any changes to the underlying
security model.</p>
<h2><a class="header" href="#certificate-format" id="certificate-format">Certificate Format</a></h2>
<p>The certificate format is currently undefined, but assumed to
ultimately be based on X.509. However, there could be benefits to
having a compressed certificate format that expands to X.509, similar
to <a href="https://github.com/openweave/openweave-core/blob/b506d9e3c28eee887517c1f31f605f6e8151c039/doc/specs/protocol-specification-weave-digital-certificates.pdf">Nest Weave Digital Certificates</a>.</p>
<h1><a class="header" href="#splot-monitoring-and-control-protocol" id="splot-monitoring-and-control-protocol">Splot Monitoring and Control Protocol</a></h1>
<p>The Splot Monitoring and Control Protocol (SMCP) is an experimental
RESTful machine-to-machine/thing-to-thing
protocol designed for monitoring and controlling networked devices, as
well as automating direct machine-to-machine interactions. SMCP can be
used via either CoAP or HTTP, although CoAP is recommended.</p>
<p>SMCP was designed simultaneously with the <a href="smcp/../som/intro.html">Splot Object Model
(SOM)</a>. Thus, it shares much of the same
nomenclature: Things, Traits, Properties, and Methods
are all fundamental concepts in SMCP. However, whereas the Splot
Object Model defines the process and interfaces for how you can
discover, manipulate, and automate things, SMCP defines what that can
actually look like on the wire.</p>
<p>SMCP is still in the experimental and developmental stages, but SMCP
is ultimately intended to be used for monitoring and controlling a large
variety of device types:</p>
<ul>
<li>Consumer IoT equipment: Temperature sensors, smart light
bulbs, smart buttons, and network cameras.</li>
<li>Networking equipment: Smart switches, routers, and
workstations.</li>
<li>Industrial equipment: Vehicle traffic signals, street lights, power
distribution management.</li>
</ul>
<h2><a class="header" href="#introductory-example" id="introductory-example">Introductory Example</a></h2>
<p>This section introduces a strawman device and describes how it would
be used in practice. It has been written in such a way as to allow you
to jump right in without much context on how the SOM works, but I do
recommend having a look at the <a href="smcp/splot-object-model-intro.html">Splot Object Model
Introduction</a>.</p>
<p>Since SMCP is a RESTful protocol, it uses a hierarchy reminiscent o
that of a file system. Here is an example of what the hierarchy might
look like for a simple smart light bulb:</p>
<pre><code> * /.well-known/
    * core                  &lt;- RFC6690, for service discovery
 * /1/                      &lt;- Feature Thing #1
    * s/                    &lt;- State Section
        * onof/v            &lt;- OnOff value (Boolean)
        * levl/v            &lt;- Level value (Float)
        * scen/sid          &lt;- Scene ID
        * tran/d            &lt;- Transition Duration
    * c/                    &lt;- Configuration Section
        * lock/v            &lt;- Change Lock (Boolean)
    * m/                    &lt;- Metadata Section
        * base/turi         &lt;- Base Trait Version URI
        * base/name         &lt;- Administrative Name for this Thing
        * base/uid          &lt;- Administrative UID for this Thing
        * base/sver         &lt;- Software version
        * onof/turi         &lt;- OnOff Trait Version URI
        * lock/turi         &lt;- Lock Trait Version URI
        * levl/turi         &lt;- Level Trait Version URI
        * lght/turi         &lt;- Light Trait Version URI
        * lght/mire         &lt;- Native Correlated Color Temperature
        * lght/mxbr         &lt;- Maximum Lumen Output
        * lght/mdim         &lt;- Minimum Dimming Output
        * scen/turi         &lt;- Scene Version URI
        * tran/turi         &lt;- Transition Version URI
    * f/                    &lt;- Methods/Children Section
        * scen?save         &lt;- Scene Trait Save Method
        * scen/[scene-id]/  &lt;- Individual Scene Thing
            * s/onof/v      &lt;- OnOff value for [scene-id]
            * s/levl/v      &lt;- Level value for [scene-id]
            * s/tran/d      &lt;- Transition duration for [scene-id]
            * m/base/name   &lt;- Administrative name of the scene
</code></pre>
<h3><a class="header" href="#example-rest-operations" id="example-rest-operations">Example REST Operations</a></h3>
<p>Note that while the following examples use JSON, CBOR is the preferred
encoding for SMCP. Support for JSON in SMCP is optional.</p>
<p>To get information about the state of this thing:</p>
<pre><code>GET /1/s

...

2.05 CONTENT
{&quot;onof&quot;:{&quot;v&quot;:false},&quot;levl&quot;:{&quot;v&quot;:0.2},&quot;tran&quot;:{&quot;d&quot;:0}}
</code></pre>
<p>To get information on just the on/off status:</p>
<pre><code>GET /1/s/onof/v

...

2.05 CONTENT
false
</code></pre>
<p>To turn on this light to full brightness (assuming it isn't locked):</p>
<pre><code>POST /1/s
{&quot;onof&quot;:{&quot;v&quot;:true},&quot;levl&quot;:{&quot;v&quot;:1}}

...

2.04 CHANGED
</code></pre>
<p>To toggle this light on or off:</p>
<pre><code>POST /1/s/onof/v?tog

...

2.04 CHANGED
</code></pre>
<p>To increase the perceived brightness of the light by around 10% of
maximum:</p>
<pre><code>POST /1/s/levl/v?inc
0.1

...

2.04 CHANGED
</code></pre>
<p>Change the light level to 100% brightness over the course of three
seconds:</p>
<pre><code>POST /1/s
{&quot;levl&quot;:{&quot;v&quot;:1},&quot;tran&quot;:{&quot;d&quot;:3}}

...

2.04 CHANGED
</code></pre>
<p>Significantly decrease the brightness of the light (by 0.5) over the
course of 10 seconds:</p>
<pre><code>POST /1/s/levl/v?inc&amp;d=10
-0.5

...

2.04 CHANGED
</code></pre>
<p>To stop a transition currently in progress:</p>
<pre><code>POST /1/s/tran/d
0

...

2.04 CHANGED
</code></pre>
<p>To save the current state as a scene identified as 'evening':</p>
<pre><code>POST /1/f/scen?save
{&quot;sid&quot;:&quot;evening&quot;}

...

2.01 CREATED /1/f/scen/evening/
</code></pre>
<p>To later see what the state for the evening scene is:</p>
<pre><code>GET /1/f/scen/evening/s

...

2.05 CONTENT
{&quot;onof&quot;:{&quot;v&quot;:true},&quot;levl&quot;:{&quot;v&quot;:0.3}}
</code></pre>
<p>To recall evening scene state:</p>
<pre><code>POST /1/s/scen/sid
&quot;evening&quot;

...

2.04 CHANGED
</code></pre>
<p>To delete the evening scene:</p>
<pre><code>DELETE /1/f/scen/evening/

...

2.02 DELETED
</code></pre>
<h3><a class="header" href="#additional-bits" id="additional-bits">Additional Bits</a></h3>
<p>Now that we've covered some of the more simple sorts of interactions,
we can add on to the hierarchy to add things like group support,
device management, keychain management, etc:</p>
<pre><code> * /g/                   &lt;- Group directory
    * ?create            &lt;- Query for creating a new group
    * [group-id]/        &lt;- Individual Group Thing
        * s/...          &lt;- Group Member State (changes state of all members)
        * c/...          &lt;- Group Configuration (normal section)
        * m/...          &lt;- Group Metadata (normal section)
        * f/...          &lt;- Group Member Functions/Children (similar to state)
 * /dev/                 &lt;- Device Management Thing
    * m/                 &lt;- Metadata Section
        * base/turi      &lt;- Base Trait Version URI
        * base/name      &lt;- Administrative Name for this thing
        * base/uid       &lt;- Administrative UID for this thing
        * base/sver      &lt;- Software version
        * prmg/turi      &lt;- Automation Pairing Manager Version URI
        * rlmg/turi      &lt;- Automation Rule Manager Version URI
        * keyc/turi      &lt;- Keychain Version URI
        * gmgr/turi      &lt;- Group Manager Version URI
    * f/                 &lt;- Methods/Children Section
        * prmg/
            * ?create    &lt;- Query to create automation pairings
            * [pair-id]/ &lt;- Path to the things for individual pairings
        * rlmg/
            * ?create    &lt;- Query to create automation rules
            * [rule-id]/ &lt;- Path to the things for individual rules
        * keyc/
            * ?create    &lt;- Query to create new keychain items
            * [key-id]/  &lt;- Path to the things for individual keychain items</code></pre>
<h1><a class="header" href="#remote-monitoring-and-control" id="remote-monitoring-and-control">Remote Monitoring and Control</a></h1>
<p>While not a part of the the original design consideration,
the fact that SMCP is built on top of CoAP provides a straightforward path to
enabling secure, low-latency remote monitoring and control.</p>
<p>There are a few different possible approaches, of which I will sketch out two:</p>
<ol>
<li>Local Reverse CoAP Proxy</li>
<li>Direct DTLS tunnel from the device to the cloud service</li>
</ol>
<p>In both cases, the connection from the remote phone to whatever server is being used
would be secured with DTLS, but in the more secure version OSCORE would additionally
be used inside of that tunnel to secure the messaging with end devices. This ensures
that the access control rules remain in-force.</p>
<h2><a class="header" href="#local-reverse-coap-proxy" id="local-reverse-coap-proxy">Local Reverse CoAP Proxy</a></h2>
<p>In this case, devices would register themselves with a special reverse CoAP proxy on the local network.
These devices would not themselves need internet access, but the reverse CoAP proxy would have internet
access.</p>
<p>Once registered, the reverse proxy can forward remote requests it receives to devices on the local network.
The remote requests themselves can reach the proxy in one of two ways:</p>
<ol>
<li>The local reverse proxy registers itself with a cloud service, which is either another reverse proxy or
some proprietary protocol.</li>
<li>The local reverse proxy uses <a href="https://en.wikipedia.org/wiki/Dynamic_DNS">Dynamic DNS</a> and <a href="https://tools.ietf.org/html/rfc6886">NAT-PMP</a>/<a href="https://en.wikipedia.org/wiki/Universal_Plug_and_Play">UPnP</a> to become its own cloud server.</li>
</ol>
<h3><a class="header" href="#pros-and-cons" id="pros-and-cons">Pros and Cons</a></h3>
<ul>
<li>Pros:
<ul>
<li>Controlled devices (except, of course, the reverse proxy) can be firewalled off from direct
internet access, reducing attack surface area.</li>
<li>Remote control of groups is straightforward.</li>
<li>Can use <a href="https://en.wikipedia.org/wiki/Dynamic_DNS">Dynamic DNS</a> and <a href="https://tools.ietf.org/html/rfc6886">NAT-PMP</a>/<a href="https://en.wikipedia.org/wiki/Universal_Plug_and_Play">UPnP</a> to avoid use of cloud proxy server.</li>
<li>Relatively off-the-shelf use of CoAP proxy servers.</li>
</ul>
</li>
<li>Cons:
<ul>
<li>Requires some additional hardware on the local network.</li>
</ul>
</li>
</ul>
<h2><a class="header" href="#direct-dtls-tunnel" id="direct-dtls-tunnel">Direct DTLS Tunnel</a></h2>
<p>In this case, the device would be configured to register itself with a special
cloud-based CoAP caching proxy server. This registration would happen using DTLS
to secure the connection. Once the registration is complete, that DTLS tunnel is
used to send requests back to the device.</p>
<h3><a class="header" href="#pros-and-cons-1" id="pros-and-cons-1">Pros and Cons</a></h3>
<ul>
<li>Pros:
<ul>
<li>Very low-latency</li>
<li>No additional hardware required</li>
</ul>
</li>
<li>Cons:
<ul>
<li>Requires each device to send keep-alive packets to ensure firewall doesn't
close the UDP port. (Not a problem for sleepy devices)</li>
<li>Requires each device to have at least some limited amount of internet access.
Should be heavily firewalled to limit attack surface area.</li>
<li>Proper support for groups requires devices to keep cloud proxy informed about
group membership, adding some mild complexity.</li>
<li>Group control operations may &quot;Popcorn&quot;.</li>
</ul>
</li>
</ul>
<h1><a class="header" href="#core-traits" id="core-traits">Core Traits</a></h1>
<p>The <code>core</code> Splot traits are traits that are fundamental to Splot. There are
currently just four:</p>
<ul>
<li><a href="trait-def/core/./base.html"><code>Base</code></a>: Descriptive metadata, Traps, Hidden flag, Context Info</li>
<li><a href="trait-def/core/./group.html"><code>Group</code></a>: All groups of things implement this trait.</li>
<li><a href="trait-def/core/./scene.html"><code>Scene</code></a>: For things that support scenes.</li>
<li><a href="trait-def/core/./transition.html"><code>Transition</code></a>: For things that support smooth state transitions.</li>
</ul>
<h1><a class="header" href="#base-trait-base" id="base-trait-base">Base Trait (<code>base</code>)</a></h1>
<p>Base trait required by all top-level things.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Id</td><td><code>tag:google.com,2018:m2m:traits:base:v1:v0#r0</code></td></tr>
<tr><td align="right">Short-Id</td><td><code>base</code></td></tr>
<tr><td align="right">Has-Children</td><td>no</td></tr>
</tbody></table>
<p>It contains information about the model, manufacturer, and identifier, as well as administratively configurable properties like the administrative name, administrative id, and the hidden flag.</p>
<h2><a class="header" href="#state-properties" id="state-properties">State Properties</a></h2>
<table><thead><tr><th>Name</th><th>Key</th><th>R</th><th>W</th><th>Req</th><th>Description</th></tr></thead><tbody>
<tr><td>Trap</td><td><code>s/base/trap</code></td><td>X</td><td>?</td><td></td><td>Current trap condition(s)</td></tr>
</tbody></table>
<h3><a class="header" href="#sbasetrap--trap" id="sbasetrap--trap"><code>s/base/trap</code> : Trap</a></h3>
<p>Current trap condition(s).</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>nullable text string</td></tr>
<tr><td align="right">Flags</td><td><code>GET</code>, <code>OPT_SET</code>, <code>OBS</code>, <code>RESET</code>, <code>NO_TRANS</code>, <code>NO_MUTATE</code></td></tr>
</tbody></table>
<p>When not null, contains a string indicating the current error/trap condition. This property will automatically revert to null when the error/trap condition has been cleared, which depends on the type of device. This is used to indicate things like power overload, door obstructed, manual override, or battery too low.</p>
<h2><a class="header" href="#metadata-properties" id="metadata-properties">Metadata Properties</a></h2>
<table><thead><tr><th>Name</th><th>Key</th><th>R</th><th>W</th><th>Req</th><th>Description</th></tr></thead><tbody>
<tr><td>TraitURI</td><td><code>m/base/turi</code></td><td>X</td><td></td><td>X</td><td>The URI that uniquely identifies the specification used to implement this trait.</td></tr>
<tr><td>Name</td><td><code>m/base/name</code></td><td>X</td><td>X</td><td>X</td><td>Administratively assigned human-readable name</td></tr>
<tr><td>UID</td><td><code>m/base/uid</code></td><td>X</td><td>?</td><td></td><td>Administratively assigned unique identifier</td></tr>
<tr><td>Permanent</td><td><code>m/base/perm</code></td><td>X</td><td></td><td></td><td>Determines if this thing is permanent and cannot be removed.</td></tr>
<tr><td>ProductName</td><td><code>m/base/prod</code></td><td>X</td><td></td><td></td><td>Localized Product Name</td></tr>
<tr><td>Model</td><td><code>m/base/modl</code></td><td>X</td><td></td><td></td><td>Model identifier, unique to the manufacturer.</td></tr>
<tr><td>Manufacturer</td><td><code>m/base/mfgr</code></td><td>X</td><td></td><td></td><td>Manufacturer name</td></tr>
<tr><td>SoftwareVersion</td><td><code>m/base/sver</code></td><td>X</td><td></td><td></td><td>Software version</td></tr>
<tr><td>Serial</td><td><code>m/base/seri</code></td><td>X</td><td></td><td></td><td>Manufacturer unique-identifier or serial-number</td></tr>
<tr><td>TraitProfiles</td><td><code>m/base/prof</code></td><td>X</td><td></td><td></td><td>Trait profiles supported by this thing</td></tr>
<tr><td>Hidden</td><td><code>m/base/hide</code></td><td>X</td><td>X</td><td></td><td>Hidden flag</td></tr>
<tr><td>Context</td><td><code>m/base/cntx</code></td><td>X</td><td>X</td><td></td><td>Machine-readable dictionary containing information for the management applications.</td></tr>
</tbody></table>
<h3><a class="header" href="#mbaseturi--traituri" id="mbaseturi--traituri"><code>m/base/turi</code> : TraitURI</a></h3>
<p>The URI that uniquely identifies the specification used to implement this trait.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>URI-reference</td></tr>
<tr><td align="right">Flags</td><td><code>CONST</code>, <code>REQ</code></td></tr>
</tbody></table>
<h3><a class="header" href="#mbasename--name" id="mbasename--name"><code>m/base/name</code> : Name</a></h3>
<p>Administratively assigned human-readable name.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>text string</td></tr>
<tr><td align="right">Flags</td><td><code>REQ</code>, <code>RW</code></td></tr>
</tbody></table>
<p>After a factory reset, this is set to a descriptive default value by the manufacturer. This value does not need to be unique.</p>
<h3><a class="header" href="#mbaseuid--uid" id="mbaseuid--uid"><code>m/base/uid</code> : UID</a></h3>
<p>Administratively assigned unique identifier.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>text string</td></tr>
<tr><td align="right">Flags</td><td><code>GET</code>, <code>OPT_SET</code>, <code>OBS</code></td></tr>
</tbody></table>
<p>Identifies the function of the thing. Rules may reference this identifier instead of a direct path in order to make replacement easier. After a factory reset, the value of this field is set to a random UID. This value must be unique.</p>
<h3><a class="header" href="#mbaseperm--permanent" id="mbaseperm--permanent"><code>m/base/perm</code> : Permanent</a></h3>
<p>Determines if this thing is permanent and cannot be removed.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>boolean</td></tr>
<tr><td align="right">Flags</td><td><code>CONST</code></td></tr>
</tbody></table>
<p>True if this thing is permanent and cannot be deleted.</p>
<h3><a class="header" href="#mbaseprod--productname" id="mbaseprod--productname"><code>m/base/prod</code> : ProductName</a></h3>
<p>Localized Product Name.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>map of text strings</td></tr>
<tr><td align="right">Flags</td><td><code>CONST</code></td></tr>
</tbody></table>
<p>Contains a dictionary containing the localized names of the product in at least one language. The key to the dictionary is the locale code (like &quot;en&quot; or &quot;jp&quot;), and the value is the localized name for that locale.</p>
<h3><a class="header" href="#mbasemodl--model" id="mbasemodl--model"><code>m/base/modl</code> : Model</a></h3>
<p>Model identifier, unique to the manufacturer.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>text string</td></tr>
<tr><td align="right">Flags</td><td><code>CONST</code></td></tr>
</tbody></table>
<p>It identifies the specific model of the device hosting this thing. Note that this field is not for the marketing name: use ‘prod’ for that.</p>
<h3><a class="header" href="#mbasemfgr--manufacturer" id="mbasemfgr--manufacturer"><code>m/base/mfgr</code> : Manufacturer</a></h3>
<p>Manufacturer name.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>text string</td></tr>
<tr><td align="right">Flags</td><td><code>CONST</code></td></tr>
</tbody></table>
<p>Unique to the manufacturer. This property identifies the specific model of the device hosting this thing.</p>
<h3><a class="header" href="#mbasesver--softwareversion" id="mbasesver--softwareversion"><code>m/base/sver</code> : SoftwareVersion</a></h3>
<p>Software version.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>text string</td></tr>
<tr><td align="right">Flags</td><td><code>CONST</code></td></tr>
</tbody></table>
<p>This is often the version of the software running on the device, but in the case of a bridge may differ.</p>
<h3><a class="header" href="#mbaseseri--serial" id="mbaseseri--serial"><code>m/base/seri</code> : Serial</a></h3>
<p>Manufacturer unique-identifier or serial-number.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>text string</td></tr>
<tr><td align="right">Flags</td><td><code>CONST</code></td></tr>
</tbody></table>
<p>This is typically the thing index appended to the serial number of the device. The presence of this field is optional and may be omitted for privacy purposes.</p>
<h3><a class="header" href="#mbaseprof--traitprofiles" id="mbaseprof--traitprofiles"><code>m/base/prof</code> : TraitProfiles</a></h3>
<p>Trait profiles supported by this thing.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>array containing text strings</td></tr>
<tr><td align="right">Flags</td><td><code>CONST</code></td></tr>
</tbody></table>
<p>This property identifies which <em>trait profiles</em> this thing implements. Trait profiles define what the minimum implementation requirements are for specific types of functionality, such as lights.</p>
<p>Each trait profile specifies a unique string identifier (which is always a valid URI-reference) used to identify that specific version of the trait profile.</p>
<p>The first listed profile is intended to best describe the functionality of the thing, with subordinate profiles listed subsequently.</p>
<h3><a class="header" href="#mbasehide--hidden" id="mbasehide--hidden"><code>m/base/hide</code> : Hidden</a></h3>
<p>Hidden flag.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>boolean</td></tr>
<tr><td align="right">Flags</td><td><code>RW</code></td></tr>
</tbody></table>
<p>This property is a simple boolean flag indicating if this thing should be hidden from administrative views.</p>
<h3><a class="header" href="#mbasecntx--context" id="mbasecntx--context"><code>m/base/cntx</code> : Context</a></h3>
<p>Machine-readable dictionary containing information for the management applications.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>URI-reference</td></tr>
<tr><td align="right">Flags</td><td><code>RW</code></td></tr>
</tbody></table>
<p>This property is generally used by the management application to keep track of why certain things were created and how they fit into the bigger picture.</p>
<p>The following keys are specified:</p>
<ul>
<li><code>rid</code>: Recipe ID. Contains the URI-Reference identifying the recipe that created this thing.</li>
<li><code>riid</code>: Recipe Instance ID. A opaque string identifying the recipe instance this thing belongs to.</li>
<li><code>ver</code>: The version of the recipe instance that this thing was created with. Any time a recipe instance is changed, the version number is incremented and all things owned by that instance are updated with the new version.
*<code>role</code>: The role this thing plays in the recipe. This opaque string is defined by the recipe.</li>
</ul>
<h1><a class="header" href="#group-trait-grup" id="group-trait-grup">Group Trait (<code>grup</code>)</a></h1>
<p>Trait for groups of things.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Id</td><td><code>tag:google.com,2018:m2m:traits:group:v1:v0#r0</code></td></tr>
<tr><td align="right">Short-Id</td><td><code>grup</code></td></tr>
<tr><td align="right">Has-Children</td><td>no</td></tr>
</tbody></table>
<h2><a class="header" href="#config-properties" id="config-properties">Config Properties</a></h2>
<table><thead><tr><th>Name</th><th>Key</th><th>R</th><th>W</th><th>Req</th><th>Description</th></tr></thead><tbody>
<tr><td>Members</td><td><code>c/grup/memb</code></td><td>X</td><td>?</td><td></td><td>URLs of group members</td></tr>
<tr><td>GroupAddress</td><td><code>c/grup/addr</code></td><td>X</td><td>?</td><td></td><td>Multicast Group Address</td></tr>
<tr><td>Version</td><td><code>c/grup/vers</code></td><td>X</td><td>?</td><td></td><td>Incremented whenever group configuration has changed.</td></tr>
</tbody></table>
<h3><a class="header" href="#cgrupmemb--members" id="cgrupmemb--members"><code>c/grup/memb</code> : Members</a></h3>
<p>URLs of group members.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>array containing URI-references</td></tr>
<tr><td align="right">Flags</td><td><code>GET</code>, <code>OPT_SET</code>, <code>OBS</code></td></tr>
</tbody></table>
<h3><a class="header" href="#cgrupaddr--groupaddress" id="cgrupaddr--groupaddress"><code>c/grup/addr</code> : GroupAddress</a></h3>
<p>Multicast Group Address.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>text string</td></tr>
<tr><td align="right">Flags</td><td><code>GET</code>, <code>OPT_SET</code></td></tr>
</tbody></table>
<h3><a class="header" href="#cgrupvers--version" id="cgrupvers--version"><code>c/grup/vers</code> : Version</a></h3>
<p>Incremented whenever group configuration has changed.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>integer</td></tr>
<tr><td align="right">Flags</td><td><code>GET</code>, <code>OPT_SET</code></td></tr>
</tbody></table>
<h2><a class="header" href="#metadata-properties-1" id="metadata-properties-1">Metadata Properties</a></h2>
<table><thead><tr><th>Name</th><th>Key</th><th>R</th><th>W</th><th>Req</th><th>Description</th></tr></thead><tbody>
<tr><td>TraitURI</td><td><code>m/grup/turi</code></td><td>X</td><td></td><td>X</td><td>The URI that uniquely identifies the specification used to implement this trait.</td></tr>
</tbody></table>
<h3><a class="header" href="#mgrupturi--traituri" id="mgrupturi--traituri"><code>m/grup/turi</code> : TraitURI</a></h3>
<p>The URI that uniquely identifies the specification used to implement this trait.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>URI-reference</td></tr>
<tr><td align="right">Flags</td><td><code>CONST</code>, <code>REQ</code></td></tr>
</tbody></table>
<h2><a class="header" href="#associated-constants" id="associated-constants">Associated Constants</a></h2>
<table><thead><tr><th>Name</th><th>Value</th><th>Description</th></tr></thead><tbody>
<tr><td><code>PARAM_GROUP_ID</code></td><td>&quot;gid&quot;</td><td>Group ID</td></tr>
</tbody></table>
<h1><a class="header" href="#scene-trait-scen" id="scene-trait-scen">Scene Trait (<code>scen</code>)</a></h1>
<p>Support for Scenes.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Id</td><td><code>tag:google.com,2018:m2m:traits:scene:v1:v0#r0</code></td></tr>
<tr><td align="right">Short-Id</td><td><code>scen</code></td></tr>
<tr><td align="right">Has-Children</td><td>yes</td></tr>
</tbody></table>
<p>Provides scene support for a thing: named collections of state properties that can be easily recalled.</p>
<h2><a class="header" href="#state-properties-1" id="state-properties-1">State Properties</a></h2>
<table><thead><tr><th>Name</th><th>Key</th><th>R</th><th>W</th><th>Req</th><th>Description</th></tr></thead><tbody>
<tr><td>SceneId</td><td><code>s/scen/sid</code></td><td>X</td><td>X</td><td>X</td><td>Current scene identifier.</td></tr>
</tbody></table>
<h3><a class="header" href="#sscensid--sceneid" id="sscensid--sceneid"><code>s/scen/sid</code> : SceneId</a></h3>
<p>Current scene identifier.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>nullable text string</td></tr>
<tr><td align="right">Flags</td><td><code>REQ</code>, <code>RW</code>, <code>VOLATILE</code></td></tr>
</tbody></table>
<p>When written to, applies the scene to the state. When read, it will return the last state that was loaded if no changes to the state have been made since that time. Otherwise reading will return null.</p>
<h2><a class="header" href="#config-properties-1" id="config-properties-1">Config Properties</a></h2>
<table><thead><tr><th>Name</th><th>Key</th><th>R</th><th>W</th><th>Req</th><th>Description</th></tr></thead><tbody>
<tr><td>SceneIdPowerOn</td><td><code>c/scen/spor</code></td><td>X</td><td>X</td><td></td><td>Scene identifier to use at power-up.</td></tr>
</tbody></table>
<h3><a class="header" href="#cscenspor--sceneidpoweron" id="cscenspor--sceneidpoweron"><code>c/scen/spor</code> : SceneIdPowerOn</a></h3>
<p>Scene identifier to use at power-up.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>nullable text string</td></tr>
<tr><td align="right">Flags</td><td><code>EXPERIMENTAL</code>, <code>RW</code></td></tr>
</tbody></table>
<p>If not null, this property identifies the scene that will be automatically loaded at power-on or reset. Not all implementations support changing this value.</p>
<h2><a class="header" href="#metadata-properties-2" id="metadata-properties-2">Metadata Properties</a></h2>
<table><thead><tr><th>Name</th><th>Key</th><th>R</th><th>W</th><th>Req</th><th>Description</th></tr></thead><tbody>
<tr><td>TraitURI</td><td><code>m/scen/turi</code></td><td>X</td><td></td><td>X</td><td>The URI that uniquely identifies the specification used to implement this trait.</td></tr>
</tbody></table>
<h3><a class="header" href="#mscenturi--traituri" id="mscenturi--traituri"><code>m/scen/turi</code> : TraitURI</a></h3>
<p>The URI that uniquely identifies the specification used to implement this trait.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>URI-reference</td></tr>
<tr><td align="right">Flags</td><td><code>CONST</code>, <code>REQ</code></td></tr>
</tbody></table>
<h2><a class="header" href="#methods-1" id="methods-1">Methods</a></h2>
<table><thead><tr><th>Key</th><th>Description</th></tr></thead><tbody>
<tr><td><code>f/scen?save</code></td><td>Saves the current state to the given SceneId.</td></tr>
</tbody></table>
<h3><a class="header" href="#fscensave--save" id="fscensave--save"><code>f/scen?save</code> : Save</a></h3>
<p>Saves the current state to the given SceneId.</p>
<table><thead><tr><th>Arg</th><th>Req</th><th>Returns</th><th>Description</th></tr></thead><tbody>
<tr><td><code>sid</code></td><td></td><td>text string</td><td>Scene ID</td></tr>
</tbody></table>
<p>Returns URI for the created scene.</p>
<h1><a class="header" href="#transition-trait-tran" id="transition-trait-tran">Transition Trait (<code>tran</code>)</a></h1>
<p>Smooth value transitions.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Id</td><td><code>tag:google.com,2018:m2m:traits:transition:v1:v0#r0</code></td></tr>
<tr><td align="right">Short-Id</td><td><code>tran</code></td></tr>
<tr><td align="right">Has-Children</td><td>no</td></tr>
</tbody></table>
<p>This trait is implemented by things that support smooth transitions for some properties. Only properties in the <em>state</em> section can be transitioned smoothly.</p>
<h2><a class="header" href="#state-properties-2" id="state-properties-2">State Properties</a></h2>
<table><thead><tr><th>Name</th><th>Key</th><th>R</th><th>W</th><th>Req</th><th>Description</th></tr></thead><tbody>
<tr><td>Duration</td><td><code>s/tran/d</code></td><td>X</td><td>X</td><td>X</td><td>Transition duration, in seconds</td></tr>
<tr><td>Speed</td><td><code>s/tran/sp</code></td><td>X</td><td>X</td><td></td><td>Transition duration, in percentage of maximum speed</td></tr>
</tbody></table>
<h3><a class="header" href="#strand--duration" id="strand--duration"><code>s/tran/d</code> : Duration</a></h3>
<p>Transition duration, in seconds.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>nullable real number</td></tr>
<tr><td align="right">Flags</td><td><code>REQ</code>, <code>RW</code>, <code>VOLATILE</code>, <code>NO_TRANS</code></td></tr>
</tbody></table>
<p>When updated simultaneously with other state changes, it indicates the duration of the transition between the old state and the specified state. When read it indicates the time remaining in the current transition. The current transition can be halted by setting this to zero. Sometimes physical limitations will force a minimum duration that is longer than specified. The maximum value that is required to be supported is 604800, or one week. The resolution must be at or below one tenth of a second for durations of less than one hour.</p>
<h3><a class="header" href="#stransp--speed" id="stransp--speed"><code>s/tran/sp</code> : Speed</a></h3>
<p>Transition duration, in percentage of maximum speed.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>nullable percentage (0.0-1.0)</td></tr>
<tr><td align="right">Flags</td><td><code>EXPERIMENTAL</code>, <code>RW</code>, <code>VOLATILE</code>, <code>NO_TRANS</code></td></tr>
</tbody></table>
<p>This is an alternative to specifying the duration of a transition for Things where certain properties cannot be physically transitioned faster than a certain speed. The units of this property are a percentage of full speed. The implementation SHOULD allow this parameter to be adjusted as the transition is occurring. This property SHOULD NOT be implemented unless it makes sense for the underlying hardware.</p>
<h2><a class="header" href="#metadata-properties-3" id="metadata-properties-3">Metadata Properties</a></h2>
<table><thead><tr><th>Name</th><th>Key</th><th>R</th><th>W</th><th>Req</th><th>Description</th></tr></thead><tbody>
<tr><td>TraitURI</td><td><code>m/tran/turi</code></td><td>X</td><td></td><td>X</td><td>The URI that uniquely identifies the specification used to implement this trait.</td></tr>
</tbody></table>
<h3><a class="header" href="#mtranturi--traituri" id="mtranturi--traituri"><code>m/tran/turi</code> : TraitURI</a></h3>
<p>The URI that uniquely identifies the specification used to implement this trait.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>URI-reference</td></tr>
<tr><td align="right">Flags</td><td><code>CONST</code>, <code>REQ</code></td></tr>
</tbody></table>
<h1><a class="header" href="#standard-traits" id="standard-traits">Standard Traits</a></h1>
<p>The <code>standard</code> Splot traits are traits that represent common thing behaviors.
For example, lots of things have the ability to turn them on or off, so this
collection defines the <a href="trait-def/std/on-off.html"><code>OnOff</code></a> trait.</p>
<ul>
<li><a href="trait-def/std/./on-off.html"><code>OnOff</code></a>: Trait for things that can be turned on or off.</li>
<li><a href="trait-def/std/./level.html"><code>Level</code></a>: Trait for things that have a continuous value between 0% and 100%,
such as lights, shades, or speed controllers.</li>
<li><a href="trait-def/std/./light.html"><code>Light</code></a>: Trait that identifies lights, including full-color lights.</li>
<li><a href="trait-def/std/./enabled.html"><code>Enabled</code></a>: Trait for things that can be enabled or disabled.</li>
<li><a href="trait-def/std/./energy.html"><code>Energy</code></a>: Trait for things that need to describe, keep track of, or provide
limits on energy consumption.</li>
<li><a href="trait-def/std/./battery.html"><code>Battery</code></a>: Trait for things that have batteries/cells.</li>
<li><a href="trait-def/std/./ambient-environment.html"><code>AmbientEnvironment</code></a>: Trait for things that monitor temperature,
pressure, humidity, and/or light level.</li>
</ul>
<h1><a class="header" href="#onoff-trait-onof" id="onoff-trait-onof">OnOff Trait (<code>onof</code>)</a></h1>
<p>On/Off.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Id</td><td><code>tag:google.com,2018:m2m:traits:on_off:v1:v0#r0</code></td></tr>
<tr><td align="right">Short-Id</td><td><code>onof</code></td></tr>
<tr><td align="right">Has-Children</td><td>no</td></tr>
</tbody></table>
<p>Implemented by things that can be turned on or off, such as a light bulb or a power controller.</p>
<h2><a class="header" href="#state-properties-3" id="state-properties-3">State Properties</a></h2>
<table><thead><tr><th>Name</th><th>Key</th><th>R</th><th>W</th><th>Req</th><th>Description</th></tr></thead><tbody>
<tr><td>Value</td><td><code>s/onof/v</code></td><td>?</td><td>?</td><td>X</td><td>On/Off state as a boolean</td></tr>
</tbody></table>
<h3><a class="header" href="#sonofv--value" id="sonofv--value"><code>s/onof/v</code> : Value</a></h3>
<p>On/Off state as a boolean.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>boolean</td></tr>
<tr><td align="right">Flags</td><td><code>REQ</code>, <code>OPT_GET</code>, <code>OPT_SET</code>, <code>OBS</code></td></tr>
</tbody></table>
<p>On is <code>true</code>, off is <code>false</code></p>
<h2><a class="header" href="#config-properties-2" id="config-properties-2">Config Properties</a></h2>
<table><thead><tr><th>Name</th><th>Key</th><th>R</th><th>W</th><th>Req</th><th>Description</th></tr></thead><tbody>
<tr><td>DurationOff</td><td><code>c/onof/doff</code></td><td>X</td><td>?</td><td></td><td>Default duration (in seconds) for transitions from 'on' to 'off'</td></tr>
<tr><td>DurationOn</td><td><code>c/onof/don</code></td><td>X</td><td>?</td><td></td><td>Default duration (in seconds) for transitions from 'off' to 'on'</td></tr>
<tr><td>SceneIdOn</td><td><code>c/onof/scon</code></td><td>X</td><td>?</td><td></td><td>Power-on scene.</td></tr>
<tr><td>IsLuminary</td><td><code>c/onof/lumi</code></td><td>X</td><td>?</td><td></td><td>Flag for indicating if this thing is controlling a Luminary (light)</td></tr>
</tbody></table>
<h3><a class="header" href="#conofdoff--durationoff" id="conofdoff--durationoff"><code>c/onof/doff</code> : DurationOff</a></h3>
<p>Default duration (in seconds) for transitions from 'on' to 'off'.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>real number</td></tr>
<tr><td align="right">Flags</td><td><code>GET</code>, <code>OPT_SET</code>, <code>OBS</code></td></tr>
</tbody></table>
<p>Indicates the default duration (in seconds) when transitioning from the 'on' state to the 'off' state. This property is only present on things which also have the <em>Transition</em> trait.</p>
<h3><a class="header" href="#conofdon--durationon" id="conofdon--durationon"><code>c/onof/don</code> : DurationOn</a></h3>
<p>Default duration (in seconds) for transitions from 'off' to 'on'.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>real number</td></tr>
<tr><td align="right">Flags</td><td><code>EXPERIMENTAL</code>, <code>GET</code>, <code>OPT_SET</code>, <code>OBS</code></td></tr>
</tbody></table>
<p>Indicates the default duration (in seconds) when transitioning from the 'off' state to the 'on' state. This property is only present on things which also have the <em>Transition</em> trait.</p>
<h3><a class="header" href="#conofscon--sceneidon" id="conofscon--sceneidon"><code>c/onof/scon</code> : SceneIdOn</a></h3>
<p>Power-on scene.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>text string</td></tr>
<tr><td align="right">Flags</td><td><code>EXPERIMENTAL</code>, <code>GET</code>, <code>OPT_SET</code>, <code>OBS</code></td></tr>
</tbody></table>
<p>Indicates the scene to recall when the device is physically powered on or rebooted. On some types of devices this may be read-only. Only present on things that also implement the <code>Scene</code> trait.</p>
<h3><a class="header" href="#conoflumi--isluminary" id="conoflumi--isluminary"><code>c/onof/lumi</code> : IsLuminary</a></h3>
<p>Flag for indicating if this thing is controlling a Luminary (light).</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>boolean</td></tr>
<tr><td align="right">Flags</td><td><code>EXPERIMENTAL</code>, <code>GET</code>, <code>OPT_SET</code>, <code>OBS</code></td></tr>
</tbody></table>
<p>This property allows a thing that controls a generic load (Like a smart power switch) to be explicitly identified as controlling a luminary (a light that is used for illumination). If this is set to <code>true</code>, this thing will be included in the “luminaries” group. If this thing implements the Luminary trait, then this thing is already assumed to be a luminary and this property <strong>MUST NOT</strong> be present.</p>
<h2><a class="header" href="#metadata-properties-4" id="metadata-properties-4">Metadata Properties</a></h2>
<table><thead><tr><th>Name</th><th>Key</th><th>R</th><th>W</th><th>Req</th><th>Description</th></tr></thead><tbody>
<tr><td>TraitURI</td><td><code>m/onof/turi</code></td><td>X</td><td></td><td>X</td><td>The URI that uniquely identifies the specification used to implement this trait.</td></tr>
</tbody></table>
<h3><a class="header" href="#monofturi--traituri" id="monofturi--traituri"><code>m/onof/turi</code> : TraitURI</a></h3>
<p>The URI that uniquely identifies the specification used to implement this trait.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>URI-reference</td></tr>
<tr><td align="right">Flags</td><td><code>CONST</code>, <code>REQ</code></td></tr>
</tbody></table>
<h1><a class="header" href="#level-trait-levl" id="level-trait-levl">Level Trait (<code>levl</code>)</a></h1>
<p>Level.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Id</td><td><code>tag:google.com,2018:m2m:traits:level:v1:v0#r0</code></td></tr>
<tr><td align="right">Short-Id</td><td><code>levl</code></td></tr>
<tr><td align="right">Has-Children</td><td>no</td></tr>
</tbody></table>
<p>This trait is implemented by things that support smooth transitions for some properties. Only properties in the <em>state</em> section can be transitioned smoothly.</p>
<h2><a class="header" href="#state-properties-4" id="state-properties-4">State Properties</a></h2>
<table><thead><tr><th>Name</th><th>Key</th><th>R</th><th>W</th><th>Req</th><th>Description</th></tr></thead><tbody>
<tr><td>Value</td><td><code>s/levl/v</code></td><td>?</td><td>?</td><td>X</td><td>Level value as a percentage</td></tr>
</tbody></table>
<h3><a class="header" href="#slevlv--value" id="slevlv--value"><code>s/levl/v</code> : Value</a></h3>
<p>Level value as a percentage.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>percentage (0.0-1.0)</td></tr>
<tr><td align="right">Flags</td><td><code>REQ</code>, <code>OPT_GET</code>, <code>OPT_SET</code>, <code>OBS</code></td></tr>
</tbody></table>
<p>The level is encoded as a floating-point value between 0.0 and 1.0. The exact meaning of this value is dependent on the type of device, but in general the value 0.0 represents one extreme state, the value 1.0 represents the opposite extreme state, and the values between those two represent a perceptually uniform distribution between those two states. When paired with the <code>OnOff</code> trait, the value 0.0 is intended to be closest to the off state that isn't actually off.</p>
<p>Some things to note:</p>
<ul>
<li>With the exception of physical actuators, perceptual uniformity is generally not linear. For example, reducing the light output by 50% will only reduce perceived light output by around 25%.</li>
<li>If this trait is paired with an OnOff trait, then setting the level to 0.0 will likely behave differently than if the OnOff trait was turned off.</li>
</ul>
<h2><a class="header" href="#metadata-properties-5" id="metadata-properties-5">Metadata Properties</a></h2>
<table><thead><tr><th>Name</th><th>Key</th><th>R</th><th>W</th><th>Req</th><th>Description</th></tr></thead><tbody>
<tr><td>TraitURI</td><td><code>m/levl/turi</code></td><td>X</td><td></td><td>X</td><td>The URI that uniquely identifies the specification used to implement this trait.</td></tr>
</tbody></table>
<h3><a class="header" href="#mlevlturi--traituri" id="mlevlturi--traituri"><code>m/levl/turi</code> : TraitURI</a></h3>
<p>The URI that uniquely identifies the specification used to implement this trait.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>URI-reference</td></tr>
<tr><td align="right">Flags</td><td><code>CONST</code>, <code>REQ</code></td></tr>
</tbody></table>
<h1><a class="header" href="#light-trait-lght" id="light-trait-lght">Light Trait (<code>lght</code>)</a></h1>
<p>Trait for things that are used for illumination.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Id</td><td><code>tag:google.com,2018:m2m:traits:light:v1:v0#r0</code></td></tr>
<tr><td align="right">Short-Id</td><td><code>lght</code></td></tr>
<tr><td align="right">Has-Children</td><td>no</td></tr>
</tbody></table>
<p>This trait is typically paired with the OnOff and Level <em>traits</em>.</p>
<h2><a class="header" href="#state-properties-5" id="state-properties-5">State Properties</a></h2>
<table><thead><tr><th>Name</th><th>Key</th><th>R</th><th>W</th><th>Req</th><th>Description</th></tr></thead><tbody>
<tr><td>Mode</td><td><code>s/lght/mode</code></td><td>X</td><td>?</td><td></td><td>Current color system mode</td></tr>
<tr><td>Effect</td><td><code>s/lght/efct</code></td><td>X</td><td>?</td><td></td><td>Identifies the current special effect(s) in progress</td></tr>
<tr><td>Mireds</td><td><code>s/lght/mire</code></td><td>X</td><td>?</td><td></td><td>Current color temperature, in Mireds</td></tr>
<tr><td>ChromaXy</td><td><code>s/lght/chro</code></td><td>X</td><td>?</td><td></td><td>The ‘x’ and ‘y’ CIE chromaticity coordinates for the current color</td></tr>
<tr><td>Whitepoint</td><td><code>s/lght/whpt</code></td><td>X</td><td>?</td><td></td><td>The ‘x’ and ‘y’ CIE chromaticity coordinates for the current whitepoint</td></tr>
<tr><td>sRGB</td><td><code>s/lght/sRGB</code></td><td>X</td><td>?</td><td></td><td>sRGB values normalized to the range 0.0 to 1.0</td></tr>
</tbody></table>
<h3><a class="header" href="#slghtmode--mode" id="slghtmode--mode"><code>s/lght/mode</code> : Mode</a></h3>
<p>Current color system mode.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>text string</td></tr>
<tr><td align="right">Flags</td><td><code>GET</code>, <code>OPT_SET</code></td></tr>
</tbody></table>
<p>Indicates the last color system used.</p>
<p>Can be one of the following values:</p>
<ul>
<li><code>ct</code>: Color Temperature</li>
<li><code>sRGB</code></li>
<li><code>xy</code>: CIE xy</li>
<li><code>LCh</code>: CIE LCh (<strong>EXPERIMENTAL</strong>)</li>
</ul>
<p>This property is <strong>REQUIRED</strong> if the other implemented properties have side effects that would set this property to more than one specific value.</p>
<p>Internally, this property is used to determine which properties need to be stored in order to be able to properly recall the state later on, among other things.</p>
<h3><a class="header" href="#slghtefct--effect" id="slghtefct--effect"><code>s/lght/efct</code> : Effect</a></h3>
<p>Identifies the current special effect(s) in progress.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>nullable text string</td></tr>
<tr><td align="right">Flags</td><td><code>GET</code>, <code>OPT_SET</code>, <code>OBS</code></td></tr>
</tbody></table>
<p>The interpretation of this field is vendor-specific, with the following exceptions: <code>null</code> indicates no effect is in use, <code>&quot;colorcycle&quot;</code> indicates that the hue of the light is cycling through colors, and <code>&quot;candle&quot;</code> indicates that the light is emulating the flicker of a candle.</p>
<p>Vendors MAY implement other effects with unique string identifiers. If this property is implemented, <code>m/lght/efct</code> <strong>MUST</strong> also be implemented.</p>
<h3><a class="header" href="#slghtmire--mireds" id="slghtmire--mireds"><code>s/lght/mire</code> : Mireds</a></h3>
<p>Current color temperature, in Mireds.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>real number</td></tr>
<tr><td align="right">Flags</td><td><code>GET</code>, <code>OPT_SET</code>, <code>OBS</code></td></tr>
</tbody></table>
<p><a href="https://en.wikipedia.org/wiki/Mired">Mireds</a> are a perceptually-uniform way to indicate color temperature. This is an important property to ensure that transitions appear to be smooth and natural.</p>
<p>You can easily convert from Kelvin to Mireds using the following formula:</p>
<pre><code class="language-ignore">M = 1000000 / K
</code></pre>
<p>Because of the reciprocal relationship between Mireds and Kelvin, the exact same formula also works for converting Mireds to Kelvin.</p>
<p>Implementing this property is <strong>REQUIRED</strong> on color-temperature lights and <strong>RECOMMENDED</strong> on full-color lights.</p>
<p>When this property is written to, the following changes occur:</p>
<ul>
<li>The light is configured to emit &quot;white&quot; light at the given color temperature.</li>
<li><code>s/lght/mode</code> (if implemented) changes to <code>&quot;ct&quot;</code></li>
<li><code>s/lght/whpt</code> (if implemented) is updated to reflect the new value</li>
<li><code>s/lght/CIEC</code> becomes zero.</li>
</ul>
<p>If <code>s/lght/mode</code> is set to <code>&quot;ct&quot;</code>, reading this property will yield the current color temperature of the white light that is being emitted. Otherwise, reading this property should yield either the <em>correlated</em> color temperature of the light that is being emitted or <code>null</code>.</p>
<h3><a class="header" href="#slghtchro--chromaxy" id="slghtchro--chromaxy"><code>s/lght/chro</code> : ChromaXy</a></h3>
<p>The ‘x’ and ‘y’ CIE chromaticity coordinates for the current color.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>array containing real numbers</td></tr>
<tr><td align="right">Flags</td><td><code>GET</code>, <code>OPT_SET</code>, <code>OBS</code></td></tr>
</tbody></table>
<p>This property is <strong>REQUIRED</strong> on full-color lights and <strong>OPTIONAL</strong> on color-temperature lights.</p>
<p>If the values written to this property are out of gamut, then the state when read will reflect an in-gamut approximation.</p>
<p>Writing to this property changes <code>s/lght/mode</code> to <code>xy</code>.</p>
<h3><a class="header" href="#slghtwhpt--whitepoint" id="slghtwhpt--whitepoint"><code>s/lght/whpt</code> : Whitepoint</a></h3>
<p>The ‘x’ and ‘y’ CIE chromaticity coordinates for the current whitepoint.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>array containing real numbers</td></tr>
<tr><td align="right">Flags</td><td><code>EXPERIMENTAL</code>, <code>GET</code>, <code>OPT_SET</code>, <code>OBS</code></td></tr>
</tbody></table>
<p>This property is <strong>REQUIRED</strong> on full-color lights and <strong>OPTIONAL</strong> on color-temperature lights.</p>
<p>If the values written to this property are out of gamut, then the state when read will reflect an in-gamut approximation.</p>
<p>Writing to this property changes <code>s/lght/mode</code> to <code>xy</code>.</p>
<h3><a class="header" href="#slghtsrgb--srgb" id="slghtsrgb--srgb"><code>s/lght/sRGB</code> : sRGB</a></h3>
<p>sRGB values normalized to the range 0.0 to 1.0.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>nullable array containing percentages</td></tr>
<tr><td align="right">Flags</td><td><code>EXPERIMENTAL</code>, <code>GET</code>, <code>OPT_SET</code>, <code>OBS</code></td></tr>
</tbody></table>
<p>Uses the real composite sRGB gamma curve. Setting this value will change the color of the light to match the contained values.</p>
<p>Implementing this property is <strong>RECOMMENDED</strong> on full-color lights.</p>
<p>If <code>s/lght/whpt</code> is supported, use that as the reference whitepoint, otherwise use D65.</p>
<p>The read value is NOT cropped to fit into the gamut of the device, but individual values <strong>MAY</strong> be limited to the range of 0.0-1.0 or reflect the loss of precision from conversion to the internal representations. If the gamut of the device is larger than the sRGB gamut, then values outside of the range of 0.0-1.0 <strong>MAY</strong> be allowed.</p>
<p>The value read SHOULD read as <code>null</code> if <code>s/lght/mode</code> is not <code>sRGB</code>, otherwise it reports the last value written.</p>
<p>Setting a value of all zeros MUST cause <code>s/onof/v</code> to become false. Setting a value with any non-zero component <strong>MUST</strong> cause the <code>s/onof/v</code> to become true.</p>
<p>Writing to this property changes <code>s/lght/mode</code> to <code>sRGB</code>.</p>
<h2><a class="header" href="#metadata-properties-6" id="metadata-properties-6">Metadata Properties</a></h2>
<table><thead><tr><th>Name</th><th>Key</th><th>R</th><th>W</th><th>Req</th><th>Description</th></tr></thead><tbody>
<tr><td>TraitURI</td><td><code>m/lght/turi</code></td><td>X</td><td></td><td>X</td><td>The URI that uniquely identifies the specification used to implement this trait.</td></tr>
<tr><td>NativeMireds</td><td><code>m/lght/mire</code></td><td>X</td><td></td><td></td><td>The native correlated color temperature (in Mireds)</td></tr>
<tr><td>MaxMireds</td><td><code>m/lght/mxct</code></td><td>X</td><td></td><td></td><td>The <em>maximum</em> numerical value for <code>s/lght/mire</code> that this light supports.</td></tr>
<tr><td>MinMireds</td><td><code>m/lght/mnct</code></td><td>X</td><td></td><td></td><td>The <em>minimum</em> numerical value for <code>s/lght/mire</code> that this light supports.</td></tr>
<tr><td>SupportedEffects</td><td><code>m/lght/efct</code></td><td>X</td><td></td><td></td><td>Provides a list of supported special effects</td></tr>
<tr><td>Primaries</td><td><code>m/lght/prim</code></td><td>X</td><td></td><td></td><td>An array describing the primaries used on the light (up to six) in the CIE xyY colorspace.</td></tr>
<tr><td>Orientation</td><td><code>m/lght/ornt</code></td><td>X</td><td>?</td><td></td><td>The physical orientation of the light.</td></tr>
<tr><td>Function</td><td><code>m/lght/func</code></td><td>X</td><td>?</td><td></td><td>Identifies the primary function of the light.</td></tr>
</tbody></table>
<h3><a class="header" href="#mlghtturi--traituri" id="mlghtturi--traituri"><code>m/lght/turi</code> : TraitURI</a></h3>
<p>The URI that uniquely identifies the specification used to implement this trait.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>URI-reference</td></tr>
<tr><td align="right">Flags</td><td><code>CONST</code>, <code>REQ</code></td></tr>
</tbody></table>
<h3><a class="header" href="#mlghtmire--nativemireds" id="mlghtmire--nativemireds"><code>m/lght/mire</code> : NativeMireds</a></h3>
<p>The native correlated color temperature (in Mireds).</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>real number</td></tr>
<tr><td align="right">Flags</td><td><code>CONST</code></td></tr>
</tbody></table>
<p>This <strong>SHOULD</strong> be present on monochromatic lights, but <strong>MAY</strong> be present on full-color lights. In the case of full-color lights, this property may be missing entirely or set to represent the specific value of <code>s/lght/mire</code> that would generate the largest possible light output.</p>
<h3><a class="header" href="#mlghtmxct--maxmireds" id="mlghtmxct--maxmireds"><code>m/lght/mxct</code> : MaxMireds</a></h3>
<p>The <em>maximum</em> numerical value for <code>s/lght/mire</code> that this light supports.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>real number</td></tr>
<tr><td align="right">Flags</td><td><code>CONST</code></td></tr>
</tbody></table>
<h3><a class="header" href="#mlghtmnct--minmireds" id="mlghtmnct--minmireds"><code>m/lght/mnct</code> : MinMireds</a></h3>
<p>The <em>minimum</em> numerical value for <code>s/lght/mire</code> that this light supports.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>real number</td></tr>
<tr><td align="right">Flags</td><td><code>CONST</code></td></tr>
</tbody></table>
<h3><a class="header" href="#mlghtefct--supportedeffects" id="mlghtefct--supportedeffects"><code>m/lght/efct</code> : SupportedEffects</a></h3>
<p>Provides a list of supported special effects.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>array containing text strings</td></tr>
<tr><td align="right">Flags</td><td><code>CONST</code></td></tr>
</tbody></table>
<h3><a class="header" href="#mlghtprim--primaries" id="mlghtprim--primaries"><code>m/lght/prim</code> : Primaries</a></h3>
<p>An array describing the primaries used on the light (up to six) in the CIE xyY colorspace.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>array containing arrays containing real numbers</td></tr>
<tr><td align="right">Flags</td><td><code>CONST</code></td></tr>
</tbody></table>
<p>Each primary is described by a three-element array that contains the x, y, and Y values respectively for the primary. The Y component is normalized to where the maximum brightness of the light is Y=1.0.</p>
<h3><a class="header" href="#mlghtornt--orientation" id="mlghtornt--orientation"><code>m/lght/ornt</code> : Orientation</a></h3>
<p>The physical orientation of the light.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>integer</td></tr>
<tr><td align="right">Flags</td><td><code>GET</code>, <code>OPT_SET</code></td></tr>
</tbody></table>
<p>0: unspecified, 1: omnidirectional, 2: downlight, 3:uplight, 4: sidelight</p>
<h3><a class="header" href="#mlghtfunc--function" id="mlghtfunc--function"><code>m/lght/func</code> : Function</a></h3>
<p>Identifies the primary function of the light.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>integer</td></tr>
<tr><td align="right">Flags</td><td><code>GET</code>, <code>OPT_SET</code></td></tr>
</tbody></table>
<p>0: unspecified, 1: functional/illuminative, 2: decorative, 3: informative</p>
<h2><a class="header" href="#associated-constants-1" id="associated-constants-1">Associated Constants</a></h2>
<table><thead><tr><th>Name</th><th>Value</th><th>Description</th></tr></thead><tbody>
<tr><td><code>EFFECT_COLORCYCLE</code></td><td>&quot;colorcycle&quot;</td><td>Color-cycle special effect.</td></tr>
<tr><td><code>EFFECT_CANDLE</code></td><td>&quot;candle&quot;</td><td>Candle special effect.</td></tr>
<tr><td><code>MODE_COLOR_TEMP</code></td><td>&quot;ct&quot;</td><td>Color temperature light mode.</td></tr>
<tr><td><code>MODE_SRGB</code></td><td>&quot;sRGB&quot;</td><td>sRGB light mode.</td></tr>
<tr><td><code>MODE_CIE_XY</code></td><td>&quot;xy&quot;</td><td>CIE xy light mode.</td></tr>
<tr><td><code>MODE_CIE_LCH</code></td><td>&quot;LCh&quot;</td><td>CIE LCh light mode.</td></tr>
<tr><td><code>ORIENTATION_UNSPECIFIED</code></td><td>0</td><td>The orientation of this light is unspecified.</td></tr>
<tr><td><code>ORIENTATION_OMNIDIRECTIONAL</code></td><td>1</td><td>This light illuminates in all directions.</td></tr>
<tr><td><code>ORIENTATION_DOWNLIGHT</code></td><td>2</td><td>This light illuminates downward.</td></tr>
<tr><td><code>ORIENTATION_UPLIGHT</code></td><td>3</td><td>This light illuminates upward.</td></tr>
<tr><td><code>ORIENTATION_SIDELIGHT</code></td><td>4</td><td>This light illuminates to the side.</td></tr>
<tr><td><code>FUNCTION_UNSPECIFIED</code></td><td>0</td><td></td></tr>
<tr><td><code>FUNCTION_ILLUMINATIVE</code></td><td>1</td><td>The primary purpose of this light is illumination.</td></tr>
<tr><td><code>FUNCTION_DECORATIVE</code></td><td>2</td><td>This light is decorative.</td></tr>
<tr><td><code>FUNCTION_INFORMATIVE</code></td><td>3</td><td>The state of this light helps to inform the viewer.</td></tr>
</tbody></table>
<h1><a class="header" href="#enabled-trait-enab" id="enabled-trait-enab">Enabled Trait (<code>enab</code>)</a></h1>
<p>Enabled/Disabled.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Id</td><td><code>tag:google.com,2018:m2m:traits:enabled:v1:v0#r0</code></td></tr>
<tr><td align="right">Short-Id</td><td><code>enab</code></td></tr>
<tr><td align="right">Has-Children</td><td>no</td></tr>
</tbody></table>
<p>Implemented by things that can be configured as enabled or disabled.</p>
<h2><a class="header" href="#config-properties-3" id="config-properties-3">Config Properties</a></h2>
<table><thead><tr><th>Name</th><th>Key</th><th>R</th><th>W</th><th>Req</th><th>Description</th></tr></thead><tbody>
<tr><td>Value</td><td><code>c/enab/v</code></td><td>X</td><td>X</td><td>X</td><td>Enabled/Disabled state as a boolean</td></tr>
</tbody></table>
<h3><a class="header" href="#cenabv--value" id="cenabv--value"><code>c/enab/v</code> : Value</a></h3>
<p>Enabled/Disabled state as a boolean.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>boolean</td></tr>
<tr><td align="right">Flags</td><td><code>REQ</code>, <code>GET</code>, <code>SET</code>, <code>OBS</code></td></tr>
</tbody></table>
<p>Enabled is <code>true</code>, Disabled is <code>false</code></p>
<h2><a class="header" href="#metadata-properties-7" id="metadata-properties-7">Metadata Properties</a></h2>
<table><thead><tr><th>Name</th><th>Key</th><th>R</th><th>W</th><th>Req</th><th>Description</th></tr></thead><tbody>
<tr><td>TraitURI</td><td><code>m/enab/turi</code></td><td>X</td><td></td><td>X</td><td>The URI that uniquely identifies the specification used to implement this trait.</td></tr>
</tbody></table>
<h3><a class="header" href="#menabturi--traituri" id="menabturi--traituri"><code>m/enab/turi</code> : TraitURI</a></h3>
<p>The URI that uniquely identifies the specification used to implement this trait.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>URI-reference</td></tr>
<tr><td align="right">Flags</td><td><code>CONST</code>, <code>REQ</code></td></tr>
</tbody></table>
<h1><a class="header" href="#energy-trait-enrg" id="energy-trait-enrg">Energy Trait (<code>enrg</code>)</a></h1>
<p>Energy.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Id</td><td><code>tag:google.com,2018:m2m:traits:energy:v1:v0#r0</code></td></tr>
<tr><td align="right">Short-Id</td><td><code>enrg</code></td></tr>
<tr><td align="right">Has-Children</td><td>no</td></tr>
</tbody></table>
<p>The Energy trait contains properties that relate to the energy consumption of a device. A Thing would rarely implement all of the described properties: only the relevant properties would be implemented.</p>
<h2><a class="header" href="#state-properties-6" id="state-properties-6">State Properties</a></h2>
<table><thead><tr><th>Name</th><th>Key</th><th>R</th><th>W</th><th>Req</th><th>Description</th></tr></thead><tbody>
<tr><td>Watts</td><td><code>s/enrg/watt</code></td><td>X</td><td></td><td></td><td>Instantaneous power draw, measured in watts.</td></tr>
<tr><td>Amps</td><td><code>s/enrg/amps</code></td><td>X</td><td></td><td></td><td>Instantaneous power draw, measured in amps.</td></tr>
<tr><td>Volts</td><td><code>s/enrg/volt</code></td><td>X</td><td></td><td></td><td>Instantaneous electric potential, measured in volts.</td></tr>
<tr><td>VoltAmps</td><td><code>s/enrg/voam</code></td><td>X</td><td></td><td></td><td>Apparent instantaneous power draw, measured in volt-amps.</td></tr>
<tr><td>PowerFactor</td><td><code>s/enrg/pwft</code></td><td>X</td><td></td><td></td><td>The instantaneous measured power factor of the load. Unitless.</td></tr>
<tr><td>Energy</td><td><code>s/enrg/enrg</code></td><td>X</td><td></td><td></td><td>The accumulated power (energy) used over time by this thing, measured in watt-hours.</td></tr>
</tbody></table>
<h3><a class="header" href="#senrgwatt--watts" id="senrgwatt--watts"><code>s/enrg/watt</code> : Watts</a></h3>
<p>Instantaneous power draw, measured in watts.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>real number</td></tr>
<tr><td align="right">Flags</td><td><code>GET</code>, <code>OBS</code></td></tr>
</tbody></table>
<p>Unlike the property volt-amps, this property takes into consideration power factor when measuring AC.</p>
<h3><a class="header" href="#senrgamps--amps" id="senrgamps--amps"><code>s/enrg/amps</code> : Amps</a></h3>
<p>Instantaneous power draw, measured in amps.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>real number</td></tr>
<tr><td align="right">Flags</td><td><code>GET</code>, <code>OBS</code></td></tr>
</tbody></table>
<h3><a class="header" href="#senrgvolt--volts" id="senrgvolt--volts"><code>s/enrg/volt</code> : Volts</a></h3>
<p>Instantaneous electric potential, measured in volts.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>real number</td></tr>
<tr><td align="right">Flags</td><td><code>GET</code>, <code>OBS</code></td></tr>
</tbody></table>
<h3><a class="header" href="#senrgvoam--voltamps" id="senrgvoam--voltamps"><code>s/enrg/voam</code> : VoltAmps</a></h3>
<p>Apparent instantaneous power draw, measured in volt-amps.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>real number</td></tr>
<tr><td align="right">Flags</td><td><code>GET</code>, <code>OBS</code></td></tr>
</tbody></table>
<p>Note that this is literally the volts multiplied by the amps, so this will differ if the power factor is anything other than 1.0. Only really meaningful when measuring AC.</p>
<h3><a class="header" href="#senrgpwft--powerfactor" id="senrgpwft--powerfactor"><code>s/enrg/pwft</code> : PowerFactor</a></h3>
<p>The instantaneous measured power factor of the load. Unitless.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>real number</td></tr>
<tr><td align="right">Flags</td><td><code>GET</code>, <code>OBS</code></td></tr>
</tbody></table>
<p>Only meaningful when measuring AC.</p>
<h3><a class="header" href="#senrgenrg--energy" id="senrgenrg--energy"><code>s/enrg/enrg</code> : Energy</a></h3>
<p>The accumulated power (energy) used over time by this thing, measured in watt-hours.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>real number</td></tr>
<tr><td align="right">Flags</td><td><code>GET</code>, <code>OBS</code>, <code>RESET</code></td></tr>
</tbody></table>
<p>If this Thing allows this value to be reset, it can be reset by setting its value to zero or null. Setting to any other value MUST fail.</p>
<h2><a class="header" href="#config-properties-4" id="config-properties-4">Config Properties</a></h2>
<table><thead><tr><th>Name</th><th>Key</th><th>R</th><th>W</th><th>Req</th><th>Description</th></tr></thead><tbody>
<tr><td>LimitMaxWatts</td><td><code>c/enrg/mxwt</code></td><td>X</td><td>?</td><td></td><td>The maximum real power that the load is allowed to draw before being automatically shutting down.</td></tr>
<tr><td>LimitMaxVoltAmps</td><td><code>c/enrg/mxva</code></td><td>X</td><td>?</td><td></td><td>The maximum apparent power (volt-amps) that the load is allowed to draw before being automatically shutting down.</td></tr>
<tr><td>LimitMaxVolts</td><td><code>c/enrg/mxvo</code></td><td>X</td><td>?</td><td></td><td>The voltage above which the load is automatically shut down.</td></tr>
<tr><td>LimitMinVolts</td><td><code>c/enrg/mnvo</code></td><td>X</td><td>?</td><td></td><td>The voltage below which the load is automatically shut down.</td></tr>
<tr><td>LimitMaxAmps</td><td><code>c/enrg/mxam</code></td><td>X</td><td>?</td><td></td><td>The maximum current that the load is allowed to draw before the load is automatically shut down.</td></tr>
</tbody></table>
<h3><a class="header" href="#cenrgmxwt--limitmaxwatts" id="cenrgmxwt--limitmaxwatts"><code>c/enrg/mxwt</code> : LimitMaxWatts</a></h3>
<p>The maximum real power that the load is allowed to draw before being automatically shutting down.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>nullable real number</td></tr>
<tr><td align="right">Flags</td><td><code>GET</code>, <code>OPT_SET</code>, <code>OBS</code></td></tr>
</tbody></table>
<p>Set to null to disable. This property requires that the OnOff trait also be supported. When tripped, <code>s/base/trap</code> is set to [<code>TRAP_MAX_WATTS</code>] until the condition is reset by turning the load on again.</p>
<h3><a class="header" href="#cenrgmxva--limitmaxvoltamps" id="cenrgmxva--limitmaxvoltamps"><code>c/enrg/mxva</code> : LimitMaxVoltAmps</a></h3>
<p>The maximum apparent power (volt-amps) that the load is allowed to draw before being automatically shutting down.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>nullable real number</td></tr>
<tr><td align="right">Flags</td><td><code>GET</code>, <code>OPT_SET</code>, <code>OBS</code></td></tr>
</tbody></table>
<p>Set to null to disable. This property requires that the OnOff trait also be supported. When tripped, <code>s/base/trap</code> is set to [<code>TRAP_MAX_VOLT_AMPS</code>] until the condition is reset by turning the load on again.</p>
<h3><a class="header" href="#cenrgmxvo--limitmaxvolts" id="cenrgmxvo--limitmaxvolts"><code>c/enrg/mxvo</code> : LimitMaxVolts</a></h3>
<p>The voltage above which the load is automatically shut down.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>nullable real number</td></tr>
<tr><td align="right">Flags</td><td><code>GET</code>, <code>OPT_SET</code>, <code>OBS</code></td></tr>
</tbody></table>
<p>Set to null to disable. This property requires that the OnOff trait also be supported. When tripped, <code>s/base/trap</code> is set to [<code>TRAP_MAX_VOLTS</code>] until the condition is reset by turning the load on again.</p>
<h3><a class="header" href="#cenrgmnvo--limitminvolts" id="cenrgmnvo--limitminvolts"><code>c/enrg/mnvo</code> : LimitMinVolts</a></h3>
<p>The voltage below which the load is automatically shut down.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>nullable real number</td></tr>
<tr><td align="right">Flags</td><td><code>GET</code>, <code>OPT_SET</code>, <code>OBS</code></td></tr>
</tbody></table>
<p>Set to null to disable. This property requires that the OnOff trait also be supported. When tripped, <code>s/base/trap</code> is set to [<code>TRAP_MIN_VOLTS</code>] until the condition is reset by turning the load on again.</p>
<h3><a class="header" href="#cenrgmxam--limitmaxamps" id="cenrgmxam--limitmaxamps"><code>c/enrg/mxam</code> : LimitMaxAmps</a></h3>
<p>The maximum current that the load is allowed to draw before the load is automatically shut down.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>nullable real number</td></tr>
<tr><td align="right">Flags</td><td><code>GET</code>, <code>OPT_SET</code>, <code>OBS</code></td></tr>
</tbody></table>
<p>Set to null to disable. This property requires that the OnOff trait also be supported. When tripped, <code>s/base/trap</code> is set to [<code>TRAP_MAX_AMPS</code>] until the condition is reset by turning the load on again.</p>
<h2><a class="header" href="#metadata-properties-8" id="metadata-properties-8">Metadata Properties</a></h2>
<table><thead><tr><th>Name</th><th>Key</th><th>R</th><th>W</th><th>Req</th><th>Description</th></tr></thead><tbody>
<tr><td>TraitURI</td><td><code>m/enrg/turi</code></td><td>X</td><td></td><td>X</td><td>The URI that uniquely identifies the specification used to implement this trait.</td></tr>
<tr><td>MaxWatts</td><td><code>m/enrg/mxwt</code></td><td>X</td><td></td><td></td><td>The maximum power that this thing is capable of drawing.</td></tr>
<tr><td>MaxAmps</td><td><code>m/enrg/mxam</code></td><td>X</td><td></td><td></td><td>The maximum current that this thing is capable of drawing.</td></tr>
</tbody></table>
<h3><a class="header" href="#menrgturi--traituri" id="menrgturi--traituri"><code>m/enrg/turi</code> : TraitURI</a></h3>
<p>The URI that uniquely identifies the specification used to implement this trait.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>URI-reference</td></tr>
<tr><td align="right">Flags</td><td><code>CONST</code>, <code>REQ</code></td></tr>
</tbody></table>
<h3><a class="header" href="#menrgmxwt--maxwatts" id="menrgmxwt--maxwatts"><code>m/enrg/mxwt</code> : MaxWatts</a></h3>
<p>The maximum power that this thing is capable of drawing.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>real number</td></tr>
<tr><td align="right">Flags</td><td><code>CONST</code></td></tr>
</tbody></table>
<h3><a class="header" href="#menrgmxam--maxamps" id="menrgmxam--maxamps"><code>m/enrg/mxam</code> : MaxAmps</a></h3>
<p>The maximum current that this thing is capable of drawing.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>real number</td></tr>
<tr><td align="right">Flags</td><td><code>CONST</code></td></tr>
</tbody></table>
<h2><a class="header" href="#associated-constants-2" id="associated-constants-2">Associated Constants</a></h2>
<table><thead><tr><th>Name</th><th>Value</th><th>Description</th></tr></thead><tbody>
<tr><td><code>TRAP_MAX_WATTS</code></td><td>&quot;energy-max-watts&quot;</td><td>The real power of the load exceeded the value specified by <code>c/enrg/mxwt</code>.</td></tr>
<tr><td><code>TRAP_MAX_VOLT_AMPS</code></td><td>&quot;energy-max-volt-amps&quot;</td><td>The apparent power of the load exceeded the value specified by <code>c/enrg/mxva</code>.</td></tr>
<tr><td><code>TRAP_MAX_VOLTS</code></td><td>&quot;energy-max-volts&quot;</td><td>The voltage exceeded the value specified by <code>c/enrg/mxvo</code>.</td></tr>
<tr><td><code>TRAP_MIN_VOLTS</code></td><td>&quot;energy-min-volts&quot;</td><td>The voltage was lower than the value specified by <code>c/enrg/mnvo</code>.</td></tr>
<tr><td><code>TRAP_MAX_AMPS</code></td><td>&quot;energy-max-amps&quot;</td><td>The current being drawn by the load exceeded the value specified by <code>c/enrg/mxam</code>.</td></tr>
</tbody></table>
<h1><a class="header" href="#battery-trait-batt" id="battery-trait-batt">Battery Trait (<code>batt</code>)</a></h1>
<p>Battery trait for things which are backed by a battery.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Id</td><td><code>tag:google.com,2018:m2m:traits:battery:v1:v0#r0</code></td></tr>
<tr><td align="right">Short-Id</td><td><code>batt</code></td></tr>
<tr><td align="right">Has-Children</td><td>no</td></tr>
</tbody></table>
<p>All of the properties in this trait are optional, but some properties have defined relationships with other properties that, if present, should be maintained.</p>
<p>Some Things may simply adopt this trait and implement none of the properties simply to indicate that it is battery-powered. Others might only want to indicate if the battery is low, but offer no additional information about the charge level or capacity.</p>
<p>On the other hand, some things might implement most of these properties, providing a rich amount of detail on the overall state and health of the battery.</p>
<h2><a class="header" href="#state-properties-7" id="state-properties-7">State Properties</a></h2>
<table><thead><tr><th>Name</th><th>Key</th><th>R</th><th>W</th><th>Req</th><th>Description</th></tr></thead><tbody>
<tr><td>ChargeRemaining</td><td><code>s/batt/vpct</code></td><td>X</td><td></td><td></td><td>Remaining battery charge, as a percentage.</td></tr>
<tr><td>EnergyRemaining</td><td><code>s/batt/vnrg</code></td><td>X</td><td></td><td></td><td>Energy remaining, in milliwatt-hours.</td></tr>
<tr><td>NeedsService</td><td><code>s/batt/sreq</code></td><td>X</td><td></td><td>X</td><td>Battery service-needed indicator.</td></tr>
<tr><td>ChargeState</td><td><code>s/batt/stat</code></td><td>X</td><td></td><td></td><td>Rechargable battery state</td></tr>
<tr><td>CapacityRemaining</td><td><code>s/batt/rcap</code></td><td>X</td><td></td><td></td><td>Capacity of the battery currently, relative to factory design capacity.</td></tr>
<tr><td>ChargeCycles</td><td><code>s/batt/cycl</code></td><td>X</td><td></td><td></td><td>Total number of battery recharge cycles.</td></tr>
<tr><td>CellVoltage</td><td><code>s/batt/celV</code></td><td>X</td><td></td><td></td><td>The voltages of the individual cells (or banks of cells) in the battery.</td></tr>
</tbody></table>
<h3><a class="header" href="#sbattvpct--chargeremaining" id="sbattvpct--chargeremaining"><code>s/batt/vpct</code> : ChargeRemaining</a></h3>
<p>Remaining battery charge, as a percentage.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>percentage (0.0-1.0)</td></tr>
<tr><td align="right">Flags</td><td><code>GET</code>, <code>OBS</code></td></tr>
</tbody></table>
<p>This field is optional, but highly recommended. If implemented, the value of this field is defined to be the following:</p>
<ul>
<li>Primary/Nonrechargable: <code>energyRemaining</code> divided by <code>energyCapacity</code></li>
<li>Secondary/Rechargeable: <code>energyRemaining</code> divided by the product of <code>capacityRemaining</code> and <code>energyCapacity</code>.</li>
</ul>
<h3><a class="header" href="#sbattvnrg--energyremaining" id="sbattvnrg--energyremaining"><code>s/batt/vnrg</code> : EnergyRemaining</a></h3>
<p>Energy remaining, in milliwatt-hours.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>real number</td></tr>
<tr><td align="right">Flags</td><td><code>GET</code>, <code>OBS</code></td></tr>
</tbody></table>
<p>If implemented, the value of this field is defined to be the following:</p>
<ul>
<li>Primary/Nonrechargable: The product of <code>chargeRemaining</code> and <code>energyCapacity</code>,</li>
<li>Secondary/Rechargeable: The product of <code>chargeRemaining</code> and <code>capacityRemaining</code> and <code>energyCapacity</code>.</li>
</ul>
<h3><a class="header" href="#sbattsreq--needsservice" id="sbattsreq--needsservice"><code>s/batt/sreq</code> : NeedsService</a></h3>
<p>Battery service-needed indicator.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>boolean</td></tr>
<tr><td align="right">Flags</td><td><code>REQ</code>, <code>GET</code>, <code>OBS</code></td></tr>
</tbody></table>
<p>True if the battery needs to be serviced, false otherwise. For example, this would become &quot;true&quot; if the battery was considered low.</p>
<h3><a class="header" href="#sbattstat--chargestate" id="sbattstat--chargestate"><code>s/batt/stat</code> : ChargeState</a></h3>
<p>Rechargable battery state.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>text string</td></tr>
<tr><td align="right">Flags</td><td><code>GET</code>, <code>OBS</code></td></tr>
</tbody></table>
<p>String describing the current state of the battery:</p>
<ul>
<li><code>charged</code>: Battery is fully charged. Connected to external power.</li>
<li><code>charging</code>: Battery is currently charging from external power.</li>
<li><code>discharging</code>: Battery is discharging normally.</li>
<li><code>low</code>: Battery is discharging but little power remains.</li>
<li><code>disconnected</code>: Battery has been disconnected, power being provided externally.</li>
<li><code>trouble</code>: Something is wrong with the battery or charging system.</li>
</ul>
<h3><a class="header" href="#sbattrcap--capacityremaining" id="sbattrcap--capacityremaining"><code>s/batt/rcap</code> : CapacityRemaining</a></h3>
<p>Capacity of the battery currently, relative to factory design capacity.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>percentage (0.0-1.0)</td></tr>
<tr><td align="right">Flags</td><td><code>GET</code>, <code>OBS</code></td></tr>
</tbody></table>
<p>Only used for rechargeable batteries. This is a ratio of the current maximum capacity of the battery versus the maximum capacity of the battery when it was new.</p>
<h3><a class="header" href="#sbattcycl--chargecycles" id="sbattcycl--chargecycles"><code>s/batt/cycl</code> : ChargeCycles</a></h3>
<p>Total number of battery recharge cycles.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>real number</td></tr>
<tr><td align="right">Flags</td><td><code>GET</code>, <code>OBS</code></td></tr>
</tbody></table>
<p>Only used for rechargeable batteries.</p>
<h3><a class="header" href="#sbattcelv--cellvoltage" id="sbattcelv--cellvoltage"><code>s/batt/celV</code> : CellVoltage</a></h3>
<p>The voltages of the individual cells (or banks of cells) in the battery.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>array containing arrays containing real numbers</td></tr>
<tr><td align="right">Flags</td><td><code>GET</code>, <code>OBS</code></td></tr>
</tbody></table>
<p>This can be used to determine the general health of the battery pack.</p>
<h2><a class="header" href="#metadata-properties-9" id="metadata-properties-9">Metadata Properties</a></h2>
<table><thead><tr><th>Name</th><th>Key</th><th>R</th><th>W</th><th>Req</th><th>Description</th></tr></thead><tbody>
<tr><td>EnergyCapacity</td><td><code>m/batt/enrg</code></td><td>X</td><td></td><td></td><td>The factory design energy capacity of the battery when new and fully charged, in milliwatt-hours.</td></tr>
<tr><td>NominalBatteryVoltage</td><td><code>m/batt/volt</code></td><td>X</td><td></td><td></td><td>The nominal voltage of the battery.</td></tr>
<tr><td>NominalCellVoltage</td><td><code>m/batt/celV</code></td><td>X</td><td></td><td></td><td>The nominal voltage of a cell in the battery.</td></tr>
<tr><td>CellCount</td><td><code>m/batt/ccnt</code></td><td>X</td><td></td><td></td><td>The number of cells in the battery.</td></tr>
<tr><td>Rechargable</td><td><code>m/batt/rech</code></td><td>X</td><td></td><td></td><td>Indicates if the battery is rechargeable or not.</td></tr>
</tbody></table>
<h3><a class="header" href="#mbattenrg--energycapacity" id="mbattenrg--energycapacity"><code>m/batt/enrg</code> : EnergyCapacity</a></h3>
<p>The factory design energy capacity of the battery when new and fully charged, in milliwatt-hours.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>integer</td></tr>
<tr><td align="right">Flags</td><td><code>GET</code></td></tr>
</tbody></table>
<p>The maximum energy capacity value is around 2 megawatt-hours.</p>
<h3><a class="header" href="#mbattvolt--nominalbatteryvoltage" id="mbattvolt--nominalbatteryvoltage"><code>m/batt/volt</code> : NominalBatteryVoltage</a></h3>
<p>The nominal voltage of the battery.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>real number</td></tr>
<tr><td align="right">Flags</td><td><code>GET</code></td></tr>
</tbody></table>
<h3><a class="header" href="#mbattcelv--nominalcellvoltage" id="mbattcelv--nominalcellvoltage"><code>m/batt/celV</code> : NominalCellVoltage</a></h3>
<p>The nominal voltage of a cell in the battery.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>real number</td></tr>
<tr><td align="right">Flags</td><td><code>GET</code></td></tr>
</tbody></table>
<h3><a class="header" href="#mbattccnt--cellcount" id="mbattccnt--cellcount"><code>m/batt/ccnt</code> : CellCount</a></h3>
<p>The number of cells in the battery.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>integer</td></tr>
<tr><td align="right">Flags</td><td><code>GET</code></td></tr>
</tbody></table>
<h3><a class="header" href="#mbattrech--rechargable" id="mbattrech--rechargable"><code>m/batt/rech</code> : Rechargable</a></h3>
<p>Indicates if the battery is rechargeable or not.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>boolean</td></tr>
<tr><td align="right">Flags</td><td><code>GET</code></td></tr>
</tbody></table>
<h2><a class="header" href="#associated-constants-3" id="associated-constants-3">Associated Constants</a></h2>
<table><thead><tr><th>Name</th><th>Value</th><th>Description</th></tr></thead><tbody>
<tr><td><code>CHARGE_STATE_CHARGED</code></td><td>&quot;charged&quot;</td><td>Battery is fully charged. Connected to external power.</td></tr>
<tr><td><code>CHARGE_STATE_CHARGING</code></td><td>&quot;charging&quot;</td><td>Battery is currently charging from external power.</td></tr>
<tr><td><code>CHARGE_STATE_DISCHARGING</code></td><td>&quot;discharging&quot;</td><td>Battery is discharging normally.</td></tr>
<tr><td><code>CHARGE_STATE_LOW</code></td><td>&quot;low&quot;</td><td>Battery is discharging but little power remains.</td></tr>
<tr><td><code>CHARGE_STATE_DISCONNECTED</code></td><td>&quot;disconnected&quot;</td><td>Battery has been disconnected, power being provided externally.</td></tr>
<tr><td><code>CHARGE_STATE_TROUBLE</code></td><td>&quot;trouble&quot;</td><td>Something is wrong with the battery or charging system.</td></tr>
</tbody></table>
<h1><a class="header" href="#ambientenvironment-trait-aenv" id="ambientenvironment-trait-aenv">AmbientEnvironment Trait (<code>aenv</code>)</a></h1>
<p>Trait for measuring ambient temperature, pressure, humidity, and light level.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Id</td><td><code>tag:google.com,2018:m2m:traits:ambient-environment:v1:v0#r0</code></td></tr>
<tr><td align="right">Short-Id</td><td><code>aenv</code></td></tr>
<tr><td align="right">Has-Children</td><td>no</td></tr>
</tbody></table>
<p>This would typically be used by environmental sensors.</p>
<h2><a class="header" href="#state-properties-8" id="state-properties-8">State Properties</a></h2>
<table><thead><tr><th>Name</th><th>Key</th><th>R</th><th>W</th><th>Req</th><th>Description</th></tr></thead><tbody>
<tr><td>Pressure</td><td><code>s/aenv/pres</code></td><td>X</td><td></td><td></td><td>Ambient air pressure. <em>Units TBD</em>.</td></tr>
<tr><td>Temperature</td><td><code>s/aenv/temp</code></td><td>X</td><td></td><td></td><td>Ambient air temperature, in °C</td></tr>
<tr><td>Humidity</td><td><code>s/aenv/humi</code></td><td>X</td><td></td><td></td><td>Relative ambient humidity</td></tr>
<tr><td>LightLevel</td><td><code>s/aenv/temp</code></td><td>X</td><td></td><td></td><td>Ambient light level. <em>Units TBD</em>.</td></tr>
</tbody></table>
<h3><a class="header" href="#saenvpres--pressure" id="saenvpres--pressure"><code>s/aenv/pres</code> : Pressure</a></h3>
<p>Ambient air pressure. <em>Units TBD</em>.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>real number</td></tr>
<tr><td align="right">Flags</td><td><code>GET</code>, <code>OBS</code></td></tr>
</tbody></table>
<h3><a class="header" href="#saenvtemp--temperature" id="saenvtemp--temperature"><code>s/aenv/temp</code> : Temperature</a></h3>
<p>Ambient air temperature, in °C.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>real number</td></tr>
<tr><td align="right">Flags</td><td><code>GET</code>, <code>OBS</code></td></tr>
</tbody></table>
<h3><a class="header" href="#saenvhumi--humidity" id="saenvhumi--humidity"><code>s/aenv/humi</code> : Humidity</a></h3>
<p>Relative ambient humidity.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>percentage (0.0-1.0)</td></tr>
<tr><td align="right">Flags</td><td><code>GET</code>, <code>OBS</code></td></tr>
</tbody></table>
<p>Units TBD.</p>
<h3><a class="header" href="#saenvtemp--lightlevel" id="saenvtemp--lightlevel"><code>s/aenv/temp</code> : LightLevel</a></h3>
<p>Ambient light level. <em>Units TBD</em>.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>real number</td></tr>
<tr><td align="right">Flags</td><td><code>GET</code>, <code>OBS</code></td></tr>
</tbody></table>
<h2><a class="header" href="#metadata-properties-10" id="metadata-properties-10">Metadata Properties</a></h2>
<table><thead><tr><th>Name</th><th>Key</th><th>R</th><th>W</th><th>Req</th><th>Description</th></tr></thead><tbody>
<tr><td>TraitURI</td><td><code>m/aenv/turi</code></td><td>X</td><td></td><td>X</td><td>The URI that uniquely identifies the specification used to implement this trait.</td></tr>
</tbody></table>
<h3><a class="header" href="#maenvturi--traituri" id="maenvturi--traituri"><code>m/aenv/turi</code> : TraitURI</a></h3>
<p>The URI that uniquely identifies the specification used to implement this trait.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>URI-reference</td></tr>
<tr><td align="right">Flags</td><td><code>CONST</code>, <code>REQ</code></td></tr>
</tbody></table>
<h1><a class="header" href="#button-trait-bttn" id="button-trait-bttn">Button Trait (<code>bttn</code>)</a></h1>
<p>A button that can be pressed.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Id</td><td><code>tag:google.com,2018:m2m:traits:button:v1:v0#r0</code></td></tr>
<tr><td align="right">Short-Id</td><td><code>bttn</code></td></tr>
<tr><td align="right">Has-Children</td><td>no</td></tr>
</tbody></table>
<h2><a class="header" href="#state-properties-9" id="state-properties-9">State Properties</a></h2>
<table><thead><tr><th>Name</th><th>Key</th><th>R</th><th>W</th><th>Req</th><th>Description</th></tr></thead><tbody>
<tr><td>Value</td><td><code>s/bttn/v</code></td><td>X</td><td>?</td><td>X</td><td>Button State</td></tr>
<tr><td>PressCount</td><td><code>s/bttn/c_dn</code></td><td>X</td><td></td><td>X</td><td>The number of times this button has been <em>pressed</em>.</td></tr>
<tr><td>ReleaseCount</td><td><code>s/bttn/c_up</code></td><td>X</td><td></td><td>X</td><td>The number of times this button has been <em>released</em>.</td></tr>
<tr><td>Last</td><td><code>s/bttn/last</code></td><td>X</td><td></td><td></td><td>The number of seconds ago that this button was pressed or released.</td></tr>
</tbody></table>
<h3><a class="header" href="#sbttnv--value" id="sbttnv--value"><code>s/bttn/v</code> : Value</a></h3>
<p>Button State.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>boolean</td></tr>
<tr><td align="right">Flags</td><td><code>REQ</code>, <code>GET</code>, <code>OPT_SET</code>, <code>OBS</code></td></tr>
</tbody></table>
<p><code>true</code> while the button is pressed, <code>false</code> while the button is released.</p>
<h3><a class="header" href="#sbttnc_dn--presscount" id="sbttnc_dn--presscount"><code>s/bttn/c_dn</code> : PressCount</a></h3>
<p>The number of times this button has been <em>pressed</em>.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>integer</td></tr>
<tr><td align="right">Flags</td><td><code>REQ</code>, <code>GET</code>, <code>RESET</code>, <code>OBS</code></td></tr>
</tbody></table>
<p>This count may be reset by setting it to zero. The count is not preserved across power cycles.</p>
<h3><a class="header" href="#sbttnc_up--releasecount" id="sbttnc_up--releasecount"><code>s/bttn/c_up</code> : ReleaseCount</a></h3>
<p>The number of times this button has been <em>released</em>.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>integer</td></tr>
<tr><td align="right">Flags</td><td><code>REQ</code>, <code>GET</code>, <code>RESET</code>, <code>OBS</code></td></tr>
</tbody></table>
<p>This count may be reset by setting it to zero. The count is not preserved across power cycles.</p>
<h3><a class="header" href="#sbttnlast--last" id="sbttnlast--last"><code>s/bttn/last</code> : Last</a></h3>
<p>The number of seconds ago that this button was pressed or released.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>integer</td></tr>
<tr><td align="right">Flags</td><td><code>GET</code>, <code>NO_SET</code>, <code>OBS</code>, <code>VOLATILE</code></td></tr>
</tbody></table>
<p>This value is not cacheable. Observing it will only indicate when the value is reset to zero.</p>
<h2><a class="header" href="#metadata-properties-11" id="metadata-properties-11">Metadata Properties</a></h2>
<table><thead><tr><th>Name</th><th>Key</th><th>R</th><th>W</th><th>Req</th><th>Description</th></tr></thead><tbody>
<tr><td>TraitURI</td><td><code>m/bttn/turi</code></td><td>X</td><td></td><td>X</td><td>The URI that uniquely identifies the specification used to implement this trait.</td></tr>
</tbody></table>
<h3><a class="header" href="#mbttnturi--traituri" id="mbttnturi--traituri"><code>m/bttn/turi</code> : TraitURI</a></h3>
<p>The URI that uniquely identifies the specification used to implement this trait.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>URI-reference</td></tr>
<tr><td align="right">Flags</td><td><code>CONST</code>, <code>REQ</code></td></tr>
</tbody></table>
<h1><a class="header" href="#presence-trait-pres" id="presence-trait-pres">Presence Trait (<code>pres</code>)</a></h1>
<p>Detects presence.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Id</td><td><code>tag:google.com,2018:m2m:traits:presence:v1:v0#r0</code></td></tr>
<tr><td align="right">Short-Id</td><td><code>pres</code></td></tr>
<tr><td align="right">Has-Children</td><td>no</td></tr>
</tbody></table>
<p>Implemented by things that can detect the presence of someone, such as motion sensors and pressure mats.</p>
<h2><a class="header" href="#state-properties-10" id="state-properties-10">State Properties</a></h2>
<table><thead><tr><th>Name</th><th>Key</th><th>R</th><th>W</th><th>Req</th><th>Description</th></tr></thead><tbody>
<tr><td>Value</td><td><code>s/pres/v</code></td><td>X</td><td>?</td><td>X</td><td>Presence Detected</td></tr>
<tr><td>Count</td><td><code>s/pres/c</code></td><td>X</td><td></td><td>X</td><td>Trip Count</td></tr>
<tr><td>Last</td><td><code>s/pres/last</code></td><td>X</td><td></td><td></td><td>The number of seconds ago that presence was last detected.</td></tr>
</tbody></table>
<h3><a class="header" href="#spresv--value" id="spresv--value"><code>s/pres/v</code> : Value</a></h3>
<p>Presence Detected.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>boolean</td></tr>
<tr><td align="right">Flags</td><td><code>REQ</code>, <code>GET</code>, <code>OPT_SET</code>, <code>OBS</code></td></tr>
</tbody></table>
<p><code>true</code> while presence is detected, <code>false</code> otherwise.</p>
<p>The presence signal is generally momentary in nature, flipping back and forth between detected and not-detected as the sensor detects movement.</p>
<h3><a class="header" href="#spresc--count" id="spresc--count"><code>s/pres/c</code> : Count</a></h3>
<p>Trip Count.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>integer</td></tr>
<tr><td align="right">Flags</td><td><code>REQ</code>, <code>GET</code>, <code>RESET</code>, <code>OBS</code></td></tr>
</tbody></table>
<p>This count may be reset by setting it to zero. The count is not preserved across power cycles.</p>
<h3><a class="header" href="#spreslast--last" id="spreslast--last"><code>s/pres/last</code> : Last</a></h3>
<p>The number of seconds ago that presence was last detected.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>integer</td></tr>
<tr><td align="right">Flags</td><td><code>GET</code>, <code>NO_SET</code>, <code>OBS</code>, <code>VOLATILE</code></td></tr>
</tbody></table>
<p>This value is not cacheable. Observing it will only indicate when the value is reset to zero.</p>
<h2><a class="header" href="#metadata-properties-12" id="metadata-properties-12">Metadata Properties</a></h2>
<table><thead><tr><th>Name</th><th>Key</th><th>R</th><th>W</th><th>Req</th><th>Description</th></tr></thead><tbody>
<tr><td>TraitURI</td><td><code>m/pres/turi</code></td><td>X</td><td></td><td>X</td><td>The URI that uniquely identifies the specification used to implement this trait.</td></tr>
</tbody></table>
<h3><a class="header" href="#mpresturi--traituri" id="mpresturi--traituri"><code>m/pres/turi</code> : TraitURI</a></h3>
<p>The URI that uniquely identifies the specification used to implement this trait.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>URI-reference</td></tr>
<tr><td align="right">Flags</td><td><code>CONST</code>, <code>REQ</code></td></tr>
</tbody></table>
<h1><a class="header" href="#automation-traits" id="automation-traits">Automation Traits</a></h1>
<p>The <code>automation</code> Splot traits are traits for implementing and managing
<a href="trait-def/auto/../../automation/primitives.html">automation primitives</a>.</p>
<ul>
<li><a href="trait-def/auto/./pairing.html"><code>Pairing</code></a>: Trait for automation pairings, which are automation primitives
that link the value of two different resources.</li>
<li><a href="trait-def/auto/./pairing-manager.html"><code>PairingManager</code></a>: Trait for things that create or delete
automation pairings.</li>
<li><a href="trait-def/auto/./actionable.html"><code>Actionable</code></a>: Trait for automation primitives that can
be triggered to perform specific actions. Implemented by Rules and Timers.</li>
<li><a href="trait-def/auto/./rule.html"><code>Rule</code></a>: Trait for automation rules, which are <a href="trait-def/auto/./actionable.html">actionable</a>
automation primitives that trigger once one or all of the configured conditions
have been satisfied.</li>
<li><a href="trait-def/auto/./rule-manager.html"><code>RuleManager</code></a>: Trait for things that create or delete
automation rules.</li>
<li><a href="trait-def/auto/./timer.html"><code>Timer</code></a>: Trait for automation timers, which are <a href="trait-def/auto/./actionable.html">actionable</a>
automation primitives that trigger after a delay, at regular intervals, or at specific
times or dates.</li>
<li><a href="trait-def/auto/./timer-manager.html"><code>TimerManager</code></a>: Trait for things that create or delete
automation timers.</li>
</ul>
<h1><a class="header" href="#automationpairing-trait-pair" id="automationpairing-trait-pair">AutomationPairing Trait (<code>pair</code>)</a></h1>
<p>Automation Pairing.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Id</td><td><code>tag:google.com,2018:m2m:traits:pairing:v1:v0#r0</code></td></tr>
<tr><td align="right">Short-Id</td><td><code>pair</code></td></tr>
<tr><td align="right">Has-Children</td><td>no</td></tr>
</tbody></table>
<p>An automation pairing allows you to create a relationship between two different properties, potentially on two different things.</p>
<h2><a class="header" href="#state-properties-11" id="state-properties-11">State Properties</a></h2>
<table><thead><tr><th>Name</th><th>Key</th><th>R</th><th>W</th><th>Req</th><th>Description</th></tr></thead><tbody>
<tr><td>Count</td><td><code>s/pair/c</code></td><td>X</td><td></td><td></td><td>The number of times this pairing has &quot;fired&quot;.</td></tr>
<tr><td>Last</td><td><code>s/pair/last</code></td><td>X</td><td></td><td></td><td>The number of seconds ago that this pairing last fired.</td></tr>
</tbody></table>
<h3><a class="header" href="#spairc--count" id="spairc--count"><code>s/pair/c</code> : Count</a></h3>
<p>The number of times this pairing has &quot;fired&quot;.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>integer</td></tr>
<tr><td align="right">Flags</td><td><code>GET</code>, <code>RESET</code>, <code>OBS</code>, <code>VOLATILE</code></td></tr>
</tbody></table>
<p>This count may be reset by setting it to zero. The count is not preserved across power cycles.</p>
<h3><a class="header" href="#spairlast--last" id="spairlast--last"><code>s/pair/last</code> : Last</a></h3>
<p>The number of seconds ago that this pairing last fired.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>integer</td></tr>
<tr><td align="right">Flags</td><td><code>GET</code>, <code>NO_SET</code>, <code>OBS</code>, <code>VOLATILE</code></td></tr>
</tbody></table>
<p>This value is not cacheable. Observing it will only indicate when the value is reset to zero.</p>
<h2><a class="header" href="#config-properties-5" id="config-properties-5">Config Properties</a></h2>
<table><thead><tr><th>Name</th><th>Key</th><th>R</th><th>W</th><th>Req</th><th>Description</th></tr></thead><tbody>
<tr><td>Source</td><td><code>c/pair/src</code></td><td>X</td><td>X</td><td>X</td><td>Source Resource URI-reference.</td></tr>
<tr><td>Destination</td><td><code>c/pair/dst</code></td><td>X</td><td>X</td><td>X</td><td>Destination Resource URI-reference.</td></tr>
<tr><td>EnableForward</td><td><code>c/pair/efwd</code></td><td>X</td><td>X</td><td>X</td><td>Enables changes to the source to be applied to the destination.</td></tr>
<tr><td>EnableReverse</td><td><code>c/pair/erev</code></td><td>X</td><td>X</td><td></td><td>Enables changes to the destination to be applied to the source.</td></tr>
<tr><td>ForwardTransform</td><td><code>c/pair/xfwd</code></td><td>X</td><td>X</td><td></td><td>Forward value transform</td></tr>
<tr><td>ReverseTransform</td><td><code>c/pair/xrev</code></td><td>X</td><td>X</td><td></td><td>Reverse value transform</td></tr>
</tbody></table>
<h3><a class="header" href="#cpairsrc--source" id="cpairsrc--source"><code>c/pair/src</code> : Source</a></h3>
<p>Source Resource URI-reference.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>URI-reference</td></tr>
<tr><td align="right">Flags</td><td><code>REQ</code>, <code>GET</code>, <code>SET</code></td></tr>
</tbody></table>
<p>By convention, this is typically the local resource.</p>
<h3><a class="header" href="#cpairdst--destination" id="cpairdst--destination"><code>c/pair/dst</code> : Destination</a></h3>
<p>Destination Resource URI-reference.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>URI-reference</td></tr>
<tr><td align="right">Flags</td><td><code>REQ</code>, <code>GET</code>, <code>SET</code></td></tr>
</tbody></table>
<p>By convention, this is typically the remote resource.</p>
<h3><a class="header" href="#cpairefwd--enableforward" id="cpairefwd--enableforward"><code>c/pair/efwd</code> : EnableForward</a></h3>
<p>Enables changes to the source to be applied to the destination.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>boolean</td></tr>
<tr><td align="right">Flags</td><td><code>REQ</code>, <code>GET</code>, <code>SET</code></td></tr>
</tbody></table>
<h3><a class="header" href="#cpairerev--enablereverse" id="cpairerev--enablereverse"><code>c/pair/erev</code> : EnableReverse</a></h3>
<p>Enables changes to the destination to be applied to the source.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>boolean</td></tr>
<tr><td align="right">Flags</td><td><code>GET</code>, <code>SET</code></td></tr>
</tbody></table>
<h3><a class="header" href="#cpairxfwd--forwardtransform" id="cpairxfwd--forwardtransform"><code>c/pair/xfwd</code> : ForwardTransform</a></h3>
<p>Forward value transform.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>text string</td></tr>
<tr><td align="right">Flags</td><td><code>GET</code>, <code>SET</code></td></tr>
</tbody></table>
<p>This string contains a simple RPN expression for modifying the numeric value of the source before applying it to the destination during forward value propagation. The value read from the source is the first item on the stack. The return value is the top-most value on the stack after evaluation. Thus, an empty forward transform is the identity function. If the stack is empty or the last pushed value is &quot;DROP&quot;, the value does not propagate --- this behavior can be used to implement a predicate.</p>
<p>Example: The algebraic expression <code>x' = (cos(x/2 - 0.5) + 1)/2</code> would become <code>2 / 0.5 - COS 1 + 2 /</code>.</p>
<p>Note that <code>COS</code>/<i>cos()</i> takes <em>turns</em> instead of radians for its argument.</p>
<p>Example: <code>POP 0.1858 - SWAP POP 0.3320 - SWAP DROP SWAP / -449 3525 -6823.3 5520.33 POLY3</code> would convert CIE xy chromaticity coordinates in an array into an approximate correlated color temperature in Kelvin.</p>
<h3><a class="header" href="#cpairxrev--reversetransform" id="cpairxrev--reversetransform"><code>c/pair/xrev</code> : ReverseTransform</a></h3>
<p>Reverse value transform.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>text string</td></tr>
<tr><td align="right">Flags</td><td><code>GET</code>, <code>SET</code></td></tr>
</tbody></table>
<p>This string contains a simple RPN expression for modifying the numeric value of the destination before applying it to the source during reverse value propagation. The value read from the destination is the first item on the stack. The return value is the top-most value on the stack after evaluation. Thus, an empty reverse transform is the identity function. If the stack is empty or the last pushed value is &quot;DROP&quot;, the value does not propagate --- this behavior can be used to implement a predicate.</p>
<p>Example: For the forward transform <code>2 *</code> (<i>x' = x * 2</i>), the correct reverse transform would be <code>2 /</code> (<i>x' = x/2</i>).</p>
<h2><a class="header" href="#metadata-properties-13" id="metadata-properties-13">Metadata Properties</a></h2>
<table><thead><tr><th>Name</th><th>Key</th><th>R</th><th>W</th><th>Req</th><th>Description</th></tr></thead><tbody>
<tr><td>TraitURI</td><td><code>m/pair/turi</code></td><td>X</td><td></td><td>X</td><td>The URI that uniquely identifies the specification used to implement this trait.</td></tr>
</tbody></table>
<h3><a class="header" href="#mpairturi--traituri" id="mpairturi--traituri"><code>m/pair/turi</code> : TraitURI</a></h3>
<p>The URI that uniquely identifies the specification used to implement this trait.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>URI-reference</td></tr>
<tr><td align="right">Flags</td><td><code>CONST</code>, <code>REQ</code></td></tr>
</tbody></table>
<h2><a class="header" href="#associated-constants-4" id="associated-constants-4">Associated Constants</a></h2>
<table><thead><tr><th>Name</th><th>Value</th><th>Description</th></tr></thead><tbody>
<tr><td><code>TRAP_SOURCE_WRITE_FAIL</code></td><td>&quot;src-write-fail&quot;</td><td>An attempt to write to the source resource has failed.</td></tr>
<tr><td><code>TRAP_DESTINATION_WRITE_FAIL</code></td><td>&quot;dest-write-fail&quot;</td><td>An attempt to write to the destination resource has failed.</td></tr>
<tr><td><code>TRAP_SOURCE_READ_FAIL</code></td><td>&quot;src-read-fail&quot;</td><td>An attempt to read from the source resource has failed.</td></tr>
<tr><td><code>TRAP_DESTINATION_READ_FAIL</code></td><td>&quot;dest-read-fail&quot;</td><td>An attempt to read from the source resource has failed.</td></tr>
</tbody></table>
<h1><a class="header" href="#automationpairingmanager-trait-pmgr" id="automationpairingmanager-trait-pmgr">AutomationPairingManager Trait (<code>pmgr</code>)</a></h1>
<p>Experimental trait for managing automation pairings.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Id</td><td><code>tag:google.com,2018:m2m:traits:pairing-manager:v1:v0#r0</code></td></tr>
<tr><td align="right">Short-Id</td><td><code>pmgr</code></td></tr>
<tr><td align="right">Has-Children</td><td>yes</td></tr>
</tbody></table>
<h2><a class="header" href="#metadata-properties-14" id="metadata-properties-14">Metadata Properties</a></h2>
<table><thead><tr><th>Name</th><th>Key</th><th>R</th><th>W</th><th>Req</th><th>Description</th></tr></thead><tbody>
<tr><td>TraitURI</td><td><code>m/pmgr/turi</code></td><td>X</td><td></td><td>X</td><td>The URI that uniquely identifies the specification used to implement this trait.</td></tr>
</tbody></table>
<h3><a class="header" href="#mpmgrturi--traituri" id="mpmgrturi--traituri"><code>m/pmgr/turi</code> : TraitURI</a></h3>
<p>The URI that uniquely identifies the specification used to implement this trait.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>URI-reference</td></tr>
<tr><td align="right">Flags</td><td><code>CONST</code>, <code>REQ</code></td></tr>
</tbody></table>
<h2><a class="header" href="#methods-2" id="methods-2">Methods</a></h2>
<table><thead><tr><th>Key</th><th>Description</th></tr></thead><tbody>
<tr><td><code>f/pmgr?create</code></td><td>Creates a new automation pairing.</td></tr>
</tbody></table>
<h3><a class="header" href="#fpmgrcreate--create" id="fpmgrcreate--create"><code>f/pmgr?create</code> : Create</a></h3>
<p>Creates a new automation pairing.</p>
<table><thead><tr><th>Arg</th><th>Req</th><th>Returns</th><th>Description</th></tr></thead><tbody>
<tr><td><code>xfwd</code></td><td></td><td>text string</td><td>Maps to <code>c/pair/xfwd</code></td></tr>
<tr><td><code>dst</code></td><td>X</td><td>URI-reference</td><td>Maps to <code>c/pair/dst</code></td></tr>
<tr><td><code>erev</code></td><td></td><td>boolean</td><td>Maps to <code>c/pair/erev</code></td></tr>
<tr><td><code>en</code></td><td></td><td>boolean</td><td>Maps to <code>c/enab/v</code></td></tr>
<tr><td><code>src</code></td><td>X</td><td>URI-reference</td><td>Maps to <code>c/pair/src</code></td></tr>
<tr><td><code>name</code></td><td></td><td>text string</td><td>Maps to <code>m/base/name</code></td></tr>
<tr><td><code>xrev</code></td><td></td><td>text string</td><td>Maps to <code>c/pair/xrev</code></td></tr>
<tr><td><code>efwd</code></td><td></td><td>boolean</td><td>Maps to <code>c/pair/efwd</code></td></tr>
</tbody></table>
<p>Returns URI for the created pairing.</p>
<h1><a class="header" href="#actionable-trait-actn" id="actionable-trait-actn">Actionable Trait (<code>actn</code>)</a></h1>
<p>Experimental trait for things that trigger actions, such as rules and timers.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Id</td><td><code>tag:google.com,2018:m2m:traits:actionable:v1:v0#r0</code></td></tr>
<tr><td align="right">Short-Id</td><td><code>actn</code></td></tr>
<tr><td align="right">Has-Children</td><td>no</td></tr>
</tbody></table>
<h2><a class="header" href="#state-properties-12" id="state-properties-12">State Properties</a></h2>
<table><thead><tr><th>Name</th><th>Key</th><th>R</th><th>W</th><th>Req</th><th>Description</th></tr></thead><tbody>
<tr><td>Count</td><td><code>s/actn/c</code></td><td>X</td><td></td><td></td><td>The number of times this thing has &quot;fired&quot;.</td></tr>
<tr><td>Last</td><td><code>s/actn/last</code></td><td>X</td><td></td><td></td><td>The number of seconds ago that this thing last fired.</td></tr>
</tbody></table>
<h3><a class="header" href="#sactnc--count" id="sactnc--count"><code>s/actn/c</code> : Count</a></h3>
<p>The number of times this thing has &quot;fired&quot;.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>integer</td></tr>
<tr><td align="right">Flags</td><td><code>GET</code>, <code>RESET</code>, <code>OBS</code>, <code>VOLATILE</code></td></tr>
</tbody></table>
<p>This count may be reset by setting it to zero. The count is not preserved across power cycles.</p>
<h3><a class="header" href="#sactnlast--last" id="sactnlast--last"><code>s/actn/last</code> : Last</a></h3>
<p>The number of seconds ago that this thing last fired.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>integer</td></tr>
<tr><td align="right">Flags</td><td><code>GET</code>, <code>NO_SET</code>, <code>OBS</code>, <code>VOLATILE</code></td></tr>
</tbody></table>
<p>This value is not cacheable. Observing it will only indicate when the value is reset to zero.</p>
<h2><a class="header" href="#config-properties-6" id="config-properties-6">Config Properties</a></h2>
<table><thead><tr><th>Name</th><th>Key</th><th>R</th><th>W</th><th>Req</th><th>Description</th></tr></thead><tbody>
<tr><td>Actions</td><td><code>c/actn/acti</code></td><td>X</td><td>X</td><td>X</td><td>Actions to perform when this automation fires.</td></tr>
</tbody></table>
<h3><a class="header" href="#cactnacti--actions" id="cactnacti--actions"><code>c/actn/acti</code> : Actions</a></h3>
<p>Actions to perform when this automation fires.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>array containing maps of nullable splot values</td></tr>
<tr><td align="right">Flags</td><td><code>REQ</code>, <code>GET</code>, <code>SET</code></td></tr>
</tbody></table>
<p>Each criteria is defined as a map keyed by strings. The string keys are the following:</p>
<ul>
<li>[<code>PARAM_ACTION_PATH</code>]: URL or absolute path to perform an action on</li>
<li>[<code>PARAM_ACTION_SKIP</code>]: True if this action should be skipped.</li>
<li>[<code>PARAM_ACTION_DESC</code>]: Human-readable description of the action</li>
<li>[<code>PARAM_ACTION_METHOD</code>]: The REST method to perform on the path</li>
<li>[<code>PARAM_ACTION_BODY</code>]: The body of the action</li>
<li>[<code>PARAM_ACTION_SYNC</code>]: If this action should complete before the next action</li>
</ul>
<h2><a class="header" href="#metadata-properties-15" id="metadata-properties-15">Metadata Properties</a></h2>
<table><thead><tr><th>Name</th><th>Key</th><th>R</th><th>W</th><th>Req</th><th>Description</th></tr></thead><tbody>
<tr><td>TraitURI</td><td><code>m/actn/turi</code></td><td>X</td><td></td><td>X</td><td>The URI that uniquely identifies the specification used to implement this trait.</td></tr>
</tbody></table>
<h3><a class="header" href="#mactnturi--traituri" id="mactnturi--traituri"><code>m/actn/turi</code> : TraitURI</a></h3>
<p>The URI that uniquely identifies the specification used to implement this trait.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>URI-reference</td></tr>
<tr><td align="right">Flags</td><td><code>CONST</code>, <code>REQ</code></td></tr>
</tbody></table>
<h2><a class="header" href="#associated-constants-5" id="associated-constants-5">Associated Constants</a></h2>
<table><thead><tr><th>Name</th><th>Value</th><th>Description</th></tr></thead><tbody>
<tr><td><code>PARAM_ACTION_PATH</code></td><td>&quot;p&quot;</td><td>Path for action.</td></tr>
<tr><td><code>PARAM_ACTION_METHOD</code></td><td>&quot;m&quot;</td><td>The REST method to use for the action.</td></tr>
<tr><td><code>PARAM_ACTION_BODY</code></td><td>&quot;b&quot;</td><td>The body to use for the action.</td></tr>
<tr><td><code>PARAM_ACTION_CONTENT_FORMAT</code></td><td>&quot;ct&quot;</td><td>The <a href="https://tools.ietf.org/html/rfc7252#section-12.3">CoAP content-format</a> to use for rendering the body when performing the action.</td></tr>
<tr><td><code>PARAM_ACTION_SKIP</code></td><td>&quot;s&quot;</td><td>Flag indicating if this action should be skipped. If absent, it is assumed to be false.</td></tr>
<tr><td><code>PARAM_ACTION_DESC</code></td><td>&quot;desc&quot;</td><td>Human readable description of the action</td></tr>
<tr><td><code>PARAM_ACTION_SYNC</code></td><td>&quot;b&quot;</td><td>Determines if this action should block execution or not.</td></tr>
<tr><td><code>SYNC_DO_NOT_WAIT</code></td><td>0</td><td>Value for [<code>PARAM_ACTION_SYNC</code>]: Trigger this action asynchronously.</td></tr>
<tr><td><code>SYNC_WAIT_TO_FINISH</code></td><td>1</td><td>Value for [<code>PARAM_ACTION_SYNC</code>]: Trigger this action synchronously.</td></tr>
<tr><td><code>SYNC_STOP_ON_ERROR</code></td><td>2</td><td>Value for [<code>PARAM_ACTION_SYNC</code>]: Trigger this action synchronously, stopping on error.</td></tr>
</tbody></table>
<h1><a class="header" href="#automationrule-trait-rule" id="automationrule-trait-rule">AutomationRule Trait (<code>rule</code>)</a></h1>
<p>Experimental trait representing an automation rule.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Id</td><td><code>tag:google.com,2018:m2m:traits:rule:v1:v0#r0</code></td></tr>
<tr><td align="right">Short-Id</td><td><code>rule</code></td></tr>
<tr><td align="right">Has-Children</td><td>no</td></tr>
<tr><td align="right">Requires</td><td><code>tag:google.com,2018:m2m:traits:actionable:v1:v0#r0</code></td></tr>
</tbody></table>
<p>An automation rule allows you to create if-this-then-that style relationships across things that are associated with the same technology.</p>
<h2><a class="header" href="#config-properties-7" id="config-properties-7">Config Properties</a></h2>
<table><thead><tr><th>Name</th><th>Key</th><th>R</th><th>W</th><th>Req</th><th>Description</th></tr></thead><tbody>
<tr><td>Conditions</td><td><code>c/rule/cond</code></td><td>X</td><td>X</td><td>X</td><td>Criteria table for determining when the action should fire.</td></tr>
<tr><td>Match</td><td><code>c/rule/mtch</code></td><td>X</td><td>X</td><td>X</td><td>Match-all-criteria vs. Match-any-criteria</td></tr>
</tbody></table>
<h3><a class="header" href="#crulecond--conditions" id="crulecond--conditions"><code>c/rule/cond</code> : Conditions</a></h3>
<p>Criteria table for determining when the action should fire.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>array containing maps of nullable splot values</td></tr>
<tr><td align="right">Flags</td><td><code>REQ</code>, <code>GET</code>, <code>SET</code></td></tr>
</tbody></table>
<p>All of the given criteria must be satisfied for the action to fire. Each criteria
is defined as a map keyed by strings. The string keys are the
following:</p>
<ul>
<li><code>p</code> [<code>PARAM_COND_PATH</code>]: URL or absolute path to the resource
being evalu</li>
<li><code>c</code> [<code>PARAM_COND_EXPR</code>]: RPN condition to evaluate.</li>
<li><code>s</code> [<code>PARAM_COND_SKIP</code>]: True if this condition should be skipped.</li>
<li><code>d</code> [<code>PARAM_COND_DESC</code>]: Human-readable description of the
criteria</li>
</ul>
<p>If a <code>path</code> is present, then this value is observed. When the observed
path changes, it's previous value is pushed onto the stack, followed
by the just observed new value. <code>cond</code> is then evaluated. After
evaluation, if the top-most item on the stack is greater than or equal
to 0.5, then the condition is considered satisfied. Once all
conditions are considered satisfied, the action fires. If the path is
empty, the value &quot;1.0&quot; is passed onto the stack. Some technologies may
have strict requirements on how the condition string is formatted,
since not all technologies directly support evaluating arbitrary RPN
expressions. In the RPN evaluation context, the following additional
operators are available:</p>
<ul>
<li><code>rtc.tod</code>: Pushes Time of day, in hours. 0.000 - 23.999.</li>
<li><code>rtc.dow</code>: Pushes Day of week. One-based Integer, 1-7. Monday is
1, Sunday is 7.</li>
<li><code>rtc.dom</code>: Pushes Day of month. One-based Integer, 1-30.</li>
<li><code>rtc.moy</code>: Pushes Current month. One-based Integer, 1 = January,
12 = December</li>
<li><code>rtc.dim</code>: Pushes Number of times this weekday has happened this
month. One-based Integer.</li>
<li><code>rtc.wom</code>: Pushes Week of month. One-based Integer.</li>
<li><code>rtc.woy</code>: Pushes Week of year. One-based Integer, 1-52. Week
starts on monday.</li>
<li><code>rtc.wss</code>: Indicates that future instances of <code>rtc.woy</code> and
<code>rtc.dow</code> should be calculated with the week starting on Sunday.
Otherwise, they will assume the week starts on Monday. Pushes
nothing to the stack.</li>
<li><code>rtc.utc</code>: Indicates that all time-based operators should use UTC
instead of local time. Otherwise, all time-based operators use
local time. Pushes nothing to the stack.</li>
<li><code>dt_dx</code>: Pushes seconds since the path was last changed, max value
if never.</li>
<li><code>dt_cs</code>: Pushes seconds since this condition was last satisfied,
max value if never.</li>
<li><code>dt_rt</code>: Pushes seconds since the enclosing rule was last
triggered, max value if never.</li>
</ul>
<h3><a class="header" href="#crulemtch--match" id="crulemtch--match"><code>c/rule/mtch</code> : Match</a></h3>
<p>Match-all-criteria vs. Match-any-criteria.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>text string</td></tr>
<tr><td align="right">Flags</td><td><code>REQ</code>, <code>GET</code>, <code>SET</code></td></tr>
</tbody></table>
<p>This is either &quot;any&quot; or &quot;all&quot;. Default is &quot;all&quot;.</p>
<h2><a class="header" href="#metadata-properties-16" id="metadata-properties-16">Metadata Properties</a></h2>
<table><thead><tr><th>Name</th><th>Key</th><th>R</th><th>W</th><th>Req</th><th>Description</th></tr></thead><tbody>
<tr><td>TraitURI</td><td><code>m/rule/turi</code></td><td>X</td><td></td><td>X</td><td>The URI that uniquely identifies the specification used to implement this trait.</td></tr>
</tbody></table>
<h3><a class="header" href="#mruleturi--traituri" id="mruleturi--traituri"><code>m/rule/turi</code> : TraitURI</a></h3>
<p>The URI that uniquely identifies the specification used to implement this trait.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>URI-reference</td></tr>
<tr><td align="right">Flags</td><td><code>CONST</code>, <code>REQ</code></td></tr>
</tbody></table>
<h2><a class="header" href="#associated-constants-6" id="associated-constants-6">Associated Constants</a></h2>
<table><thead><tr><th>Name</th><th>Value</th><th>Description</th></tr></thead><tbody>
<tr><td><code>MATCH_ALL</code></td><td>&quot;all&quot;</td><td>Match all criteria.</td></tr>
<tr><td><code>MATCH_ANY</code></td><td>&quot;any&quot;</td><td>Match any criteria.</td></tr>
<tr><td><code>PARAM_COND_PATH</code></td><td>&quot;p&quot;</td><td>Path for condition. Optional.</td></tr>
<tr><td><code>PARAM_COND_EXPR</code></td><td>&quot;c&quot;</td><td>Expression for evaluating if the condition is satisfied.</td></tr>
<tr><td><code>PARAM_COND_SKIP</code></td><td>&quot;s&quot;</td><td>Flag indicating if this condition should be skipped.</td></tr>
<tr><td><code>PARAM_COND_DESC</code></td><td>&quot;desc&quot;</td><td>Human readable description of the rule. Optional.</td></tr>
</tbody></table>
<h1><a class="header" href="#automationrulemanager-trait-rmgr" id="automationrulemanager-trait-rmgr">AutomationRuleManager Trait (<code>rmgr</code>)</a></h1>
<p>Experimental trait for managing automation rules.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Id</td><td><code>tag:google.com,2018:m2m:traits:rule-manager:v1:v0#r0</code></td></tr>
<tr><td align="right">Short-Id</td><td><code>rmgr</code></td></tr>
<tr><td align="right">Has-Children</td><td>yes</td></tr>
</tbody></table>
<h2><a class="header" href="#metadata-properties-17" id="metadata-properties-17">Metadata Properties</a></h2>
<table><thead><tr><th>Name</th><th>Key</th><th>R</th><th>W</th><th>Req</th><th>Description</th></tr></thead><tbody>
<tr><td>TraitURI</td><td><code>m/rmgr/turi</code></td><td>X</td><td></td><td>X</td><td>The URI that uniquely identifies the specification used to implement this trait.</td></tr>
</tbody></table>
<h3><a class="header" href="#mrmgrturi--traituri" id="mrmgrturi--traituri"><code>m/rmgr/turi</code> : TraitURI</a></h3>
<p>The URI that uniquely identifies the specification used to implement this trait.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>URI-reference</td></tr>
<tr><td align="right">Flags</td><td><code>CONST</code>, <code>REQ</code></td></tr>
</tbody></table>
<h2><a class="header" href="#methods-3" id="methods-3">Methods</a></h2>
<table><thead><tr><th>Key</th><th>Description</th></tr></thead><tbody>
<tr><td><code>f/rmgr?create</code></td><td>Creates a new automation rule.</td></tr>
</tbody></table>
<h3><a class="header" href="#frmgrcreate--create" id="frmgrcreate--create"><code>f/rmgr?create</code> : Create</a></h3>
<p>Creates a new automation rule.</p>
<table><thead><tr><th>Arg</th><th>Req</th><th>Returns</th><th>Description</th></tr></thead><tbody>
<tr><td><code>actm</code></td><td></td><td>text string</td><td>Method for a single action.</td></tr>
<tr><td><code>en</code></td><td></td><td>boolean</td><td>Determines if the created rule will be immediately enabled or not.</td></tr>
<tr><td><code>name</code></td><td></td><td>text string</td><td>Descriptive name for the created rule.</td></tr>
<tr><td><code>recy</code></td><td></td><td>boolean</td><td>Determines if the created pairing should be recyclable.</td></tr>
<tr><td><code>mtch</code></td><td></td><td>text string</td><td></td></tr>
<tr><td><code>actb</code></td><td></td><td>splot value</td><td>Body for a single action.</td></tr>
<tr><td><code>actp</code></td><td></td><td>URI-reference</td><td>Path for a single action.</td></tr>
<tr><td><code>acti</code></td><td></td><td>array containing maps of nullable splot values</td><td>List of Actions.</td></tr>
<tr><td><code>cond</code></td><td></td><td>array containing maps of nullable splot values</td><td>List of conditions</td></tr>
</tbody></table>
<p>Returns URI for the created rule.</p>
<h1><a class="header" href="#automationtimer-trait-timr" id="automationtimer-trait-timr">AutomationTimer Trait (<code>timr</code>)</a></h1>
<p>Experimental trait representing a schedule or timer.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Id</td><td><code>tag:google.com,2018:m2m:traits:timer:v1:v0#r0</code></td></tr>
<tr><td align="right">Short-Id</td><td><code>timr</code></td></tr>
<tr><td align="right">Has-Children</td><td>no</td></tr>
<tr><td align="right">Requires</td><td><code>tag:google.com,2018:m2m:traits:actionable:v1:v0#r0</code></td></tr>
</tbody></table>
<p>An automation timer allows you to trigger events to occur at certain times. They may be repeating or restartable.</p>
<h2><a class="header" href="#state-properties-13" id="state-properties-13">State Properties</a></h2>
<table><thead><tr><th>Name</th><th>Key</th><th>R</th><th>W</th><th>Req</th><th>Description</th></tr></thead><tbody>
<tr><td>Next</td><td><code>s/timr/next</code></td><td>X</td><td></td><td></td><td>The number of seconds until the timer fires next.</td></tr>
<tr><td>Running</td><td><code>s/timr/run</code></td><td>X</td><td>X</td><td>X</td><td>Flag indicating if the timer is running or not.</td></tr>
</tbody></table>
<h3><a class="header" href="#stimrnext--next" id="stimrnext--next"><code>s/timr/next</code> : Next</a></h3>
<p>The number of seconds until the timer fires next.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>real number</td></tr>
<tr><td align="right">Flags</td><td><code>GET</code></td></tr>
</tbody></table>
<p>This value is not cacheable. A value of zero indicates that this timer has fired and is not running.</p>
<h3><a class="header" href="#stimrrun--running" id="stimrrun--running"><code>s/timr/run</code> : Running</a></h3>
<p>Flag indicating if the timer is running or not.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>boolean</td></tr>
<tr><td align="right">Flags</td><td><code>REQ</code>, <code>RW</code></td></tr>
</tbody></table>
<p>Setting this to false will disarm the timer. Setting this to true will (re)arm the timer.
When arming with [<code>CONF_SCHEDULE_PROGRAM</code>] specified, [<code>STAT_NEXT</code>] will be
recalculated. If [<code>CONF_SCHEDULE_PROGRAM</code>] is empty, then the timer
will resume from its previous remaining time. If the timer is already
running, setting this property to true will do nothing.</p>
<h2><a class="header" href="#config-properties-8" id="config-properties-8">Config Properties</a></h2>
<table><thead><tr><th>Name</th><th>Key</th><th>R</th><th>W</th><th>Req</th><th>Description</th></tr></thead><tbody>
<tr><td>ScheduleProgram</td><td><code>c/timr/schd</code></td><td>X</td><td>X</td><td>X</td><td>Schedule program.</td></tr>
<tr><td>PredicateProgram</td><td><code>c/timr/pred</code></td><td>X</td><td>X</td><td>X</td><td>Predicate program.</td></tr>
<tr><td>AutoReset</td><td><code>c/timr/arst</code></td><td>X</td><td>X</td><td>X</td><td>Auto restart flag.</td></tr>
<tr><td>AutoDelete</td><td><code>c/timr/adel</code></td><td>X</td><td>X</td><td></td><td>Auto delete flag.</td></tr>
</tbody></table>
<h3><a class="header" href="#ctimrschd--scheduleprogram" id="ctimrschd--scheduleprogram"><code>c/timr/schd</code> : ScheduleProgram</a></h3>
<p>Schedule program.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>text string</td></tr>
<tr><td align="right">Flags</td><td><code>REQ</code>, <code>RW</code></td></tr>
</tbody></table>
<p>This RPN expression is used to calculate the number
of seconds until the next fire time.</p>
<p>If the expression returns a value that is not a positive number the
timer is stopped.</p>
<p>Some implementations may strictly limit how this program is
structured.</p>
<h4><a class="header" href="#available-variables" id="available-variables">Available variables</a></h4>
<ul>
<li><code>c</code>: The value of [<code>actn#STAT_COUNT</code>]</li>
<li><code>rtc.tod</code>: Pushes Time of day, in hours. 0.000 - 23.999.</li>
<li><code>rtc.dow</code>: Pushes Day of week. 0-6. Monday is 0, Sunday is 6.</li>
<li><code>rtc.dom</code>: Pushes Day of month. Zero-based Integer, 0-30.</li>
<li><code>rtc.moy</code>: Pushes Current month. zero-based Integer, 0 = January,
11 = December</li>
<li><code>rtc.awm</code>: Aligned week of month. Pushes Number of times this
weekday has happened this month. zero-based Integer.</li>
<li><code>rtc.wom</code>: Pushes Week of month. zero-based Integer.</li>
<li><code>rtc.woy</code>: Pushes Week of year. zero-based Integer, 0-51. Week
starts on monday.</li>
<li><code>rtc.y</code>: Pushes gregorian year.</li>
</ul>
<h4><a class="header" href="#additional-functionsoperatorsflags" id="additional-functionsoperatorsflags">Additional functions/operators/flags</a></h4>
<ul>
<li><code>rtc.wss</code>: Indicates that future instances of <code>rtc.woy</code> and
<code>rtc.dow</code> should be calculated with the week starting on Sunday.
Otherwise, they will assume the week starts on Monday. Pushes
nothing to the stack.</li>
<li><code>rtc.utc</code>: Indicates that all time-based operators should use UTC
instead of local time. Otherwise, all time-based operators use
local time. Pushes nothing to the stack.</li>
<li><code>H&gt;S</code>: Convert hours to seconds</li>
<li><code>D&gt;S</code>: Convert days to seconds</li>
</ul>
<h4><a class="header" href="#examples" id="examples">Examples</a></h4>
<ul>
<li><code>12 rtc.tod - 24 % H&gt;S</code>: Every day at noon</li>
<li><code>13.5 rtc.tod - 24 % H&gt;S</code>: Every day at 1:30 PM</li>
<li><code>12 rtc.tod - 24 % H&gt;S 1 rtc.dow - 7 % D&gt;S +</code>: Every tuesday at
noon</li>
<li><code>20 RND 2 * + rtc.tod - 24 % H&gt;S</code>: Every day at some random time
between 8pm and 10pm</li>
</ul>
<h3><a class="header" href="#ctimrpred--predicateprogram" id="ctimrpred--predicateprogram"><code>c/timr/pred</code> : PredicateProgram</a></h3>
<p>Predicate program.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>text string</td></tr>
<tr><td align="right">Flags</td><td><code>REQ</code>, <code>RW</code></td></tr>
</tbody></table>
<p>This program is evaluated whenever the timer
expires. If the predicate evaluates to true, then the actions are
fired. If it evaluates to false, then the timer is reset, and
[<code>actn#STAT_COUNT</code>] is not incremented. The intent of the predicate is
to allow for complex schedules to be implemented, such as &quot;every
second tuesday of the month at noon&quot; or &quot;Every easter at 9am&quot;. Some
implementations may strictly limit how this program is structured.</p>
<h4><a class="header" href="#available-variables-1" id="available-variables-1">Available variables</a></h4>
<ul>
<li><code>c</code>: The value of [<code>actn#STAT_COUNT</code>]</li>
<li><code>rtc.tod</code>: Pushes Time of day, in hours. 0.000 - 23.999.</li>
<li><code>rtc.dow</code>: Pushes Day of week. 0-6. Monday is 0, Sunday is 6.</li>
<li><code>rtc.dom</code>: Pushes Day of month. Zero-based Integer, 0-30.</li>
<li><code>rtc.moy</code>: Pushes Current month. zero-based Integer, 0 = January,
11 = December</li>
<li><code>rtc.awm</code>: Aligned week of month. Pushes Number of times this
weekday has happened this month. zero-based Integer.</li>
<li><code>rtc.wom</code>: Pushes Week of month. zero-based Integer.</li>
<li><code>rtc.woy</code>: Pushes Week of year. zero-based Integer, 0-51. Week
starts on monday.</li>
<li><code>rtc.y</code>: Pushes gregorian year.</li>
</ul>
<p>If the RTC has not been set (or is not present) then none of the 'rtc'
variables are present.</p>
<h4><a class="header" href="#additional-functionsoperatorsflags-1" id="additional-functionsoperatorsflags-1">Additional functions/operators/flags</a></h4>
<ul>
<li><code>rtc.wss</code>: Indicates that future instances of <code>rtc.woy</code> and
<code>rtc.dow</code> should be calculated with the week starting on Sunday.
Otherwise, they will assume the week starts on Monday. Pushes
nothing to the stack.</li>
<li><code>rtc.utc</code>: Indicates that all time-based operators should use UTC
instead of local time. Otherwise, all time-based operators use
local time. Pushes nothing to the stack.</li>
<li><code>H&gt;S</code>: Convert hours to seconds</li>
<li><code>D&gt;S</code>: Convert days to seconds</li>
</ul>
<h4><a class="header" href="#examples-1" id="examples-1">Examples</a></h4>
<ul>
<li><code>2 rtc.dow == 1 rtc.awm == &amp;&amp;</code>: Only fire on the second Wednesday
of the month.</li>
<li><code>0.2 RNG &amp;gt;</code>: Only fire 20% of the time.</li>
<li><code>1 rtc.moy == 28 rtc.dom &amp;&amp;</code>: Only fire on leap day</li>
</ul>
<h3><a class="header" href="#ctimrarst--autoreset" id="ctimrarst--autoreset"><code>c/timr/arst</code> : AutoReset</a></h3>
<p>Auto restart flag.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>boolean</td></tr>
<tr><td align="right">Flags</td><td><code>REQ</code>, <code>RW</code></td></tr>
</tbody></table>
<p>If this flag is true, then the timer will automatically restart after firing. It will continue to run until it is explicitly stopped or until the schedule program fails to return a positive number.</p>
<h3><a class="header" href="#ctimradel--autodelete" id="ctimradel--autodelete"><code>c/timr/adel</code> : AutoDelete</a></h3>
<p>Auto delete flag.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>boolean</td></tr>
<tr><td align="right">Flags</td><td><code>RW</code></td></tr>
</tbody></table>
<p>If this flag is true, then the timer will automatically delete itself
once [<code>STAT_RUNNING</code>] <em>automatically</em> transitions from true to false.
Explicitly setting [<code>STAT_RUNNING</code>] to false will NOT cause the timer
to be deleted. Thus, it does make sense to have cases where both this
flag and <code>#CONF_AUTO_RESET</code> are both true. In such a case, deletion
will be triggered by [<code>CONF_SCHEDULE_PROGRAM</code>] returning a
non-positive value.</p>
<h2><a class="header" href="#metadata-properties-18" id="metadata-properties-18">Metadata Properties</a></h2>
<table><thead><tr><th>Name</th><th>Key</th><th>R</th><th>W</th><th>Req</th><th>Description</th></tr></thead><tbody>
<tr><td>TraitURI</td><td><code>m/timr/turi</code></td><td>X</td><td></td><td>X</td><td>The URI that uniquely identifies the specification used to implement this trait.</td></tr>
</tbody></table>
<h3><a class="header" href="#mtimrturi--traituri" id="mtimrturi--traituri"><code>m/timr/turi</code> : TraitURI</a></h3>
<p>The URI that uniquely identifies the specification used to implement this trait.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>URI-reference</td></tr>
<tr><td align="right">Flags</td><td><code>CONST</code>, <code>REQ</code></td></tr>
</tbody></table>
<h2><a class="header" href="#methods-4" id="methods-4">Methods</a></h2>
<table><thead><tr><th>Key</th><th>Description</th></tr></thead><tbody>
<tr><td><code>f/timr?reset</code></td><td>Method for resetting the timer.</td></tr>
</tbody></table>
<h3><a class="header" href="#ftimrreset--reset" id="ftimrreset--reset"><code>f/timr?reset</code> : Reset</a></h3>
<p>Method for resetting the timer.</p>
<p>Calling this method will always restart the timer, even if the timer is already running.</p>
<h1><a class="header" href="#automationtimermanager-trait-tmgr" id="automationtimermanager-trait-tmgr">AutomationTimerManager Trait (<code>tmgr</code>)</a></h1>
<p>Experimental trait for managing automation timers.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Id</td><td><code>tag:google.com,2018:m2m:traits:timer-manager:v1:v0#r0</code></td></tr>
<tr><td align="right">Short-Id</td><td><code>tmgr</code></td></tr>
<tr><td align="right">Has-Children</td><td>yes</td></tr>
</tbody></table>
<h2><a class="header" href="#metadata-properties-19" id="metadata-properties-19">Metadata Properties</a></h2>
<table><thead><tr><th>Name</th><th>Key</th><th>R</th><th>W</th><th>Req</th><th>Description</th></tr></thead><tbody>
<tr><td>TraitURI</td><td><code>m/tmgr/turi</code></td><td>X</td><td></td><td>X</td><td>The URI that uniquely identifies the specification used to implement this trait.</td></tr>
</tbody></table>
<h3><a class="header" href="#mtmgrturi--traituri" id="mtmgrturi--traituri"><code>m/tmgr/turi</code> : TraitURI</a></h3>
<p>The URI that uniquely identifies the specification used to implement this trait.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>URI-reference</td></tr>
<tr><td align="right">Flags</td><td><code>CONST</code>, <code>REQ</code></td></tr>
</tbody></table>
<h2><a class="header" href="#methods-5" id="methods-5">Methods</a></h2>
<table><thead><tr><th>Key</th><th>Description</th></tr></thead><tbody>
<tr><td><code>f/tmgr?create</code></td><td>Creates a new automation timer.</td></tr>
</tbody></table>
<h3><a class="header" href="#ftmgrcreate--create" id="ftmgrcreate--create"><code>f/tmgr?create</code> : Create</a></h3>
<p>Creates a new automation timer.</p>
<table><thead><tr><th>Arg</th><th>Req</th><th>Returns</th><th>Description</th></tr></thead><tbody>
<tr><td><code>pred</code></td><td></td><td>text string</td><td>Predicate program.</td></tr>
<tr><td><code>name</code></td><td></td><td>text string</td><td>Descriptive name for the created timer.</td></tr>
<tr><td><code>recy</code></td><td></td><td>boolean</td><td>Determines if the created timer should be recyclable.</td></tr>
<tr><td><code>acti</code></td><td></td><td>array containing maps of nullable splot values</td><td>List of Actions.</td></tr>
<tr><td><code>actm</code></td><td></td><td>text string</td><td>Method for a single action.</td></tr>
<tr><td><code>mtch</code></td><td></td><td>text string</td><td></td></tr>
<tr><td><code>actp</code></td><td></td><td>URI-reference</td><td>Path for a single action.</td></tr>
<tr><td><code>en</code></td><td></td><td>boolean</td><td>Determines if the created timer will be immediately enabled or not.</td></tr>
<tr><td><code>actb</code></td><td></td><td>splot value</td><td>Body for a single action.</td></tr>
<tr><td><code>adel</code></td><td></td><td>boolean</td><td>Auto delete flag.</td></tr>
<tr><td><code>dura</code></td><td></td><td>real number</td><td>Duration of the timer.</td></tr>
<tr><td><code>arst</code></td><td></td><td>boolean</td><td>Auto reset flag.</td></tr>
<tr><td><code>schd</code></td><td></td><td>text string</td><td>Schedule Program.</td></tr>
</tbody></table>
<p>Returns URI for the created timer.</p>
<h1><a class="header" href="#security-traits" id="security-traits">Security Traits</a></h1>
<p>The <code>security</code> Splot trait collection defines traits for implementing the
<a href="trait-def/sec/../../ssm/intro.html">Splot Security Model</a>.</p>
<ul>
<li><a href="trait-def/sec/./keychain.html"><code>Keychain</code></a>: Trait for things that manage <a href="trait-def/sec/../../ssm/keychain.html#keychain-items">Keychain Items</a>.</li>
<li><a href="trait-def/sec/./keychain-item.html"><code>KeychainItem</code></a>: Trait for things that represent cryptographic credentials.</li>
<li><a href="trait-def/sec/./identity.html"><code>Identity</code></a>: Trait for things that represent <a href="trait-def/sec/../../ssm/identities.html">authenticated client identities</a>.</li>
<li><a href="trait-def/sec/./access-rule.html"><code>AccessRule</code></a>: A trait for a single
<a href="trait-def/sec/../../ssm/identities.html#access-rules">access rule</a> that is associated with a
specific <a href="trait-def/sec/../../ssm/identities.html">identity</a>.</li>
</ul>
<h1><a class="header" href="#keychain-trait-keyc" id="keychain-trait-keyc">Keychain Trait (<code>keyc</code>)</a></h1>
<p>Trait for managing a cryptographic keychain.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Id</td><td><code>tag:google.com,2018:m2m:traits:keychain:v1:v0#r0</code></td></tr>
<tr><td align="right">Short-Id</td><td><code>keyc</code></td></tr>
<tr><td align="right">Has-Children</td><td>yes</td></tr>
</tbody></table>
<h2><a class="header" href="#metadata-properties-20" id="metadata-properties-20">Metadata Properties</a></h2>
<table><thead><tr><th>Name</th><th>Key</th><th>R</th><th>W</th><th>Req</th><th>Description</th></tr></thead><tbody>
<tr><td>TraitURI</td><td><code>m/keyc/turi</code></td><td>X</td><td></td><td>X</td><td>The URI that uniquely identifies the specification used to implement this trait.</td></tr>
</tbody></table>
<h3><a class="header" href="#mkeycturi--traituri" id="mkeycturi--traituri"><code>m/keyc/turi</code> : TraitURI</a></h3>
<p>The URI that uniquely identifies the specification used to implement this trait.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>URI-reference</td></tr>
<tr><td align="right">Flags</td><td><code>CONST</code>, <code>REQ</code></td></tr>
</tbody></table>
<h2><a class="header" href="#methods-6" id="methods-6">Methods</a></h2>
<table><thead><tr><th>Key</th><th>Description</th></tr></thead><tbody>
<tr><td><code>f/keyc?create</code></td><td>Creates a new keychain item</td></tr>
</tbody></table>
<h3><a class="header" href="#fkeyccreate--create" id="fkeyccreate--create"><code>f/keyc?create</code> : Create</a></h3>
<p>Creates a new keychain item.</p>
<table><thead><tr><th>Arg</th><th>Req</th><th>Returns</th><th>Description</th></tr></thead><tbody>
<tr><td><code>type</code></td><td>X</td><td>integer</td><td>Keychain item type parameter.</td></tr>
<tr><td><code>secr</code></td><td></td><td>byte string</td><td>Symmetric shared secret, or private key if <code>cert</code> is present.</td></tr>
<tr><td><code>cert</code></td><td></td><td>byte string</td><td>Certificate parameter.</td></tr>
<tr><td><code>iden</code></td><td></td><td>text string</td><td>Identity to assume for any client using this item.</td></tr>
</tbody></table>
<p>Returns URI for the created keychain item.</p>
<h1><a class="header" href="#keychainitem-trait-kcit" id="keychainitem-trait-kcit">KeychainItem Trait (<code>kcit</code>)</a></h1>
<p>Trait for managing an item in a cryptographic keychain.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Id</td><td><code>tag:google.com,2018:m2m:traits:keychain-item:v1:v0#r0</code></td></tr>
<tr><td align="right">Short-Id</td><td><code>kcit</code></td></tr>
<tr><td align="right">Has-Children</td><td>no</td></tr>
<tr><td align="right">Requires</td><td><code>tag:google.com,2018:m2m:traits:base:v1:v0#r0</code></td></tr>
</tbody></table>
<h2><a class="header" href="#config-properties-9" id="config-properties-9">Config Properties</a></h2>
<table><thead><tr><th>Name</th><th>Key</th><th>R</th><th>W</th><th>Req</th><th>Description</th></tr></thead><tbody>
<tr><td>Identity</td><td><code>c/kcit/iden</code></td><td>X</td><td>X</td><td></td><td>The identity associated with this key.</td></tr>
</tbody></table>
<h3><a class="header" href="#ckcitiden--identity" id="ckcitiden--identity"><code>c/kcit/iden</code> : Identity</a></h3>
<p>The identity associated with this key.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>nullable text string</td></tr>
<tr><td align="right">Flags</td><td><code>RW</code></td></tr>
</tbody></table>
<p>This field determines what identity to assume when a client uses this keychain item to authenticate.</p>
<p>Default value is <code>anon</code>.</p>
<p>This may be absent if the certificate is not associated with an identity.</p>
<h2><a class="header" href="#metadata-properties-21" id="metadata-properties-21">Metadata Properties</a></h2>
<table><thead><tr><th>Name</th><th>Key</th><th>R</th><th>W</th><th>Req</th><th>Description</th></tr></thead><tbody>
<tr><td>TraitURI</td><td><code>m/kcit/turi</code></td><td>X</td><td></td><td>X</td><td>The URI that uniquely identifies the specification used to implement this trait.</td></tr>
<tr><td>Type</td><td><code>m/kcit/type</code></td><td>X</td><td></td><td>X</td><td>Specifies what type of key this item contains.</td></tr>
<tr><td>Ours</td><td><code>m/kcit/ours</code></td><td>X</td><td></td><td></td><td>Determines if this certificate item has a private key.</td></tr>
<tr><td>Certificate</td><td><code>m/kcit/cert</code></td><td>X</td><td></td><td></td><td>DER-encoded X.509 Certificate</td></tr>
<tr><td>HashSha256</td><td><code>m/kcit/sha2</code></td><td>X</td><td></td><td></td><td>SHA256 hash of the certificate.</td></tr>
<tr><td>SecretShare</td><td><code>m/kcit/sssh</code></td><td>?</td><td>X</td><td></td><td>Contains one (of <em>m</em>) shares of the secret.</td></tr>
<tr><td>SecretShareVersion</td><td><code>m/kcit/sssv</code></td><td>X</td><td>X</td><td></td><td>The version of the secret share</td></tr>
</tbody></table>
<h3><a class="header" href="#mkcitturi--traituri" id="mkcitturi--traituri"><code>m/kcit/turi</code> : TraitURI</a></h3>
<p>The URI that uniquely identifies the specification used to implement this trait.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>URI-reference</td></tr>
<tr><td align="right">Flags</td><td><code>CONST</code>, <code>REQ</code></td></tr>
</tbody></table>
<h3><a class="header" href="#mkcittype--type" id="mkcittype--type"><code>m/kcit/type</code> : Type</a></h3>
<p>Specifies what type of key this item contains.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>integer</td></tr>
<tr><td align="right">Flags</td><td><code>CONST</code>, <code>REQ</code></td></tr>
</tbody></table>
<ul>
<li>0 = x.509 certificate</li>
<li>1 = password</li>
<li>2 = AES128 key</li>
</ul>
<h3><a class="header" href="#mkcitours--ours" id="mkcitours--ours"><code>m/kcit/ours</code> : Ours</a></h3>
<p>Determines if this certificate item has a private key.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>boolean</td></tr>
<tr><td align="right">Flags</td><td><code>CONST</code></td></tr>
</tbody></table>
<p>If this item is a certificate without a private key, this value is false. Otherwise it is true. This field is only required when the contained key is asymmetric (public/private).</p>
<h3><a class="header" href="#mkcitcert--certificate" id="mkcitcert--certificate"><code>m/kcit/cert</code> : Certificate</a></h3>
<p>DER-encoded X.509 Certificate.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>byte string</td></tr>
<tr><td align="right">Flags</td><td><code>CONST</code></td></tr>
</tbody></table>
<p>If the key for this item is asymmetric, then this property contains the public portion. For example, for X.509 keys this would contain the public certificate. If the underlying key is symmetric, then this property is absent.</p>
<h3><a class="header" href="#mkcitsha2--hashsha256" id="mkcitsha2--hashsha256"><code>m/kcit/sha2</code> : HashSha256</a></h3>
<p>SHA256 hash of the certificate.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>byte string</td></tr>
<tr><td align="right">Flags</td><td><code>CONST</code></td></tr>
</tbody></table>
<h3><a class="header" href="#mkcitsssh--secretshare" id="mkcitsssh--secretshare"><code>m/kcit/sssh</code> : SecretShare</a></h3>
<p>Contains one (of <em>m</em>) shares of the secret.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>nullable byte string</td></tr>
<tr><td align="right">Flags</td><td><code>OPT_GET</code>, <code>SET</code></td></tr>
</tbody></table>
<p>This property can only be read by someone who has authenticated with the “init” identity. It is only present on keychain items where <code>m/kcit/ours</code> is <em>true</em>. It allows someone to reconstruct the administrative credentials of the network without requiring a factory reset of every device. This allows an administrator to reconstruct their credential by only physically interacting with a subset of the devices in the administrative domain.</p>
<h3><a class="header" href="#mkcitsssv--secretshareversion" id="mkcitsssv--secretshareversion"><code>m/kcit/sssv</code> : SecretShareVersion</a></h3>
<p>The version of the secret share.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>nullable integer</td></tr>
<tr><td align="right">Flags</td><td><code>RW</code></td></tr>
</tbody></table>
<p>This property MUST be updated every time the secret share is updated.</p>
<h1><a class="header" href="#identity-trait-iden" id="identity-trait-iden">Identity Trait (<code>iden</code>)</a></h1>
<p>Trait representing an identity.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Id</td><td><code>tag:google.com,2018:m2m:traits:identity:v1:v0#r0</code></td></tr>
<tr><td align="right">Short-Id</td><td><code>iden</code></td></tr>
<tr><td align="right">Has-Children</td><td>yes</td></tr>
<tr><td align="right">Requires</td><td><code>tag:google.com,2018:m2m:traits:base:v1:v0#r0</code></td></tr>
</tbody></table>
<p>This trait is a work in progress.</p>
<h2><a class="header" href="#metadata-properties-22" id="metadata-properties-22">Metadata Properties</a></h2>
<table><thead><tr><th>Name</th><th>Key</th><th>R</th><th>W</th><th>Req</th><th>Description</th></tr></thead><tbody>
<tr><td>TraitURI</td><td><code>m/iden/turi</code></td><td>X</td><td></td><td>X</td><td>The URI that uniquely identifies the specification used to implement this trait.</td></tr>
</tbody></table>
<h3><a class="header" href="#midenturi--traituri" id="midenturi--traituri"><code>m/iden/turi</code> : TraitURI</a></h3>
<p>The URI that uniquely identifies the specification used to implement this trait.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>URI-reference</td></tr>
<tr><td align="right">Flags</td><td><code>CONST</code>, <code>REQ</code></td></tr>
</tbody></table>
<h2><a class="header" href="#methods-7" id="methods-7">Methods</a></h2>
<table><thead><tr><th>Key</th><th>Description</th></tr></thead><tbody>
<tr><td><code>f/iden?add</code></td><td>Adds a new rule to the identity.</td></tr>
</tbody></table>
<h3><a class="header" href="#fidenadd--addrule" id="fidenadd--addrule"><code>f/iden?add</code> : AddRule</a></h3>
<p>Adds a new rule to the identity.</p>
<table><thead><tr><th>Arg</th><th>Req</th><th>Returns</th><th>Description</th></tr></thead><tbody>
<tr><td><code>type</code></td><td>X</td><td>integer</td><td>Keychain item type parameter.</td></tr>
<tr><td><code>secr</code></td><td></td><td>byte string</td><td>Symmetric shared secret, or private key if <code>cert</code> is present.</td></tr>
<tr><td><code>iden</code></td><td></td><td>text string</td><td>Identity to assume for any client using this item.</td></tr>
<tr><td><code>cert</code></td><td></td><td>byte string</td><td>Certificate parameter.</td></tr>
</tbody></table>
<p>Returns URI for the created keychain item.</p>
<h1><a class="header" href="#accessrule-trait-arul" id="accessrule-trait-arul">AccessRule Trait (<code>arul</code>)</a></h1>
<p>Trait representing an access rule.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Id</td><td><code>tag:google.com,2018:m2m:traits:access-rule:v1:v0#r0</code></td></tr>
<tr><td align="right">Short-Id</td><td><code>arul</code></td></tr>
<tr><td align="right">Has-Children</td><td>no</td></tr>
<tr><td align="right">Requires</td><td><code>tag:google.com,2018:m2m:traits:enabled:v1:v0#r0</code></td></tr>
</tbody></table>
<p>This trait is a work in progress.</p>
<p>Rules are evaluated in order from lowest to highest. Once all rules have been evaluated (or when the last rule evaluated had the “done” flag set), the result of the evaluation is the value of the ‘deny’ flag of the last matching rule (or, if no matching rule, deny by default).</p>
<h2><a class="header" href="#state-properties-14" id="state-properties-14">State Properties</a></h2>
<table><thead><tr><th>Name</th><th>Key</th><th>R</th><th>W</th><th>Req</th><th>Description</th></tr></thead><tbody>
<tr><td>Count</td><td><code>s/arul/c</code></td><td>X</td><td></td><td></td><td>The number of times this rule has been matched.</td></tr>
</tbody></table>
<h3><a class="header" href="#sarulc--count" id="sarulc--count"><code>s/arul/c</code> : Count</a></h3>
<p>The number of times this rule has been matched.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>integer</td></tr>
<tr><td align="right">Flags</td><td><code>GET</code>, <code>RESET</code>, <code>OBS</code>, <code>VOLATILE</code></td></tr>
</tbody></table>
<p>This count may be reset by setting it to zero. The count is not preserved across power cycles.</p>
<h2><a class="header" href="#config-properties-10" id="config-properties-10">Config Properties</a></h2>
<table><thead><tr><th>Name</th><th>Key</th><th>R</th><th>W</th><th>Req</th><th>Description</th></tr></thead><tbody>
<tr><td>Order</td><td><code>c/arul/ordr</code></td><td>X</td><td>X</td><td>X</td><td>The order in which this rule should be applied.</td></tr>
<tr><td>Path</td><td><code>c/arul/path</code></td><td>X</td><td>X</td><td>X</td><td>Path that this rule applies to.</td></tr>
<tr><td>Methods</td><td><code>c/arul/meth</code></td><td>X</td><td>X</td><td>X</td><td>REST Methods that this rule applies to.</td></tr>
<tr><td>ApplyIdentity</td><td><code>c/arul/iden</code></td><td>X</td><td>X</td><td></td><td>Identity to also apply access rules from.</td></tr>
<tr><td>Deny</td><td><code>c/arul/deny</code></td><td>X</td><td>X</td><td>X</td><td>The deny state to assume if this rule matches.</td></tr>
<tr><td>Done</td><td><code>c/arul/done</code></td><td>X</td><td>X</td><td>X</td><td>Stop evaluation if this rule matches.</td></tr>
</tbody></table>
<h3><a class="header" href="#carulordr--order" id="carulordr--order"><code>c/arul/ordr</code> : Order</a></h3>
<p>The order in which this rule should be applied.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>integer</td></tr>
<tr><td align="right">Flags</td><td><code>REQ</code>, <code>RW</code></td></tr>
</tbody></table>
<p>Rules are evaluated in order from lowest to highest.</p>
<h3><a class="header" href="#carulpath--path" id="carulpath--path"><code>c/arul/path</code> : Path</a></h3>
<p>Path that this rule applies to.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>text string</td></tr>
<tr><td align="right">Flags</td><td><code>REQ</code>, <code>RW</code></td></tr>
</tbody></table>
<p>Simple wildcards (<code>*</code>) are supported. Can also match query parameters. Path must be absolute unless starting with a wildcard or a question mark.</p>
<h3><a class="header" href="#carulmeth--methods" id="carulmeth--methods"><code>c/arul/meth</code> : Methods</a></h3>
<p>REST Methods that this rule applies to.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>array containing text strings</td></tr>
<tr><td align="right">Flags</td><td><code>REQ</code>, <code>RW</code></td></tr>
</tbody></table>
<p>Array can contain <code>GET</code>, <code>OBSERVE</code>, <code>POST</code>, <code>PUT</code>, or <code>DELETE</code>. Matches all methods if absent or empty.</p>
<h3><a class="header" href="#caruliden--applyidentity" id="caruliden--applyidentity"><code>c/arul/iden</code> : ApplyIdentity</a></h3>
<p>Identity to also apply access rules from.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>nullable text string</td></tr>
<tr><td align="right">Flags</td><td><code>RW</code></td></tr>
</tbody></table>
<p>Assuming <code>path</code> and <code>meth</code> match, if this field is set the rules engine will execute the rules from another identity inline, as if they were a single rule. A stop flag encountered in that rule set will only stop evaluation within that rule set. This rule will then assume the deny status that results.</p>
<h3><a class="header" href="#caruldeny--deny" id="caruldeny--deny"><code>c/arul/deny</code> : Deny</a></h3>
<p>The deny state to assume if this rule matches.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>boolean</td></tr>
<tr><td align="right">Flags</td><td><code>REQ</code>, <code>RW</code></td></tr>
</tbody></table>
<p>If the rule matches, changes the assumed deny state to this value. Behavior is different if “iden” is specified: it is used as the required resulting state from evaluating ‘iden’ if ‘done’ is set.</p>
<h3><a class="header" href="#caruldone--done" id="caruldone--done"><code>c/arul/done</code> : Done</a></h3>
<p>Stop evaluation if this rule matches.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>boolean</td></tr>
<tr><td align="right">Flags</td><td><code>REQ</code>, <code>RW</code></td></tr>
</tbody></table>
<p>If the rule matches, stop evaluating. If <code>iden</code> is set, evaluation of the rules is only stopped if <code>deny</code> matches the result of evaluating <code>iden</code>.</p>
<h2><a class="header" href="#metadata-properties-23" id="metadata-properties-23">Metadata Properties</a></h2>
<table><thead><tr><th>Name</th><th>Key</th><th>R</th><th>W</th><th>Req</th><th>Description</th></tr></thead><tbody>
<tr><td>TraitURI</td><td><code>m/arul/turi</code></td><td>X</td><td></td><td>X</td><td>The URI that uniquely identifies the specification used to implement this trait.</td></tr>
</tbody></table>
<h3><a class="header" href="#marulturi--traituri" id="marulturi--traituri"><code>m/arul/turi</code> : TraitURI</a></h3>
<p>The URI that uniquely identifies the specification used to implement this trait.</p>
<table><thead><tr><th align="right">Attribute</th><th>Value</th></tr></thead><tbody>
<tr><td align="right">Value Type</td><td>URI-reference</td></tr>
<tr><td align="right">Flags</td><td><code>CONST</code>, <code>REQ</code></td></tr>
</tbody></table>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                

                
            </nav>

        </div>

        

        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        
        
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
        
        

    </body>
</html>
